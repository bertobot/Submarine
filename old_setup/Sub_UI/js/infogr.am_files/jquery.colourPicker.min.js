jQuery.fn.colourPicker=function(c){var b=jQuery.extend({id:"jquery-colour-picker",ico:"ico.gif",title:"Pick a colour",inputBG:true,speed:500,openTxt:"Open colour picker"},c);var d=function(i){var h=i.substr(0,2);var f=i.substr(2,2);var e=i.substr(4,2);return 0.212671*h+0.71516*f+0.072169*e<0.5?"ffffff":"000000"};var a=jQuery("#"+b.id);if(!a.length){a=jQuery('<div id="'+b.id+'"></div>').appendTo(document.body).hide();jQuery(document.body).click(function(e){if(!(jQuery(e.target).is("#"+b.id)||jQuery(e.target).parents("#"+b.id).length)){a.hide(b.speed)}})}return this.each(function(){var e=jQuery(this);var g=jQuery('<a href="#"><img src="'+b.ico+'" alt="'+b.openTxt+'" /></a>').insertAfter(e);var f=jQuery('<input type="text" name="'+e.attr("name")+'" value="'+e.val()+'" size="6" />').insertAfter(e);var h="";jQuery("option",e).each(function(){var i=jQuery(this);var j=i.val();var k=i.text();h+='<li><a href="#" title="'+k+'" rel="'+j+'" style="background: #'+j+"; colour: "+d(j)+';">'+k+"</a></li>"});e.remove();if(b.inputBG){f.change(function(){f.css({background:"#"+f.val(),color:"#"+d(f.val())})});f.change()}g.click(function(){var i=g.offset();var j=b.title?"<h2>"+b.title+"</h2>":"";a.html(j+"<ul>"+h+"</ul>").css({position:"absolute",left:i.left+"px",top:i.top+"px"}).show(b.speed);jQuery("a",a).click(function(){var k=jQuery(this).attr("rel");f.val(k);if(b.inputBG){f.css({background:"#"+k,color:"#"+d(k)})}f.change();a.hide(b.speed);return false});return false})})};