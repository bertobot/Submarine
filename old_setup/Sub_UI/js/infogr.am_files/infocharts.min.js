var InfoCharts=InfoCharts||{};InfoCharts.Visuals=InfoCharts.Visuals||{};InfoCharts.Helper=InfoCharts.Helper||{};InfoCharts.Container=function(){var b=this;var a={canvasWidth:0,canvasHeight:0};b.inner=a;b.options={canvasSelectorId:"",canvasWidth:300,canvasHeight:300,canvasWidthDefault:0,canvasHeightDefault:0,addSpaceButtons:true,addSpaceLabels:true,deepExtend:true,canAnimate:true,canAnimateGrid:false,animationStyle:"bounce",animationStyleGrid:">",canGlowPath:true,canGlowLabel:true,glowStyle:{width:5,opacity:0.6,fill:false},animationDuration:700,animationSequenceDuration:500,resizeCallback:null,loadedCallback:null,errorCallback:null,reThrowException:true,loadDataAsync:true};b.state={visuals:{items:[],counter:0},fontOffsetY:0,originalLoadedCallback:null};b.paper=null;b.options.getOriginalSize=function(){return{width:a.canvasWidth,height:a.canvasHeight}};b.resizeHeight=function(e,c,d){b.options.canvasWidthDefault=a.canvasWidth;b.options.canvasHeightDefault=a.canvasHeight+(b.options.addSpaceButtons?e:0)+(b.options.addSpaceLabels?c:0)+(d||0);b.options.canvasWidth=b.options.canvasWidthDefault;b.options.canvasHeight=b.options.canvasHeightDefault;b.resize(b.options.canvasWidth,b.options.canvasHeight)};b.loadedCallback=function(){b.resize();if(b.state.originalLoadedCallback){b.state.originalLoadedCallback()}};b.init=function(c){if(($.browser.msie&&parseInt($.browser.version,10)<9)){b.state.fontOffsetY=2;b.options.canGlow=false}b.options=$.extend(b.options,c);b.options.canvasWidthDefault=b.options.canvasWidth;b.options.canvasHeightDefault=b.options.canvasHeight;b.state.originalLoadedCallback=b.options.loadedCallback;b.options.loadedCallback=b.loadedCallback;a.canvasWidth=b.options.canvasWidthDefault;a.canvasHeight=b.options.canvasHeightDefault;$("#"+b.options.canvasSelectorId).width(b.options.canvasWidth);$("#"+b.options.canvasSelectorId).height(b.options.canvasHeight);b.paper=Raphael(b.options.canvasSelectorId,b.options.canvasWidth,b.options.canvasHeight);b.bindEvents();return b};b.addVisual=function(g,d,i,h,f,c){if(d){if(!d._labelWrapperOptions){d._labelWrapperOptions=d.legendWrapperOptions}if(!d._labelTextOptions){d._labelTextOptions=d.legendOptions}if(!d._buttonWrapperOptions){d._buttonWrapperOptions=d.buttonWrapperOptions}if(!d._buttonTextOptions){d._buttonTextOptions=d.buttonOptions}}var e=new g(b).init(d);e.loadData(i,h,true,f,c);e.id=++b.state.visuals.counter;b.state.visuals.items.push(e);return e};b.resize=function(d,c){if(typeof(d)==="undefined"&&typeof(c)==="undefined"){if($("#"+b.options.canvasSelectorId).width()!==b.options.canvasWidth||$("#"+b.options.canvasSelectorId).height()!==b.options.canvasHeight){b.paper.setSize(b.options.canvasWidth,b.options.canvasHeight);$("#"+b.options.canvasSelectorId).width(b.options.canvasWidth);$("#"+b.options.canvasSelectorId).height(b.options.canvasHeight);if(b.options.resizeCallback){b.options.resizeCallback({width:b.options.canvasWidth,height:b.options.canvasHeight})}}}else{b.options.canvasWidth=d;b.options.canvasHeight=c}};b.getCenter=function(){return{x:b.options.canvasWidth/2,y:b.options.canvasHeight/2}};b.bindEvents=function(){};b.eventing={};b.getMousePosition=function(d){try{if(!d){d=event}return{x:(d.clientX+$(document).scrollLeft()-$("#"+b.options.canvasSelectorId).offset().left-(parseInt($("#"+b.options.canvasSelectorId).css("padding-left"),10)||0)),y:(d.clientY+$(document).scrollTop()-$("#"+b.options.canvasSelectorId).offset().top-(parseInt($("#"+b.options.canvasSelectorId).css("padding-top"),10)||0))}}catch(c){}return null}};InfoCharts.Helper.Data=new function(){var a=this;a.setAbs=function(b){_.each(b,function(c){c.value=Math.abs(c.value)})};a.getGroups=function(b){return _.uniq(_.reduce(b,function(c,d){c.push(d.group);return c},[]))};a.getActiveData=function(d,c,e){var b=a.getGroups(d);if(c&&b.length>1){e=e||b[0];return _.filter(d,function(f){return f.group==this},e)}else{return d}};a.getLabelsUniq=function(g,h){var f=" | ";var d=[];var c=1;var b=null;var e=null;_.each(g,function(i){b=_.find(d,function(j){return(h?j.name==(i.name+f+i.valueString):j.name==i.name)&&j.color==i.color});if(!b){if(i.name!=""){e={name:i.name,color:i.color,objectId:c};if(h){e.name+=f+i.valueString}d.push(e)}i.objectId=c;c++}else{i.objectId=b.objectId}});return d};a.getPropertyValuesUniq=function(b,c){return _.uniq(_.pluck(b,c))};a.getValueSum=function(b){return _.reduce(b,function(c,d){return c+d.value},0)};a.getValueSumMax=function(d,f){var e=a.getLabelsUniq(d,f);var b=[];for(var c=0;c<e.length;c++){b.push(_.reduce(_.filter(d,function(g){return g.name==e[c].name&&g.color==e[c].color}),function(g,h){return isNaN(g)?h.value:Math.max(g,h.value)},NaN))}return _.reduce(b,function(g,h){return g+h},0)};a.sortByCategory=function(c){var b=_.sortBy(c,function(d){return d.category.toLowerCase()});return b};a.setDefaults=function(b){_.each(b,function(c){c.group=c.group||"";c.category=c.category||"";c.name=c.name||"";c.inValueString=c.inValueString||c.valueString||""})};a.copyDataArray=function(b){if(b){return _.map(b,function(c){return $.extend(true,{},c)})}else{return null}};a.getGridDefinition=function(d,c,e){if(c){return _.find(d,function(f){return e==null||f.group==e}).gridDef}else{var b=[[],[]];_.each(d,function(f){b[0].push(f.gridDef[0]);b[1].push(f.gridDef[1])});return[_.uniq(_.flatten(b[0])),_.uniq(_.flatten(b[1]))]}};a.getAxesTitle=function(b,c){if(b){return _.find(b,function(d){return c==null||d.group==c}).gridDef}else{return[null,null]}};a.transformStackedPoints=function(e,g){forceAbs=typeof(forceAbs)==="undefined"?false:forceAbs;var j=[];_.each(e,function(i){_.each(i.value,function(l){_.each(l,function(m){if(forceAbs){m[1]=Math.abs(m[1])}j.push(m[0])})})});if(g&&g.length>0){j=[];for(var f=0;f<g.length;f++){j.push(g[f])}}var b=false;var c={};if(typeof(j[0])=="number"){j=_.uniq(_.sortBy(j,function(i){return i}),true)}else{j=_.uniq(j);for(var f=0;f<j.length;f++){c[j[f].toString()]=(f+1)}b=true}_.each(e,function(n){for(var m=0;m<n.value.length;m++){var o=[];var p;for(var l=0;l<j.length;l++){p=_.find(n.value[m],function(i){return i[0]===j[l]});if(p){o.push(p)}}n.value[m]=o}});var h=[];if(!b){for(var f=0;f<j.length;f++){h[j[f].toString()]=0}}else{for(var f=0;f<j.length;f++){h[c[j[f].toString()]]=0}}if(b){for(var f=0;f<j.length;f++){j[f]=c[j[f]]}}_.each(e,function(m){m.originalValue=[];for(var p=0;p<m.value.length;p++){var o=m.value[p];m.originalValue.push([]);var q=[];var r=[];var n=$.extend(true,[],o);for(var l=0;l<o.length-1;l++){q.push(o[l]);r.push($.extend(true,[],n[l]));_.each(j,function(i){o[l][0]=typeof(o[l][0])=="number"?o[l][0]:c[o[l][0].toString()];o[l+1][0]=typeof(o[l+1][0])=="number"?o[l+1][0]:c[o[l+1][0].toString()];if(o[l][0]!=o[l+1][0]&&o[l][0]<i&&i<o[l+1][0]){if(o[l][1]==o[l+1][1]){q.push([i,o[l][1],true])}else{q.push([i,o[l][1]+((o[l][0]-i)*(o[l+1][1]-o[l][1])/(o[l][0]-o[l+1][0])),true])}r.push([0,0,true])}})}q.push(o[o.length-1]);r.push($.extend(true,[],n[o.length-1]));m.value[p]=q;m.originalValue[p]=r}});var d={min:NaN,max:NaN};_.each(e,function(i){_.each(i.value,function(m){for(var l=0;l<m.length;l++){m[l]=m[l].slice();m[l][1]=m[l][1]+h[m[l][0].toString()];h[m[l][0].toString()]=m[l][1];d.min=isNaN(d.min)?m[l][1]:Math.min(m[l][1],d.min);d.max=isNaN(d.max)?m[l][1]:Math.max(m[l][1],d.max)}})});var k=[];for(var f=e.length-1;f>=0;f--){k.push(e[f])}return{data:InfoCharts.Helper.Data.copyDataArray(k),minMax:d}};a.transformStreamPoints=function(g,m,b,k){m=m||"center";b=typeof(b)==="undefined"?true:b;var n=[];_.each(g,function(i){_.each(i.value,function(o){_.each(o,function(p){if(b){p[1]=Math.abs(p[1])}n.push(p[0])})})});if(k&&k.length>0){n=[];for(var h=0;h<k.length;h++){n.push(k[h])}}var c=false;var d={};if(typeof(n[0])=="number"){n=_.uniq(_.sortBy(n,function(i){return i}),true)}else{n=_.uniq(n);for(var h=0;h<n.length;h++){d[n[h].toString()]=(h+1)}c=true}_.each(g,function(q){for(var p=0;p<q.value.length;p++){var r=[];var s;for(var o=0;o<n.length;o++){s=_.find(q.value[p],function(i){return i[0]===n[o]});if(s){r.push(s)}}q.value[p]=r}});var l=[];var e={};if(!c){for(var h=0;h<n.length;h++){l[n[h].toString()]=0;e[n[h].toString()]=0}}else{for(var h=0;h<n.length;h++){l[d[n[h].toString()]]=0;e[d[n[h].toString()]]=0}}if(c){for(var h=0;h<n.length;h++){n[h]=d[n[h]]}}_.each(g,function(p){p.originalValue=[];for(var s=0;s<p.value.length;s++){var r=p.value[s];p.originalValue.push([]);var t=[];var u=[];var q=$.extend(true,[],r);for(var o=0;o<r.length-1;o++){t.push(r[o]);u.push($.extend(true,[],q[o]));_.each(n,function(i){r[o][0]=typeof(r[o][0])=="number"?r[o][0]:d[r[o][0].toString()];r[o+1][0]=typeof(r[o+1][0])=="number"?r[o+1][0]:d[r[o+1][0].toString()];if(r[o][0]!=r[o+1][0]&&r[o][0]<i&&i<r[o+1][0]){if(r[o][1]==r[o+1][1]){t.push([i,r[o][1],true])}else{t.push([i,r[o][1]+((r[o][0]-i)*(r[o+1][1]-r[o][1])/(r[o][0]-r[o+1][0])),true])}u.push([0,0,true])}})}t.push(r[r.length-1]);u.push($.extend(true,[],q[r.length-1]));p.value[s]=t;p.originalValue[s]=u}});_.each(g,function(i){_.each(i.value,function(p){for(var o=0;o<p.length;o++){e[p[o][0].toString()]+=p[o][1]}})});var j=0;for(var h=0;h<n.length;h++){e[n[h].toString()]=-e[n[h].toString()]/2;j=Math.max(Math.abs(e[n[h].toString()]),j)}for(var h=0;h<n.length;h++){if(m=="center"){e[n[h].toString()]+=j}else{e[n[h].toString()]=0}}var f={min:0,max:j*2};_.each(g,function(i){i.range=[];_.each(i.value,function(r,o){i.range[o]=[];for(var q=0,p=r.length;q<p;q++){i.range[o][q]=[r[q][0],{bottom:e[r[q][0].toString()],top:e[r[q][0].toString()]+r[q][1]},r[q][2]];r[q][1]=e[r[q][0].toString()]+r[q][1];r.push([r[q][0],e[r[q][0].toString()]]);e[r[q][0].toString()]=i.range[o][q][1].top}})});return{data:g,minMax:f,offset:(m=="center"?j:0)}};return a}();InfoCharts.Helper.Misc=new function(){var a=this;Raphael.el.unbindAll=function(){while(this.events&&this.events.length){var b=this.events.pop();b.unbind()}};a.addProperty=function(c,d,b){c[d]=b;return c};a.constrainValue=function(c,b,d){if(d>b){return b}if(d<c){return c}return d};a.getHoverColor=function(c){var b=Raphael.rgb2hsb(c);if(b.b>0.5){b.b-=0.17}else{b.b+=0.17}return Raphael.hsb2rgb(b).hex};a.parseFontStyle=function(c){var e=$.extend({},c);if(($.browser.msie&&parseInt($.browser.version,10)<9)){var b="'Arial Narrow'";var f=(e["font-size"]||"16")+"px";var d=e["font-weight"]||"normal";delete e["font-family"];delete e["font-size"];delete e["font-weight"];delete e.font;e.font="normal normal "+d+" "+f+" "+b}return e};a.Guid={New:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=Math.random()*16|0,b=e=="x"?d:(d&3|8);return b.toString(16)})},Empty:"00000000-0000-0000-0000-000000000000"};a.forEachDeep=function(d,c){if(d.length){for(var b=0;b<d.length;b++){a.forEachDeep(d[b],c)}}else{c(d)}};a.getContrastColor=function(e,f){if(!f){return e}var b=Raphael.rgb2hsb(e);var c=Raphael.rgb2hsb(f);if(b.h==c.h&&b.s==c.s){var d=Math.abs(b.b-c.b);if(d<0.2){if(b.b>0.5){b.b-=(1-d)}else{b.b+=(1-d)}e=Raphael.hsb2rgb(b).hex}}return e};a.linePathToCurvedPath=function(k,g,f,b){var l=[];if(b){for(var d=0;d<k.length;d++){if(k[d][0]=="LL"&&l.length>0&&(l[l.length-1][0]=="RR"||l[l.length-1][0]=="LL")){if(l[l.length-1][0]=="LL"){l[l.length-1][0]="RR"}l[l.length-1].push(k[d][1],k[d][2])}else{if(l.length>0&&l[l.length-1][0]=="RR"){var e=l[l.length-1];l.push(["LL",e[e.length-2],e[e.length-1]])}l.push(k[d])}}if(l.length>0&&l[l.length-1][0]=="RR"){var e=l[l.length-1];l.push(["LL",e[e.length-2],e[e.length-1]])}}else{l=k}for(var d=0;d<l.length;d++){if(l[d][0].length==2){l[d][0]=l[d][0].charAt(0)}if(f&&l[d][0]=="R"){var h=[];h.push("R");for(var c=(l[d].length-1)/2;c>0;c--){h.push(l[d][c*2-1]);h.push(l[d][c*2])}l[d]=h}}return l};a.toggleData=function(){var b=this};a.addPadding=function(e,b,d){e=e.toString();var c=e.charAt(0)=="-";if(c){e=e.replace("-","")}d=d||"0";return(c?"-":"")+(e.length<b?a.addPadding(d+e,b,d):e)}}();InfoCharts.Visuals.Hierarchy=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},cellTextWrapperOptions:{canRotate:false,text:{labelFontStyle:{"font-size":25,fill:"#FFFFFF"}}},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},showText:true,showValue:false,padding:10,dynamicShape:true,staticShapeSharpTip:true,endType:"asis",direction:"down",type:"fluid"};a.visualSet=null;a.visualSubSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.state={interactionsEnabled:false,actionCounter:0,modifiedTextStyle:null};a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);a.state.modifiedTextStyle=$.extend(true,{},a.options.cellTextWrapperOptions);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(r,y,p,v){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(p){a.data=InfoCharts.Helper.Data.copyDataArray(r);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=r}InfoCharts.Helper.Data.setAbs(a.data);a.animationQueue=[];var x=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var w=InfoCharts.Helper.Data.getGroups(a.data);y=y||w[0]||null;var n=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,y);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var e=0;var x=a.root.getCenter();if(p){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&w.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:y,onClickCallback:a.eventing.onGroupChanged}),w);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:x.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var k=InfoCharts.Helper.Data.getLabelsUniq(n,a.options.hasValueInLabel);if(k.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),k);e=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,e);if(a.labels){a.labels.setPosition({x:x.x,y:a.root.options.canvasHeight-e/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-e});a.background.bb=a.background.getBBox();if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var q=(a.background.bb.height-a.options.padding*2)/n.length;var o;if(a.options.dynamicShape){o=(a.background.bb.width-a.options.padding*2)/_.reduce(n,function(i,A){return Math.max(i,A.value)},0)}else{o=(a.background.bb.width-a.options.padding*2)/(n.length+(a.options.staticShapeSharpTip?0:1))}var x=a.background.bb.width/2;var z=[];var g=null;for(var u=0;u<n.length;u++){var l=n[u];l.valueO=l.value;var h=((u==n.length-1)?(a.options.endType=="asis"?l:{value:0,valueO:0}):n[u+1]);h.valueO=h.value;if(!a.options.dynamicShape){l.valueO=n.length-u+(a.options.staticShapeSharpTip?0:1);h.valueO=n.length-u-1+(a.options.staticShapeSharpTip?0:1);if((u==n.length-1)){if(a.options.endType=="asis"){h.valueO=1+(a.options.staticShapeSharpTip?0:1)}else{}}}var d=null;var j=null;if(a.options.direction=="down"){d=a.createShape(l.valueO*o,h.valueO*o,q,x,l,a.options.type);d.attr({transform:[["T",0,a.background.bb.y+a.options.padding]],opacity:1});j={transform:[["T",0,a.background.bb.y+a.options.padding+u*q]],opacity:1}}else{d=a.createShape(l.valueO*o,h.valueO*o,-q,x,l,a.options.type);d.attr({transform:[["T",0,a.background.bb.y2-a.options.padding]],opacity:1});j={transform:[["T",0,a.background.bb.y2-a.options.padding-u*q]],opacity:1}}if(g!=null){d.insertBefore(g)}g=d;a.visualSet.push(d);var t={data:l,path:d};var c=$.proxy(a.eventing.onMouseOver,t);var s=$.proxy(a.eventing.onMouseOut,t);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+t.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+t.data.objectId,s)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,t));d.mouseout(s);var m=$.proxy(a.afterAnimation,{data:l,shape:d,width:Math.min(l.valueO*o,h.valueO*o)+(Math.max(l.valueO*o,h.valueO*o)-Math.min(l.valueO*o,h.valueO*o))/2*0.5,height:q*0.6,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){z.push({obj:d,anim:Raphael.animation(j,a.root.options.animationDuration,a.root.options.animationStyle,m).delay(((u-1)>0?(u-1):0)/n.length*a.root.options.animationSequenceDuration)})}else{d.attr(j);m()}d.attr($.extend({fill:l.color,stroke:l.color},a.options.shapeStyle))}var f=0;for(var u=0;u<z.length;u++){z[u].obj.stop();z[u].obj.animate(z[u].anim);f=Math.max(f,z[u].anim.ms+z[u].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.createShape=function(g,h,d,c,f,e){switch(e){case"fluid":var i=(g-h)/2;return a.root.paper.path([["M",c-g/2,0],["L",c+g/2,0],["L",c+g/2-i,d],["L",c-g/2+i,d],["Z"]]);break;case"rect":return a.root.paper.path([["M",c-g/2,0],["L",c+g/2,0],["L",c+g/2,d],["L",c-g/2,d],["Z"]]);break}};a.afterAnimation=function(){if((a.options.showValue||a.options.showText)&&this.actionCounter===a.state.actionCounter){a.state.modifiedTextStyle.text.labelFontStyle.fill=InfoCharts.Helper.Misc.getContrastColor(a.options.cellTextWrapperOptions.text.labelFontStyle.fill,this.data.color);var e="";if(a.options.showText&&a.options.showValue){e=this.data.name+" ("+this.data.valueString+")"}else{if(a.options.showText){e=this.data.name}else{if(a.options.showValue){e=this.data.valueString}}}var d=new InfoCharts.Visuals.TextWrapper(a.root).init(a.state.modifiedTextStyle,e,this.width,this.height);var c=this.shape.getBBox();d.setPosition({x:c.x+c.width/2,y:c.y+c.height/2});a.visualSet.push(d.set)}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Progress=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},padding:15,maxValueAuto:false,maxValue:100,backgroundInactive:{fill:"#DFDFDF","stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"}};a.state={interactionsEnabled:false,actionCounter:0};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.animationQueue=[];a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(r,z,q,w){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(q){a.data=InfoCharts.Helper.Data.copyDataArray(r);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=r}InfoCharts.Helper.Data.setAbs(a.data);a.animationQueue=[];var y=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var x=InfoCharts.Helper.Data.getGroups(a.data);z=z||x[0]||null;var o=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,z);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var e=0;var y=a.root.getCenter();if(q){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&x.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:z,onClickCallback:a.eventing.onGroupChanged}),x);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:y.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var j=InfoCharts.Helper.Data.getLabelsUniq(o,a.options.hasValueInLabel);if(j.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),j);e=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,e);if(a.labels){a.labels.setPosition({x:y.x,y:a.root.options.canvasHeight-e/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-e});a.background.bb=a.background.getBBox();var n=a.background.bb;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var A=[];if(a.options.maxValueAuto){a.options.maxValue=_.reduce(o,function(i,B){return i+B.value},0)}var l={x:n.x+a.options.padding,y:n.y+a.options.padding,x2:n.x2-a.options.padding,y2:n.y2-a.options.padding,width:n.width-a.options.padding*2,height:n.height-a.options.padding*2};a.root.paper.rect(l.x,l.y,l.width,l.height).attr(a.options.backgroundInactive);var p=l.width/a.options.maxValue;var u=0;var g=null;for(var v=0;v<o.length;v++){var k=o[v];var d=a.root.paper.rect(l.x,l.y,0,l.height);var h={x:l.x+u*p,width:k.value*p};d.attr($.extend({fill:k.color,stroke:k.color},a.options.shapeStyle));if(g){d.insertBefore(g)}a.visualSet.push(d);var t={data:k,path:d};var c=$.proxy(a.eventing.onMouseOver,t);var s=$.proxy(a.eventing.onMouseOut,t);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+t.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+t.data.objectId,s)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,t));d.mouseout(s);var m=$.proxy(a.afterAnimation,{data:k,shape:d,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){A.push({obj:d,anim:Raphael.animation(h,a.root.options.animationDuration,a.root.options.animationStyle,m).delay(v/o.length*a.root.options.animationSequenceDuration)})}else{d.attr(h);m()}u+=k.value;g=d}var f=0;for(var v=0;v<A.length;v++){A[v].obj.stop();A[v].obj.animate(A[v].anim);f=Math.max(f,A[v].anim.ms+A[v].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.afterAnimation=function(){};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.SemiCircle=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},padding:15,type:"pie",startAngle:90};a.state={interactionsEnabled:false,actionCounter:0};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.animationQueue=[];a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);InfoCharts.Visuals.ShapeGenerator.Anim["pie-"+a.options.type](a.root.paper,"ipg-pie");return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(v,G,u,B){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(u){a.data=InfoCharts.Helper.Data.copyDataArray(v);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=v}InfoCharts.Helper.Data.setAbs(a.data);a.animationQueue=[];var F=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var E=InfoCharts.Helper.Data.getGroups(a.data);G=G||E[0]||null;var q=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,G);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var f=0;var F=a.root.getCenter();if(u){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&E.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:G,onClickCallback:a.eventing.onGroupChanged}),E);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:F.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var k=InfoCharts.Helper.Data.getLabelsUniq(q,a.options.hasValueInLabel);if(k.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),k);f=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,f);if(a.labels){a.labels.setPosition({x:F.x,y:a.root.options.canvasHeight-f/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-f});a.background.bb=a.background.getBBox();if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var H=[];var p=a.background.bb;var m={x:p.x+a.options.padding,y:p.y+a.options.padding,x2:p.x2-a.options.padding,y2:p.y2-a.options.padding,width:p.width-a.options.padding*2,height:p.height-a.options.padding*2};var D=Math.max(_.reduce(q,function(i,r){return Math.max(i,r.value)},0));var c=Math.min(m.width,m.height);var s=c/Math.sqrt(D);var C=m.x+m.width/2;var h=m.y+m.height/2;var o=360/q.length;for(var A=0;A<q.length;A++){var l=q[A];var z=-a.options.startAngle+o*A;if(a.options.type=="pie"){var t=s*Math.sqrt(l.value)/2;var e=a.root.paper.path().attr({"ipg-pie":[C,h,z,z,t]});var j={"ipg-pie":[C,h,z,z-o,t]}}else{var t=s*Math.sqrt(l.value)/2;var y=t*0.5;var e=a.root.paper.path().attr({"ipg-pie":[C,h,t,y,z,z]});var j={"ipg-pie":[C,h,t,y,z,z-o]}}e.attr($.extend({fill:l.color,stroke:l.color},a.options.shapeStyle));a.visualSet.push(e);var x={data:l,path:e};var d=$.proxy(a.eventing.onMouseOver,x);var w=$.proxy(a.eventing.onMouseOut,x);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+x.data.objectId,d);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+x.data.objectId,w)}e.mouseover(d);e.mousemove($.proxy(a.eventing.onMouseMove,x));e.mouseout(w);var n=$.proxy(a.afterAnimation,{data:l,shape:e,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){H.push({obj:e,anim:Raphael.animation(j,a.root.options.animationDuration,a.root.options.animationStyle,n).delay(A/q.length*a.root.options.animationSequenceDuration)})}else{e.attr(j);n()}}var g=0;for(var A=0;A<H.length;A++){H[A].obj.stop();H[A].obj.animate(H[A].anim);g=Math.max(g,H[A].anim.ms+H[A].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},g);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.afterAnimation=function(){};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.PictoBar=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},padding:15,path:"boyPath",showText:true,shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyleEmpty:{"stroke-width":0,"stroke-opacity":0,stroke:"none",fill:"#959595"},cellTextWrapperOptions:{canRotate:false,text:{labelFontStyle:{"font-size":60}}}};a.state={interactionsEnabled:false,actionCounter:0,modifiedTextStyle:null};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.animationQueue=[];a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);a.state.modifiedTextStyle=$.extend(true,{},a.options.cellTextWrapperOptions);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(q,z,p,v){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(p){a.data=InfoCharts.Helper.Data.copyDataArray(q);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=q}a.animationQueue=[];var y=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var w=InfoCharts.Helper.Data.getGroups(a.data);z=z||w[0]||null;var n=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,z);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var e=0;var y=a.root.getCenter();if(p){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&w.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:z,onClickCallback:a.eventing.onGroupChanged}),w);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:y.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var j=InfoCharts.Helper.Data.getLabelsUniq(n,a.options.hasValueInLabel);if(j.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),j);e=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,e);if(a.labels){a.labels.setPosition({x:y.x,y:a.root.options.canvasHeight-e/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-e});a.background.bb=a.background.getBBox();var m=a.background.bb;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var B=[];var k={x:m.x+a.options.padding,y:m.y+a.options.padding,x2:m.x2-a.options.padding,y2:m.y2-a.options.padding,width:m.width-a.options.padding*2,height:m.height-a.options.padding*2};var h=InfoCharts.Visuals.ShapeGenerator.Path[n[0].path||a.options.path];InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(h);if(a.options.showText){a.state.modifiedTextStyle.text.labelFontStyle.fill=n[0].color;var o=new InfoCharts.Visuals.TextWrapper(a.root).init(a.state.modifiedTextStyle,n[0].valueString,k.width/2,k.height);o.bb=o.set.getBBox();o.setPosition({x:k.x2-o.bb.width/2,y:k.y+k.height/2});a.visualSet.push(o.set);k.x2-=o.bb.width+a.options.padding;k.width-=o.bb.width+a.options.padding}pathWidth=k.width/n[0].value[1];var A=Math.min(pathWidth/h.width,k.height/h.height);var t={};t=InfoCharts.Visuals.ShapeGenerator.Func.scalePath(h,A*0.95);var x=0;for(var u=0;u<n[0].value[1];u++){x++;var d=null;if(t.image){d=a.root.paper.image(t.image,0,0,t.width,t.height)}else{d=a.root.paper.path(t.path)}if(t.path){if(x<=n[0].value[0]){d.attr($.extend({fill:n[0].color,stroke:n[0].color},a.options.shapeStyle));var s={data:n[0],path:d};var c=$.proxy(a.eventing.onMouseOver,s);var r=$.proxy(a.eventing.onMouseOut,s);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+s.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+s.data.objectId,r)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,s));d.mouseout(r)}else{d.attr($.extend({fill:n[0].color,stroke:n[0].color},a.options.shapeStyleEmpty))}}if(t.image){if(x<=n[0].value[0]){d.attr({opacity:1})}else{d.attr({opacity:0.1})}}d.attr({transform:[["T",k.x+pathWidth/2+u*pathWidth-t.width/2,k.y+k.height/2-t.height/2],["S",0,0]]});var g={transform:[["T",k.x+pathWidth/2+u*pathWidth-t.width/2,k.y+k.height/2-t.height/2],["S",1,1]]};a.visualSet.push(d);var l=$.proxy(a.afterAnimation,{data:n[0],shape:d,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){B.push({obj:d,anim:Raphael.animation(g,a.root.options.animationDuration,a.root.options.animationStyle,l).delay(u/n[0].value[1]*a.root.options.animationSequenceDuration)})}else{d.attr(g);l()}}var f=0;for(var u=0;u<B.length;u++){B[u].obj.stop();B[u].obj.animate(B[u].anim);f=Math.max(f,B[u].anim.ms+B[u].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.afterAnimation=function(){};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Radial=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},padding:15,shapeStyle:{"stroke-width":3,"stroke-opacity":1},cellTextWrapperOptions:{canRotate:false,text:{labelFontStyle:{"font-size":60}}}};a.state={interactionsEnabled:false,actionCounter:0,modifiedTextStyle:null};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.animationQueue=[];a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);a.state.modifiedTextStyle=$.extend(true,{},a.options.cellTextWrapperOptions);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(f,d,g,q){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(g){a.data=InfoCharts.Helper.Data.copyDataArray(f);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=f}a.animationQueue=[];var e=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var h=InfoCharts.Helper.Data.getGroups(a.data);d=d||h[0]||null;var k=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,d);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var l=0;var e=a.root.getCenter();if(g){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&h.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:d,onClickCallback:a.eventing.onGroupChanged}),h);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:e.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var p=InfoCharts.Helper.Data.getLabelsUniq(k,a.options.hasValueInLabel);if(p.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),p);l=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,l);if(a.labels){a.labels.setPosition({x:e.x,y:a.root.options.canvasHeight-l/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-l});a.background.bb=a.background.getBBox();var r=a.background.bb;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var c=[];var o={x:r.x+a.options.padding,y:r.y+a.options.padding,x2:r.x2-a.options.padding,y2:r.y2-a.options.padding,width:r.width-a.options.padding*2,height:r.height-a.options.padding*2};var n=InfoCharts.Visuals.ShapeGenerator.Path.brainImage;a.visualSet.push(a.root.paper.image(n.image,o.x+o.width/2-n.width/2,o.y+o.height/2-n.height/2,n.width,n.height));var j=0;for(var m=0;m<c.length;m++){c[m].obj.stop();c[m].obj.animate(c[m].anim);j=Math.max(j,c[m].anim.ms+c[m].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},j);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.afterAnimation=function(){};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Textual=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},padding:15,itemMarginBottom:10,showSubText:true,subFontScale:0.5,shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},topTextStyleMaxSize:150,topTextStyle:{"font-size":150,"font-family":"PT Sans Narrow, Arial Narrow","text-anchor":"start",cursor:"default","font-weight":"bold","stroke-width":0,"stroke-opacity":0,stroke:"none"},textWrapperBottomOptions:{canRotate:false,text:{labelFontStyle:{"font-size":60,"stroke-width":0,"stroke-opacity":0,stroke:"none",fill:"#6F6F6F"}},wrapper:{marginX:60*0.075,align:"left"}}};a.state={interactionsEnabled:false,actionCounter:0,modifiedTextStyle:null};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.animationQueue=[];a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);a.state.modifiedTextWrapperTopOptions=$.extend(true,{},a.options.textWrapperTopOptions);a.state.modifiedTextWrapperBottomOptions=$.extend(true,{},a.options.textWrapperBottomOptions);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(p,C,o,w){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(o){a.data=InfoCharts.Helper.Data.copyDataArray(p);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=p}a.animationQueue=[];var B=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var z=InfoCharts.Helper.Data.getGroups(a.data);C=C||z[0]||null;var n=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,C);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var e=0;var B=a.root.getCenter();if(o){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&z.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:C,onClickCallback:a.eventing.onGroupChanged}),z);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:B.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var j=InfoCharts.Helper.Data.getLabelsUniq(n,a.options.hasValueInLabel);if(j.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),j);e=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,e);if(a.labels){a.labels.setPosition({x:B.x,y:a.root.options.canvasHeight-e/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-e});a.background.bb=a.background.getBBox();var m=a.background.bb;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var E=[];var k={x:m.x+a.options.padding,y:m.y+a.options.padding,x2:m.x2-a.options.padding,y2:m.y2-a.options.padding,width:m.width-a.options.padding*2,height:m.height-a.options.padding*2};var A={totalHeight:0,maxTopText:"",hasPicto:false,maxFontSizeTop:a.options.topTextStyleMaxSize,maxFontHeightTop:0,xOffset:0};var y=0;a.options.topTextStyle["font-size"]=A.maxFontSizeTop;for(var v=0;v<n.length;v++){var s=a.root.paper.text(0,0,n[v].value[0]).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.topTextStyle));s.bb=s.getBBox();A.hasPicto=A.hasPicto||(n[v].value[2]!=null);if(s.bb.width>y){A.maxTopText=n[v].value[0]}y=Math.max(s.bb.width,y);s.remove()}do{var s=a.root.paper.text(0,0,A.maxTopText).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.topTextStyle));s.bb=s.getBBox();A.maxFontHeightTop=s.bb.height;A.xOffset=A.hasPicto?A.maxFontHeightTop:0;if(s.bb.width<k.width-A.xOffset){a.options.textWrapperBottomOptions.text.labelFontStyle["font-size"]=A.maxFontSizeTop*a.options.subFontScale;a.options.textWrapperBottomOptions.wrapper.marginX=a.options.textWrapperBottomOptions.text.labelFontStyle["font-size"]*0.1;s.remove();break}s.remove();A.maxFontSizeTop-=2;a.options.topTextStyle["font-size"]=A.maxFontSizeTop}while(A.maxFontSizeTop>1);var y=0;for(var v=0;v<n.length;v++){if(n[v].value[2]){var u={};var h=InfoCharts.Visuals.ShapeGenerator.Path[n[v].value[2]];InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(h);var D=Math.min(A.maxFontHeightTop/h.width,A.maxFontHeightTop/h.height);u.path=Raphael.transformPath(h.path,[["S",D*0.8,D*0.8,0,0]]);InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(u);var d=a.root.paper.path();d.attr($.extend({fill:n[v].color,stroke:n[v].color},a.options.shapeStyle));d.attr({path:u.path,transform:[["T",k.x+A.maxFontHeightTop/2-u.width/2,k.y+A.maxFontHeightTop/2+y-u.height/2,],["S",0,0]]});var t={data:n[v],path:d};var c=$.proxy(a.eventing.onMouseOver,t);var q=$.proxy(a.eventing.onMouseOut,t);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+t.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+t.data.objectId,q)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,t));d.mouseout(q);var g={transform:[["T",k.x+A.maxFontHeightTop/2-u.width/2,k.y+A.maxFontHeightTop/2+y-u.height/2,],["S",1,1]]};var l=$.proxy(a.afterAnimation,{data:n[v],shape:d,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){E.push({obj:d,anim:Raphael.animation(g,a.root.options.animationDuration,a.root.options.animationStyle,l).delay(v/n.length*a.root.options.animationSequenceDuration)})}else{d.attr(g);l()}a.visualSet.push(d)}var s=a.root.paper.text(k.x+A.xOffset,k.y+A.maxFontHeightTop/2+y,n[v].value[0]).attr($.extend({fill:n[v].color,stroke:n[v].color},InfoCharts.Helper.Misc.parseFontStyle(a.options.topTextStyle)));s.bb=s.getBBox();a.visualSet.push(s);var x=0;if(a.options.showSubText){a.options.textWrapperBottomOptions.text.labelFontStyle=$.extend({fill:n[v].color,stroke:n[v].color},a.options.textWrapperBottomOptions.text.labelFontStyle);var r=new InfoCharts.Visuals.TextWrapper(a.root).init(a.options.textWrapperBottomOptions,n[v].value[1],k.width-A.xOffset,300);a.visualSet.push(r.set);r.bb=r.set.getBBox();r.setPosition({x:k.x+A.xOffset,y:k.y+A.maxFontHeightTop+r.bb.height/2+y});x=r.bb.height}y+=s.bb.height+x+a.options.itemMarginBottom}a.root.resizeHeight(a.buttonHeight,e,y+a.options.padding*2);if(a.labels){a.labels.setPosition({x:B.x,y:a.root.options.canvasHeight-e/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-e});var f=0;for(var v=0;v<E.length;v++){E[v].obj.stop();E[v].obj.animate(E[v].anim);f=Math.max(f,E[v].anim.ms+E[v].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.afterAnimation=function(){};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.DateTime=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},dotStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none",fill:"#444444"},fontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","text-anchor":"end",cursor:"default","font-weight":"bold","stroke-width":0,"stroke-opacity":0,stroke:"none"},fontStyleText:{"font-family":"PT Sans Narrow, Arial Narrow","text-anchor":"center",cursor:"default",fill:"#6F6F6F","stroke-width":0,"stroke-opacity":0,stroke:"none"},padding:15,spaceing:20,textMarginTop:5,showSubText:true,valuesToShow:{years:true,month:true,days:true,hours:true,minutes:true,seconds:true},timerItemNames:["Years","Month","Days","Hours","Minutes","Seconds"],timerItemNamesAsIs:["Year","Month","Day","Hours","Minutes","Seconds"]};a.state={interactionsEnabled:false,actionCounter:0};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.animationQueue=[];a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(r,B,q,v){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(q){a.data=InfoCharts.Helper.Data.copyDataArray(r);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=r}a.animationQueue=[];var A=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var w=InfoCharts.Helper.Data.getGroups(a.data);B=B||w[0]||null;var p=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,B);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var e=0;var A=a.root.getCenter();if(q){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&w.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:B,onClickCallback:a.eventing.onGroupChanged}),w);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:A.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var h=InfoCharts.Helper.Data.getLabelsUniq(p,a.options.hasValueInLabel);if(h.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),h);e=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,e);if(a.labels){a.labels.setPosition({x:A.x,y:a.root.options.canvasHeight-e/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-e});a.background.bb=a.background.getBBox();if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var D=[];var o=a.background.bb;var n={x:o.x+a.options.padding,y:o.y+a.options.padding,x2:o.x2-a.options.padding,y2:o.y2-a.options.padding,width:o.width-a.options.padding*2,height:o.height-a.options.padding*2};var c=a.options.valuesToShow.years+a.options.valuesToShow.month+a.options.valuesToShow.days+a.options.valuesToShow.hours+a.options.valuesToShow.minutes+a.options.valuesToShow.seconds;var y=p[0].value.search(/\[up\]/g)>-1?"up":(p[0].value.search(/\[down\]/g)>-1?"down":"asis");var g=(n.width-a.options.spaceing*(c-1))/(c+(y=="asis"?1:0));var t=200;var l=0;var x=0;do{a.options.fontStyle["font-size"]=t;var s=a.root.paper.text(0,0,"00").attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.fontStyle));s.bb=s.getBBox();if(s.bb.width<=g&&s.bb.height<=n.height){l=s.bb.width;x=s.bb.height;s.remove();break}s.remove();t-=2}while(t>1);if(a.timer){if(a.timer.timer){clearInterval(a.timer.timer)}for(var u=0;u<a.timerItems.length;u++){var C=a.timerItems[u];if(a.timer.shape[C]){a.timer.shape[C].stop();a.timer.shape[C].remove()}}}a.timer={timer:y!="asis"?setInterval(a.onTick,1000):null,dirty:{years:0,month:0,days:0,hours:0,minutes:0,seconds:0},dateTime:new Date(p[0].value.replace("["+y+"]","")),direction:y,value:{},valuePrev:{},shape:{},textWidth:l,y:n.y+n.height/2,x:n.x+(n.width-(l*c+a.options.spaceing*(c-1)))/2+l+((y=="asis"&&a.options.valuesToShow.years)?l/2:0),style:$.extend({fill:p[0].color,stroke:p[0].color},a.options.fontStyle)};if(a.options.showSubText){t=30;var j=_.reduce(a.options.timerItemNames,function(i,z){return z.length>i.length?z:i},"");var d=0;do{a.options.fontStyleText["font-size"]=t;var s=a.root.paper.text(0,0,j).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.fontStyleText));s.bb=s.getBBox();if(s.bb.width<=l){d=s.bb.height;s.remove();break}s.remove();t-=2}while(t>1)}var u=0;for(var k=0;k<a.timerItems.length;k++){if(a.options.valuesToShow[a.timerItems[k]]){if(a.options.showSubText){var m=y=="asis"?a.options.timerItemNamesAsIs[k]:a.options.timerItemNames[k];a.visualSet.push(a.root.paper.text(a.timer.x+u*(a.timer.textWidth+a.options.spaceing)-a.timer.textWidth/2,a.timer.y+x/2+a.options.textMarginTop,m).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.fontStyleText)))}if(u<c-1){if(y=="asis"){if(k>2&&k<5){a.visualSet.push(a.root.paper.rect(Math.round(a.timer.x+u*(a.timer.textWidth+a.options.spaceing)+a.options.spaceing/2-6/2),Math.round(a.timer.y-6),6,6).attr(a.options.dotStyle));a.visualSet.push(a.root.paper.rect(Math.round(a.timer.x+u*(a.timer.textWidth+a.options.spaceing)+a.options.spaceing/2-6/2),Math.round(a.timer.y+6),6,6).attr(a.options.dotStyle))}if(k<2){a.visualSet.push(a.root.paper.rect(Math.round(a.timer.x+u*(a.timer.textWidth+a.options.spaceing)+a.options.spaceing/2-6/2),Math.round(a.timer.y+x/4),6,6).attr(a.options.dotStyle))}}else{a.visualSet.push(a.root.paper.rect(Math.round(a.timer.x+u*(a.timer.textWidth+a.options.spaceing)+a.options.spaceing/2-6/2),Math.round(a.timer.y-6),6,6).attr(a.options.dotStyle));a.visualSet.push(a.root.paper.rect(Math.round(a.timer.x+u*(a.timer.textWidth+a.options.spaceing)+a.options.spaceing/2-6/2),Math.round(a.timer.y+6),6,6).attr(a.options.dotStyle))}}u++}}if(a.options.showSubText){a.root.resizeHeight(a.buttonHeight,e,d+a.options.textMarginTop);if(a.labels){a.labels.setPosition({x:A.x,y:a.root.options.canvasHeight-e/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-e})}a.onTick();var f=0;for(var u=0;u<D.length;u++){D[u].obj.stop();D[u].obj.animate(D[u].anim);f=Math.max(f,D[u].anim.ms+D[u].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}setTimeout(function(){a.onTick()},1)};a.afterAnimation=function(){};a.timer=null;a.timerItems=["years","month","days","hours","minutes","seconds"];a.onTick=function(){switch(a.timer.direction){case"up":var g=new Date(Math.max(0,new Date()-a.timer.dateTime));break;case"down":var g=new Date(Math.max(0,a.timer.dateTime-new Date()));break;case"asis":var g=a.timer.dateTime;break}if(a.timer.direction=="asis"){a.timer.value={years:g.getFullYear(),month:g.getMonth()+1,days:g.getDate(),hours:g.getHours(),minutes:g.getMinutes(),seconds:g.getSeconds()}}else{a.timer.value={years:-1970+g.getUTCFullYear(),month:g.getUTCMonth(),days:-1+g.getUTCDate(),hours:g.getUTCHours(),minutes:g.getUTCMinutes(),seconds:g.getUTCSeconds()}}var e=0;for(var f=0;f<a.timerItems.length;f++){if(a.options.valuesToShow[a.timerItems[f]]){var c=a.timerItems[f];a.timer.dirty[c]=a.timer.value[c]!=a.timer.valuePrev[c];if(a.timer.dirty[c]){if(a.timer.shape[c]){a.timer.shape[c].stop();a.timer.shape[c].remove()}a.timer.shape[c]=a.root.paper.text(a.timer.x+e*(a.timer.textWidth+a.options.spaceing),a.timer.y,InfoCharts.Helper.Misc.addPadding(a.timer.value[c],2)).attr(InfoCharts.Helper.Misc.parseFontStyle(a.timer.style));if(a.root.options.canAnimate){a.timer.shape[c].attr({opacity:0});a.timer.shape[c].animate({opacity:1},600,a.root.options.animationStyle)}}e++}}a.timer.valuePrev=$.extend({},a.timer.value)};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Histogram=function(b){var a=this;a.root=b;a.options={showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,absoluteDistribution:false,gridPostOptions:{gridToFront:false,labelsToFront:false,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-opacity":0,"stroke-width":0,stroke:"none"},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},_gridOptions:{forceDataMargin:true},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyleUp:{"stroke-width":0,"stroke-opacity":0,fill:"#74CE33",stroke:"none"},shapeStyleDown:{"stroke-width":0,"stroke-opacity":0,fill:"#CD3736",stroke:"none"},barPercentage:0.7,style:"bar-bar",guidPathShow:false,guidPathStyle:{"stroke-width":2,"stroke-opacity":1,stroke:"#959595"},guidSizeFull:true};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.gridDef=null;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);if(a.options.smooth){a.options.complexAnimations=false}return a};a.state={currentState:{line:{path:null,attr:null},points:[]},newState:{line:{path:null,attr:null},points:[]},minMax:null,interactionsEnabled:false,axesTitle:null,miscTimer:null};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(P,r,x,O,t){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(x){a.data=InfoCharts.Helper.Data.copyDataArray(P);if(a.options.increment){_.each(a.data,function(R){for(var g=0;g<R.value.length;g++){set=R.value[g];var Q=[];var i=0;i=R.startValue;if(a.options.incrementShowStart){Q.push([R.startValueX,R.startValue])}_.each(set,function(S){i+=S[1];S[2]=S[1];S[1]=i;Q.push(S)});if(a.options.incrementShowEnd){Q.push([R.endValueX,i])}R.value[g]=Q}})}if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(O);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(t)}else{a.data=P}var d=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var k=InfoCharts.Helper.Data.getGroups(a.data);r=r||k[0]||null;var B=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,r);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,r)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,r);if(a.state.miscTimeout!=null){clearTimeout(a.state.miscTimeout);a.state.miscTimeout=null}_.each(a.visualSet,function(g){g.stop()});a.visualSet.remove();a.visualSet=a.root.paper.set();var I=0;var d=a.root.getCenter();if(x){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&k.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:r,onClickCallback:a.eventing.onGroupChanged}),k);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:d.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var o=InfoCharts.Helper.Data.getLabelsUniq(B);if(o.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),o);I=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,I);if(a.labels){a.labels.setPosition({x:d.x,y:a.root.options.canvasHeight-I/2})}if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var s=0;var q=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){s=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){q=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}a.background.attr({x:0+s,y:a.buttonHeight,width:a.root.options.canvasWidth-s*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),height:a.root.options.canvasHeight-a.buttonHeight-I-q});a.background.bb=a.background.getBBox();if(s){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:s/2,y:a.background.bb.y+a.background.bb.height/2})}if(q){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+q/2})}var e=null;e={};e.minMax={min:NaN,max:NaN};a.state.minMax=e.minMax;a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[s,a.buttonHeight],size:[a.root.options.canvasWidthDefault-s*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-I-q],offset:[{start:0,end:0},{start:0,end:0}],minMax:[{min:NaN,max:NaN},a.state.minMax],canResize:false}),a.options.absoluteDistribution?a.data:B);if(e.data){B=e.data}a.grid.createGrid();if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var l=[];var E=0;var G=a.options.absoluteDistribution?a.data:B;for(var N=0;N<G.length;N++){for(var L=0;L<G[N].value[0].length;L++){l.push(G[N].value[0][L][0])}}E=_.uniq(l).length;var w=(a.root.options.canvasWidthDefault-s*(a.options.axesTitleBalanceHorizontalSpaceing?2:1))/(E+1)*a.options.barPercentage/B.length;var j=[];var m=a.grid.getGridPositionBase();var K=a.grid.getGridPosition([0,0]);var D=[a.options.styleUp,a.options.styleDown];var h=[];for(var N=0;N<D.length;N++){var z=D[N]||a.options.style;h[N]="ipg-"+z;if(InfoCharts.Visuals.ShapeGenerator.Anim[z]){InfoCharts.Visuals.ShapeGenerator.Anim[z](a.root.paper,h[N])}else{z=z.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path"](a.root.paper,h[N],z)}}var v=[];for(var N=0;N<B.length;N++){var z=B[N].styleName||a.options.style;var y="ipg-"+z;if(InfoCharts.Visuals.ShapeGenerator.Anim[z]){InfoCharts.Visuals.ShapeGenerator.Anim[z](a.root.paper,y)}else{z=z.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path"](a.root.paper,y,z)}var J=y;for(var L=0;L<B[N].value[0].length;L++){var H=B[N].value[0][L];var n=a.root.paper.path();if(a.options.increment&&H[2]!=null){y=h[H[2]>0?0:1];var p={data:{name:B[N].name,valueString:H[2].toString(),objectId:B[N].objectId},path:n}}else{y=J;var p={data:{name:B[N].name,valueString:H[1].toString(),objectId:B[N].objectId},path:n}}var M=a.grid.getPositionAuto(H);var f=a.grid.getPositionAuto([H[0],H[2]]);var u=$.proxy(a.eventing.onMouseOver,p);var A=$.proxy(a.eventing.onMouseOut,p);if(a.options.increment&&H[2]!=null){if(H[2]>0){n.attr(a.options.shapeStyleUp)}else{n.attr(a.options.shapeStyleDown)}}else{n.attr($.extend({fill:B[N].color,stroke:B[N].color},a.options.shapeStyle));if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+p.data.objectId,u);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+p.data.objectId,A)}}n.mouseover(u);n.mousemove($.proxy(a.eventing.onMouseMove,p));n.mouseout(A);n.attr(InfoCharts.Helper.Misc.addProperty({},y,[M[0].value+w/2-(w*B.length)/2+w*N,m[1].value,w,0]));a.visualSet.push(n);if(a.options.increment&&H[2]!=null){var F=InfoCharts.Helper.Misc.addProperty({},y,[M[0].value+w/2-(w*B.length)/2+w*N,M[1].value+(K[1].value-f[1].value),w,f[1].value-K[1].value]);v.push({x:M[0].value+w/2-(w*B.length)/2+w*N,y:M[1].value+(K[1].value-f[1].value)+f[1].value-K[1].value})}else{var F=InfoCharts.Helper.Misc.addProperty({},y,[M[0].value+w/2-(w*B.length)/2+w*N,m[1].value,w,M[1].value-m[1].value]);v.push({x:M[0].value+w/2-(w*B.length)/2+w*N,y:m[1].value+M[1].value-m[1].value})}var c=$.proxy(a.afterAnimation,{data:B[N],shape:n,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){j.push({obj:n,anim:Raphael.animation(F,a.root.options.animationDuration,a.root.options.animationStyle,c).delay(L/B[N].value[0].length*a.root.options.animationSequenceDuration)})}else{n.attr(F);c()}}}a.grid.postDisplayMods(a.options.gridPostOptions);var C=0;for(var L=0;L<j.length;L++){j[L].obj.stop();j[L].obj.animate(j[L].anim);C=Math.max(C,j[L].anim.ms+j[L].anim.del)}if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}setTimeout(function(){a.state.interactionsEnabled=true},C);if(a.options.guidPathShow){a.state.miscTimeout=setTimeout(function(){var R=a.options.guidSizeFull?w/2:0;var g;for(var Q=0;Q<(v.length-1);Q++){g=a.root.paper.path([["M",v[Q].x-R,Math.round(v[Q].y)],["L",v[Q+1].x+R,Math.round(v[Q].y)]]);g.attr(a.options.guidPathStyle);a.visualSet.push(g)}},C)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.afterAnimation=function(){};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Waterfall=function(b){var a=new InfoCharts.Visuals.Histogram(b);a.options.increment=true;a.options.incrementShowStart=true;a.options.incrementShowEnd=true;a.options.styleUp="bar-bar";a.options.styleDown="bar-bar";a.options.guidPathShow=false;a.options.guidPathStyle={"stroke-width":2,"stroke-opacity":1,stroke:"#959595"};a.options.guidSizeFull=true;return a};InfoCharts.Visuals.Candle=function(b){var a=this;a.root=b;a.options={showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,absoluteDistribution:false,gridPostOptions:{gridToFront:false,labelsToFront:false,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-opacity":0,"stroke-width":0,stroke:"none"},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},_gridOptions:{forceDataMargin:true},shapeStyleUp:{"stroke-opacity":1},shapeStyleDown:{"stroke-opacity":1,fill:"#ffffff"},lineStyleUp:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},lineStyleDown:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},barPercentage:0.7,style:"bar-bar",styleUp:"bar-bar",styleDown:"bar-bar",lineWidth:2,lineWidthDeviation:2,showDeviation:true,valueFormat:"High: {high}, Low: {low}, Open: {open}, Close: {close}"};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.gridDef=null;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);if(a.options.smooth){a.options.complexAnimations=false}return a};a.state={currentState:{line:{path:null,attr:null},points:[]},newState:{line:{path:null,attr:null},points:[]},minMax:null,interactionsEnabled:false,axesTitle:null};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(T,t,y,S,v){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(y){a.data=InfoCharts.Helper.Data.copyDataArray(T);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(S);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(v)}else{a.data=T}var d=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var l=InfoCharts.Helper.Data.getGroups(a.data);t=t||l[0]||null;var C=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,t);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,t)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,t);_.each(a.visualSet,function(g){g.stop()});a.visualSet.remove();a.visualSet=a.root.paper.set();var K=0;var d=a.root.getCenter();if(y){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&l.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:t,onClickCallback:a.eventing.onGroupChanged}),l);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:d.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var q=InfoCharts.Helper.Data.getLabelsUniq(C);if(q.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),q);K=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,K);if(a.labels){a.labels.setPosition({x:d.x,y:a.root.options.canvasHeight-K/2})}if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var u=0;var s=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){u=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){s=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}a.background.attr({x:0+u,y:a.buttonHeight,width:a.root.options.canvasWidth-u*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),height:a.root.options.canvasHeight-a.buttonHeight-K-s});a.background.bb=a.background.getBBox();if(u){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:u/2,y:a.background.bb.y+a.background.bb.height/2})}if(s){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+s/2})}a.state.minMax={min:NaN,max:NaN};_.each(C,function(i){for(var g=0;g<i.value.length;g++){_.each(i.value[g],function(X){var W=Math.min(X[2],X[3],X[4],X[5]);var p=Math.max(X[2],X[3],X[4],X[5]);a.state.minMax.min=isNaN(a.state.minMax.min)?W:Math.min(a.state.minMax.min,W);a.state.minMax.max=isNaN(a.state.minMax.max)?p:Math.max(a.state.minMax.max,p)})}});var e=null;e={};e.minMax={min:NaN,max:NaN};a.state.minMax=a.state.minMax||e.minMax;a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[u,a.buttonHeight],size:[a.root.options.canvasWidthDefault-u*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-K-s],offset:[{start:0,end:0},{start:0,end:0}],minMax:[{min:NaN,max:NaN},a.state.minMax],canResize:false}),a.options.absoluteDistribution?a.data:C);if(e.data){C=e.data}a.grid.createGrid();if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var m=[];var G=0;var I=a.options.absoluteDistribution?a.data:C;for(var R=0;R<I.length;R++){for(var P=0;P<I[R].value[0].length;P++){m.push(I[R].value[0][P][0])}}G=_.uniq(m).length;var x=(a.root.options.canvasWidthDefault-u*(a.options.axesTitleBalanceHorizontalSpaceing?2:1))/(G+1)*a.options.barPercentage/C.length;var j=[];var n=a.grid.getGridPositionBase();var E=[a.options.styleUp,a.options.styleDown,"bar-bar"];var h=[];for(var R=0;R<E.length;R++){var A=E[R]||a.options.style;h[R]="ipg-"+A;if(InfoCharts.Visuals.ShapeGenerator.Anim[A]){InfoCharts.Visuals.ShapeGenerator.Anim[A](a.root.paper,h[R])}else{A=A.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path"](a.root.paper,h[R],A)}}a.options.shapeStyleUp["stroke-width"]=a.options.lineWidth;a.options.shapeStyleDown["stroke-width"]=a.options.lineWidth;for(var R=0;R<C.length;R++){var A=C[R].styleName||a.options.style;var z=null;if(A!=null){z="ipg-"+A;if(InfoCharts.Visuals.ShapeGenerator.Anim[A]){InfoCharts.Visuals.ShapeGenerator.Anim[A](a.root.paper,z)}else{A=A.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path"](a.root.paper,z,A)}}var L=z;for(var M=0;M<C[R].value.length;M++){for(var P=0;P<C[R].value[M].length;P++){var J=C[R].value[M][P];var o=a.root.paper.path();var O=J[2]-J[3]>0;z=(L!=null?L:(h[J[2]-J[3]>0?0:1]));var V=a.options.valueFormat.replace("{high}",J[4].toString()).replace("{low}",J[5].toString()).replace("{open}",J[3].toString()).replace("{close}",J[2].toString());var r={data:{name:C[R].name,valueString:V,objectId:C[R].objectId},path:o};var Q=a.grid.getPositionAuto([J[0],J[2]]);var f=a.grid.getPositionAuto([J[0],J[3]]);var w=$.proxy(a.eventing.onMouseOver,r);var B=$.proxy(a.eventing.onMouseOut,r);o.attr($.extend({fill:C[R].color,stroke:C[R].color},O?a.options.shapeStyleUp:a.options.shapeStyleDown));if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+r.data.objectId,w);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+r.data.objectId,B)}o.mouseover(w);o.mousemove($.proxy(a.eventing.onMouseMove,r));o.mouseout(B);o.attr(InfoCharts.Helper.Misc.addProperty({},z,[Q[0].value+x/2-(x*C.length)/2+x*R,n[1].value,x,0]));a.visualSet.push(o);var H=InfoCharts.Helper.Misc.addProperty({},z,[Q[0].value+x/2-(x*C.length)/2+x*R,f[1].value,x-a.options.lineWidth,Q[1].value-f[1].value]);var k=a.root.paper.path();a.visualSet.push(k);if(a.options.showDeviation){var U=a.grid.getPositionAuto([J[0],J[4]]);var N=a.grid.getPositionAuto([J[0],J[5]]);var F=InfoCharts.Helper.Misc.addProperty($.extend({fill:C[R].color,stroke:C[R].color,opacity:0},O?a.options.lineStyleUp:a.options.lineStyleDown),"ipg-bar-bar",[Q[0].value+x/2-(x*C.length)/2+x*R,N[1].value,a.options.lineWidthDeviation,U[1].value-N[1].value]);k.attr(F);k.insertBefore(o)}var c=$.proxy(a.afterAnimation,{data:C[R],shape:o,line:k,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){j.push({obj:o,anim:Raphael.animation(H,a.root.options.animationDuration,a.root.options.animationStyle,c).delay(P/C[R].value[M].length*a.root.options.animationSequenceDuration)})}else{o.attr(H);c()}}}}a.grid.postDisplayMods(a.options.gridPostOptions);var D=0;for(var P=0;P<j.length;P++){j[P].obj.stop();j[P].obj.animate(j[P].anim);D=Math.max(D,j[P].anim.ms+j[P].anim.del)}if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}setTimeout(function(){a.state.interactionsEnabled=true},D);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.afterAnimation=function(){this.line.attr({opacity:1})};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Wordcloud=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,showTooltip:false,randomRotate:false,highlightLegendItem:true,spiralDelta:3,spiralStep:2,useSpiralPool:false,sortData:true,wordcloudScale:0.95,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},fontStyle:{"font-family":"Arial","font-size":25,"font-weight":"bold","text-anchor":"middle"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.state={};a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(u,M,t,D){if(t){a.data=InfoCharts.Helper.Data.copyDataArray(u);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=u}var K=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var J=InfoCharts.Helper.Data.getGroups(a.data);M=M||J[0]||null;if(t&&a.options.sortData){a.data=_.sortBy(a.data,function(i){return -i.value})}var q=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,M);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var d=0;var K=a.root.getCenter();if(t){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&J.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:M,onClickCallback:a.eventing.onGroupChanged}),J);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:K.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var j=InfoCharts.Helper.Data.getLabelsUniq(q,a.options.hasValueInLabel);if(j.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),j);d=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,d);if(a.labels){a.labels.setPosition({x:K.x,y:a.root.options.canvasHeight-d/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-d});a.background.bb=a.background.getBBox();var H=a.background.bb.x+a.background.bb.width/2,h=a.background.bb.y+a.background.bb.height/2,o,m;var e=[];var s=null;var z=null;var E=null;var l=Math.sqrt(_.reduce(q,function(i,p){return Math.max(i,p.value)},0));var N=0;var A;var k={};var g=InfoCharts.Helper.Misc.parseFontStyle($.extend(true,{},a.options.fontStyle));var O=[];for(var L=0;L<q.length;L++){var B=q[L];o=H;m=h;s=a.root.paper.text(0,0,B.valueString);N=(Math.sqrt(B.value)/l);g.fill=B.color;s.attr(g);if(a.options.randomRotate){B.rotate=Math.random()>0.5?0:-90}else{B.rotate=typeof(B.rotate)==="undefined"?0:B.rotate}s.transform([["T",o,m],["R",B.rotate],["S",N,N]]);s.hide();E=$.extend(true,{},s.getBBox());if(E.x>E.x2||E.y>E.y2){E.x=H-E.width/2;E.y=h-E.height/2;E.x2=E.x+E.width;E.y2=E.y+E.height}z=$.extend(true,{},E);if(e.length!=0){var C=a.options.useSpiralPool?(k[B.value.toString()]||0.5):0.5;for(;true;C+=a.options.spiralStep/C){var r=true;for(var w=0;w<e.length;w++){if(Raphael.isBBoxIntersect(E,e[w])){r=false;break}}if(r){B.dx=o;B.dy=m;B.scale=N;s.transform([["T",H+o,h+m],["R",B.rotate],["S",N,N]]);break}else{o=a.options.spiralDelta*C*Math.cos(C);m=a.options.spiralDelta*(C*a.background.bb.height/a.background.bb.width)*Math.sin(C);E.x=z.x+o;E.y=z.y+m;E.x2=z.x2+o;E.y2=z.y2+m}}if(a.options.useSpiralPool){k[B.value.toString()]=C}}else{B.dx=0;B.dy=0;B.scale=N}a.visualSet.push(s);e.push(E)}var f=a.visualSet.getBBox();var N=Math.min(a.background.bb.width/f.width,a.background.bb.height/f.height)*a.options.wordcloudScale;var I=((f.x+f.width/2)-H);var G=((f.y+f.height/2)-h);a.visualSet.remove();a.visualSet=a.root.paper.set();if(a.options.highlightLegendItem){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}for(var L=0;L<q.length;L++){var B=q[L];o=H+(B.dx-I)*N;m=h+(B.dy-G)*N;s=a.root.paper.text(0,0,B.valueString);if(a.root.options.canAnimate){s.attr({opacity:0})}g.fill=B.color;s.attr(g);s.transform([["T",o,m],["R",B.rotate],["S",B.scale*N,B.scale*N]]);a.visualSet.push(s);var n=s.getBBox();var F=a.root.paper.rect(n.x,n.y,n.width,n.height).attr({opacity:0,fill:"#FFFFFF"});A={data:{name:B.name,valueString:B.value.toString(),objectId:B.objectId},path:null};var c=$.proxy(a.eventing.onMouseOver,A);var v=$.proxy(a.eventing.onMouseOut,A);F.unbindAll();F.mouseover(c);F.mousemove($.proxy(a.eventing.onMouseMove,A));F.mouseout(v);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+A.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+A.data.objectId,v)}a.visualSet.push(F);s.attr({fill:B.color});if(a.root.options.canAnimate){O.push({obj:s,anim:Raphael.animation({opacity:1},a.root.options.animationDuration,a.root.options.animationStyle).delay(a.root.options.animationDuration*L/q.length)})}}for(var C=0;C<O.length;C++){O[C].obj.stop();O[C].obj.animate(O[C].anim)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.tooltip!=null){if(this.path){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]})}a.tooltip.dispose();a.tooltip=null}if(this.path){a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}},onMouseMove:function(c){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}},onMouseOut:function(c){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}if(this.path){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]})}if(a.options.highlightLegendItem&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Pictosize=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,hasGroups:true,showGroups:true,showLabels:true,showTooltip:true,highlightLegendItem:true,padding:15,pictoMargin:15,panelMarginY:15,defaultPath:"boyPath",align:"middle",fluidTransition:true,showInLineValues:false,inTextStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":22},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},autoResizeCanvas:false};a.state={currentState:[],interactionsEnabled:false,actionCounter:0,inTextStyleFontSize:0};a.visualSet=null;a.visualSubSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.state.inTextStyleFontSize=a.options.inTextStyle["font-size"];a.visualSet=a.root.paper.set();a.visualSubSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(Q,r,v,P){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(v){a.data=InfoCharts.Helper.Data.copyDataArray(Q);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=Q}InfoCharts.Helper.Data.setAbs(a.data);InfoCharts.Helper.Data.setDefaults(a.data);_.each(a.data,function(i){i.pathName=i.pathName||a.options.defaultPath});var l=InfoCharts.Helper.Data.getGroups(a.data);r=r||l[0]||null;var C=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,r);a.visualSet.remove();a.visualSet=a.root.paper.set();_.each(a.visualSubSet,function(i){i.stop()});a.visualSubSet.remove();a.visualSubSet=a.root.paper.set();var K=0;var d=a.root.getCenter();if(v){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.showGroups&&a.options.hasGroups&&l.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:r,onClickCallback:a.eventing.onGroupChanged}),l);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:d.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var p=InfoCharts.Helper.Data.getLabelsUniq(C,a.options.hasValueInLabel);if(p.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),p);K=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,K);if(a.labels){a.labels.setPosition({x:d.x,y:a.root.options.canvasHeight-K/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-K-a.buttonHeight});a.background.bb=a.background.getBBox();var z=InfoCharts.Visuals.ShapeGenerator.Path;var O=InfoCharts.Helper.Data.getPropertyValuesUniq(C,"pathName");var J=(a.background.bb.width-a.options.padding*2-C.length*a.options.pictoMargin*2);var w=(a.background.bb.height-a.options.padding*2-1*a.options.pictoMargin*2);var s=NaN;var j=NaN;var g={};for(var N=0;N<O.length;N++){InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(z[O[N]]);s=isNaN(s)?z[O[N]].width:Math.min(s,z[O[N]].width);j=isNaN(j)?z[O[N]].height:Math.min(j,z[O[N]].height);if(!g[O[N]]){g[O[N]]={}}}for(var N=0;N<O.length;N++){var A=Math.max(s/z[O[N]].width,j/z[O[N]].height);g[O[N]]=InfoCharts.Visuals.ShapeGenerator.Func.scalePath(z[O[N]],A)}var m=0;var e=0;for(var N=0;N<C.length;N++){m=Math.max(m,g[C[N].pathName].height*Math.sqrt(C[N].value));e+=g[C[N].pathName].width*Math.sqrt(C[N].value)}var o=Math.min(J/e,w/m);if(a.options.autoResizeCanvas){if(o==(J/e)){a.root.resizeHeight(a.buttonHeight,K,(o*m+a.options.pictoMargin*2+a.options.padding*2)-(a.root.inner.canvasHeight));if(a.labels){a.labels.setPosition({x:d.x,y:a.root.options.canvasHeight-K/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-K-a.buttonHeight});a.background.bb=a.background.getBBox()}}if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var G=a.options.padding;var F=a.background.bb.height/2+a.buttonHeight;var L,t;for(var N=0;N<C.length;N++){var D=o*Math.sqrt(C[N].value);if(g[C[N].pathName].image){L=a.root.paper.image(g[C[N].pathName].image,0,0,g[C[N].pathName].width,g[C[N].pathName].height);t=a.root.paper.image(g[C[N].pathName].image,0,0,g[C[N].pathName].width,g[C[N].pathName].height)}else{L=a.root.paper.path(g[C[N].pathName].path);t=a.root.paper.path(g[C[N].pathName].path)}G+=a.options.pictoMargin;L.attr({opacity:0});L.transform([["S",D,D,0,0],["T",G,F-g[C[N].pathName].height/2*D]]);t.attr({opacity:0});t.transform([["S",D,D,0,0],["T",G,F-g[C[N].pathName].height/2*D]]);a.visualSet.push(t);a.visualSubSet.push(L);if(C[N].name&&C[N].name!=""&&g[C[N].pathName].path){var q={data:C[N],path:L};var u=$.proxy(a.eventing.onMouseOver,q);var B=$.proxy(a.eventing.onMouseOut,q);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+q.data.objectId,u);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+q.data.objectId,B)}L.mouseover(u);L.mousemove($.proxy(a.eventing.onMouseMove,q));L.mouseout(B)}C[N].tempPath=L;C[N].tempScale=D;G+=a.options.pictoMargin+g[C[N].pathName].width*D}var n=a.visualSet.getBBox();a.visualSet.remove();G=(a.root.options.canvasWidth-n.width)/2;switch(a.options.align){case"middle":F=a.background.bb.y+a.background.bb.height/2;break;case"top":F=a.background.bb.y+(a.background.bb.height-n.height)/2;break;case"bottom":F=a.background.bb.y2-(a.background.bb.height-n.height)/2;break}var k=[];for(var N=0;N<C.length;N++){if(N!=0){G+=a.options.pictoMargin+g[C[N].pathName].width/2*C[N].tempScale}else{G+=(N==0?(g[C[N].pathName].width*C[N].tempScale/2):0)}var R;switch(a.options.align){case"middle":R=F;break;case"top":R=F+g[C[N].pathName].height/2*C[N].tempScale;break;case"bottom":R=F-g[C[N].pathName].height/2*C[N].tempScale;break}var f=[["T",-(g[C[N].pathName].width/2)+G,-(g[C[N].pathName].height/2)+R],["S",C[N].tempScale,C[N].tempScale,(-(g[C[N].pathName].width/2)+G)+g[C[N].pathName].width/2,(-(g[C[N].pathName].height/2)+R)+g[C[N].pathName].height/2]];var h=[["T",-(g[C[N].pathName].width/2)+G,-(g[C[N].pathName].height/2)+R],["S",0,0,(-(g[C[N].pathName].width/2)+G)+g[C[N].pathName].width/2,(-(g[C[N].pathName].height/2)+R)+g[C[N].pathName].height/2]];var c=$.proxy(a.afterAnimation,{data:C[N],newShape:g[C[N].pathName],x:G,y:R,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){var M=$.extend({opacity:1,fill:C[N].color,stroke:C[N].color,transform:h},a.options.shapeStyle);if(g[C[N].pathName].image){a.removeStyle(M)}if(a.options.fluidTransition){if(!a.state.currentState[N]){C[N].tempPath.attr(M)}else{C[N].tempPath.attr(a.state.currentState[N])}}else{C[N].tempPath.attr(M)}a.state.currentState[N]=$.extend({opacity:1,fill:C[N].color,stroke:C[N].color,transform:f},a.options.shapeStyle);if(g[C[N].pathName].image){a.removeStyle(a.state.currentState[N])}k.push({obj:C[N].tempPath,anim:Raphael.animation(a.state.currentState[N],a.root.options.animationDuration,a.root.options.animationStyle,c).delay(N/C.length*a.root.options.animationSequenceDuration)})}else{var I=$.extend({opacity:1,fill:C[N].color,stroke:C[N].color,transform:f},a.options.shapeStyle);if(g[C[N].pathName].image){a.removeStyle(I)}C[N].tempPath.attr(I);c()}G+=a.options.pictoMargin+g[C[N].pathName].width/2*C[N].tempScale}while(a.state.currentState.length>C.length){a.state.currentState.pop()}var E=0;for(var N=0;N<k.length;N++){k[N].obj.stop();k[N].obj.animate(k[N].anim);E=Math.max(E,k[N].anim.ms+k[N].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},E);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.removeStyle=function(c){delete c.fill;delete c.stroke};a.afterAnimation=function(){if(a.options.showInLineValues&&this.actionCounter===a.state.actionCounter){var e=this.data;var d=this.newShape.width*this.data.tempScale;var c=this.newShape.height*this.data.tempScale;var g=a.options.padding+a.options.pictoMargin;if(e.inValueString.length>0&&e.name){if(d<=15){return}a.options.inTextStyle["font-size"]=a.state.inTextStyleFontSize;do{var f=a.root.paper.text(this.x,this.y+c/2+g/2,e.inValueString).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({fill:e.color},a.options.inTextStyle)));f.bb=f.getBBox();if(f.bb.height<g&&f.bb.width<d){a.visualSet.push(f);break}else{f.remove();a.options.inTextStyle["font-size"]-=1}}while(a.options.inTextStyle["font-size"]>=8)}}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(d){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");var c=InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId]);this.path.attr({fill:c});if(a.root.options.canGlowPath){var f=$.extend({color:c},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(f);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&d){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&d&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Pictogrid=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,hasGroups:true,highlightLegendItem:true,showGroups:true,showLabels:true,maxRows:6,padding:20,pictoMargin:5,panelMarginY:15,defaultPath:"boyPath",absoluteDistribution:false,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.state={currentState:[],interactionsEnabled:false};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(Y,p,w,X){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(w){a.data=InfoCharts.Helper.Data.copyDataArray(Y);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=Y}var M=0;var c=a.root.getCenter();InfoCharts.Helper.Data.setAbs(a.data);InfoCharts.Helper.Data.setDefaults(a.data);_.each(a.data,function(i){i.pathName=i.pathName||a.options.defaultPath});var g=InfoCharts.Helper.Data.getGroups(a.data);p=p||g[0]||null;var D=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,p);if(a.labels){a.labels.dispose();a.labels=null}_.each(a.visualSet,function(i){i.stop()});a.visualSet.remove();a.visualSet=a.root.paper.set();if(w){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&g.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:p,onClickCallback:a.eventing.onGroupChanged}),g);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:c.x,y:a.buttonHeight/2})}}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight});if(a.options.showLabels){var n=InfoCharts.Helper.Data.getLabelsUniq(D,a.options.hasValueInLabel);if(n.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),n);M=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,0);var h;if(a.options.absoluteDistribution&&a.options.hasGroups){h=InfoCharts.Helper.Data.getValueSumMax(a.data,a.options.hasValueInLabel)}else{h=InfoCharts.Helper.Data.getValueSum(D)}var A=InfoCharts.Visuals.ShapeGenerator.Path;var W=InfoCharts.Helper.Data.getPropertyValuesUniq(a.data,"pathName");var u=0;var Z=0;for(var S=0;S<W.length;S++){InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(A[W[S]]);u=Math.max(u,A[W[S]].width+a.options.pictoMargin);Z=Math.max(Z,A[W[S]].height+a.options.pictoMargin)}var L=(a.root.options.canvasWidthDefault-a.options.padding*2);var z=(a.root.options.canvasHeightDefault-a.options.padding*2);var m=Math.floor(L/u);var O=Math.floor(z/Z);var B=m*O;var l=a.options.padding+(L-m*u)/2;var k=a.options.padding+(z-O*Z)/2;var K,J;J=k+a.buttonHeight;var f=[];var d=[];var U=O*m;var N=0;var V=[];for(var S=0;S<D.length;S++){var v=D[S].value/h;D[S].itemCount=Math.round(v*B);D[S].itemCountFraction=v*B-D[S].itemCount;N+=D[S].itemCount;V.push(D[S])}if(!a.options.absoluteDistribution){N=U-N;_.sortBy(V,function(i){return -i.itemCountFraction});var T=0;var F=N>0?1:-1;while(N!==0){V[T].itemCount+=F;N-=F;T++;if(T>=D.length){T=0}}}for(var S=0;S<D.length;S++){f.push(D[S].itemCount)}InfoCharts.Visuals.ShapeGenerator.Anim["picto-visibility"](a.root.paper,"visibility-attribute");var G=0;var H=0;var r=null;var q=0;var I=0;var P=f[0];var t=a.root.paper.set();var e=D[I];var Q=$.extend({fill:e.color,stroke:e.color},a.options.shapeStyle);a.state.currentState=[];if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}rowLoop:for(var R=0;R<O+1;R++){H++;J+=Z/2;K=l;for(var S=0;S<m;S++){if(P<=0){if(f[I]>0){var o={data:D[I],path:t};var s=$.proxy(a.eventing.onMouseOver,o);var C=$.proxy(a.eventing.onMouseOut,o);if(!(Raphael.type=="VML"&&A[e.pathName].image)){if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+o.data.objectId,s);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+o.data.objectId,C)}t.mouseover(s);t.mousemove($.proxy(a.eventing.onMouseMove,o));t.mouseout(C)}a.visualSet.push(t)}I++;if(I<D.length){P=f[I];e=D[I];Q=$.extend({fill:e.color,stroke:e.color},a.options.shapeStyle);t=a.root.paper.set()}else{if(S==0){H--}J+=Z/2;break rowLoop}}K+=u/2;if(A[e.pathName].image){r=a.root.paper.image(A[e.pathName].image,0,0,A[e.pathName].width,A[e.pathName].height)}else{r=a.root.paper.path(A[e.pathName].path);r.attr(Q)}if(a.root.options.canAnimate&&!(Raphael.type=="VML"&&A[e.pathName].image)){r.attr({opacity:0});a.state.currentState.push({path:r,koef:G})}r.transform([["T",Math.round(K-A[e.pathName].width/2),Math.round(J-A[e.pathName].height/2)]]);t.push(r);G++;P--;K+=u/2}J+=Z/2}a.root.resize(a.root.options.canvasWidthDefault,a.root.options.canvasHeightDefault+M+a.buttonHeight-(O-H)*Z);if(a.labels){a.labels.setPosition({x:c.x,y:a.root.options.canvasHeight-M/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-M-a.buttonHeight});var E=0;for(var S=0;S<a.state.currentState.length;S++){q=(a.state.currentState[S].koef)*100/G;a.state.currentState[S].path.attr({"visibility-attribute":[0,q]});a.state.currentState[S].path.stop();a.state.currentState[S].path.animate({"visibility-attribute":[100,q]},a.root.options.animationDuration,a.root.options.animationStyle)}E=a.root.options.animationDuration;setTimeout(function(){a.state.interactionsEnabled=true},E);if(a.state.interactionsEnabled){}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path[0].attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Pie=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,cx:0,cy:0,startAngle:90,radius:150,radiusInner:100,hasGroups:true,showGroups:true,showLabels:true,highlightLegendItem:true,type:"pie",panelMarginY:15,inLinePointerSize:13,inLinePointerStyle:{},showInLineValues:false,inTextStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16},pieElementStyle:{"stroke-width":0.2},captionFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":24,"text-anchor":"start",cursor:"default",fill:"#626262"},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},innerPathStyle:{"stroke-width":0,"stroke-opacity":0,fill:"#626262",stroke:"none"},innerPathOff:false,tooltipOptions:{},_labelWrapperOptions:{},_labelTextOptions:{},_buttonWrapperOptions:{},_buttonTextOptions:{}};a.data=null;a.labels=null;a.visualSet=null;a.visualSubSet=null;a.background=null;a.buttonHeight=0;a.pieAnimationName="";a.state={currentState:[],newState:[],interactionsEnabled:false,actionCounter:0};a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);if(a.options.showInLineValues){a.root.options.canGlowPath=false}a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);InfoCharts.Visuals.ShapeGenerator.Anim["pie-"+a.options.type](a.root.paper,"ipg-pie");return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(e,c,f,n){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(f){a.data=InfoCharts.Helper.Data.copyDataArray(e);a.data=_.filter(a.data,function(o){return o.value!==0});if(a.data.length===0){return}}else{a.data=e}InfoCharts.Helper.Data.setDefaults(a.data);InfoCharts.Helper.Data.setAbs(a.data);var j=0;var d=a.root.getCenter();var g=InfoCharts.Helper.Data.getGroups(a.data);c=c||g[0]||null;var h=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,c);if(f){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&g.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:c,onClickCallback:a.eventing.onGroupChanged}),g);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:d.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var m=InfoCharts.Helper.Data.getLabelsUniq(h,a.options.hasValueInLabel);if(m.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{onOverCallback:a.eventing.onLabelOver,onOutCallback:a.eventing.onLabelOut,enableHover:a.options.highlightLegendItem}),m);j=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,j);if(a.labels){a.labels.setPosition({x:d.x,y:a.root.options.canvasHeight-j/2})}var k=(a.root.options.canvasHeight-j)-(a.buttonHeight);var i=a.buttonHeight;a.background.attr({y:i,height:k});var l=Math.min(k,a.root.options.canvasWidth)*0.85/2;a.options.radius=l;a.options.radiusInner=a.options.radius*0.65;a.generate.generate(a.options.type,h);a.setPosition({x:d.x,y:i+k/2});if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.setPosition=function(c){a.visualSet.transform([["T",c.x,c.y]]);if(a.options.showInLineValues){var d=a.background.getBBox();var f=a.visualSet.getBBox();var e=Math.min(d.width/f.width,d.height/f.height,(d.width/2)/Math.abs(f.x2-(d.x+d.width/2)),(d.height/2)/Math.abs(f.y2-(d.y+d.height/2)),(d.width/2)/Math.abs((d.x+d.width/2)-f.x),(d.height/2)/Math.abs((d.y+d.height/2)-f.y));e=Math.abs(e)>1?1:(e*0.95);a.visualSet.transform([["T",c.x,c.y],["S",e,e,c.x,c.y]])}};a.eventing={helper:{preHoverColor:{}},onLabelOver:function(c){},onLabelOut:function(c){},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSubSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}};a.generate={generate:function(d,g,h){if(a.visualSubSet){if(a.visualSubSet.length>0){a.visualSubSet.remove();a.visualSubSet=a.root.paper.set()}}else{a.visualSubSet=a.root.paper.set()}if(!a.root.options.canAnimate){if(a.visualSet&&a.visualSet.length>0){a.visualSet.remove()}}a.visualSet=a.root.paper.set();var c=a.generate[d](g);if(a.options.highlightLegendItem){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}for(var e=0;e<c.length;e++){var j=$.proxy(a.eventing.onMouseOver,c[e].context);var f=$.proxy(a.eventing.onMouseOut,c[e].context);if(a.options.highlightLegendItem){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+c[e].context.data.objectId,j);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+c[e].context.data.objectId,f)}c[e].unbindAll();c[e].mouseover(j);c[e].mousemove($.proxy(a.eventing.onMouseMove,c[e].context));c[e].mouseout(f);a.visualSet.push(c[e])}},pie:function(x){var j=[];var l=_.reduce(x,function(i,k){return i+k.value},0);var s=a.options.startAngle;var o=0;var u=(a.state.currentState.length==0);a.state.newState=[];var w=Math.PI/180;var e=null;var h=[];for(var r=0;r<x.length;r++){x[r].percentage=Math.abs(x[r].value/l);x[r].percentage=InfoCharts.Helper.Misc.constrainValue(0.0001,0.9999,x[r].percentage);o=s-360*x[r].percentage;var n=a.state.currentState[r]?a.state.currentState[r].path:a.root.paper.path();if(a.options.showInLineValues){var t=true;var m=a.options.radius+a.options.inLinePointerSize;var g=s+a.options.startAngle+(o-s)/2;var d=((g-a.options.startAngle)<-(180-a.options.startAngle))?-1:1;var p=a.root.paper.path([["M",Math.sin(w*g)*a.options.radius,Math.cos(w*g)*a.options.radius],["L",Math.sin(w*g)*m,Math.cos(w*g)*m],["L",Math.sin(w*g)*m+a.options.inLinePointerSize*d,Math.cos(w*g)*m]]);p.attr($.extend({},{stroke:x[r].color},a.options.inLinePointerStyle));var c=a.root.paper.text(Math.sin(w*g)*m+(a.options.inLinePointerSize+3)*d,Math.cos(w*g)*m,x[r].inValueString).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({},{"text-anchor":d<0?"end":"start",fill:x[r].color},a.options.inTextStyle)));c.bb=c.getBBox();for(var q=0;q<h.length;q++){if(Raphael.isBBoxIntersect(h[q],c.bb)){t=false;break}}var v=a.root.paper.set();if(t){h.push(c.bb);v.push(p);v.push(c);v.hide();a.visualSet.push(v);a.visualSubSet.push(v)}else{p.remove();c.remove()}e=$.proxy(function(){this.show()},v)}else{e=function(){}}if(a.root.options.canAnimate){if(u){var f={path:n,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,a.options.startAngle-360*(1/x.length)*(r),a.options.startAngle-360*(1/x.length)*(r+1),a.options.radius],fill:x[r].color,stroke:x[r].color},a.options.pieElementStyle)};f.path.attr(f.attr);a.state.currentState[r]=f}else{if(!a.state.currentState[r]){var f={path:n,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,(r!=0?a.state.currentState[r-1].attr["ipg-pie"][3]:a.options.startAngle-360*0.0001),(r!=0?a.state.currentState[r-1].attr["ipg-pie"][3]-360*0.0001:a.options.startAngle-360*0.0001),a.options.radius],fill:x[r].color,stroke:x[r].color},a.options.pieElementStyle)};f.path.attr(f.attr);a.state.currentState[r]=f}}var f={path:n,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,s,o,a.options.radius],fill:x[r].color,stroke:x[r].color},a.options.pieElementStyle),after:e};a.state.currentState[r].attr["ipg-pie"][4]=a.options.radius;f.path.attr(a.state.currentState[r].attr);a.state.newState[r]=f}else{n.attr({"ipg-pie":[a.options.cx,a.options.cy,s,o,a.options.radius]});n.attr($.extend({fill:x[r].color,stroke:x[r].color},a.options.pieElementStyle));e()}n.context={data:x[r],path:n};j.push(n);s=o}for(var r=x.length;r<a.state.currentState.length;r++){a.state.currentState[r].path.stop();a.state.currentState[r].path.remove();a.state.currentState[r]=null}if(a.root.options.canAnimate){for(var r=0;r<a.state.newState.length;r++){a.state.newState[r].path.stop();a.state.newState[r].path.animate(a.state.newState[r].attr,a.root.options.animationDuration,a.root.options.animationStyle,a.state.newState[r].after)}}setTimeout(function(){a.state.interactionsEnabled=true},a.root.options.animationDuration);a.state.currentState=a.state.newState;return j},doughnut:function(A){var m=_.reduce(A,function(i,k){return i+k.value},0);var u=a.options.startAngle;var q=0;var j=[];var w=(a.state.currentState.length==0);a.state.newState=[];var y=Math.PI/180;var h=[];var e=null;for(var t=0;t<A.length;t++){A[t].percentage=Math.abs(A[t].value/m);A[t].percentage=InfoCharts.Helper.Misc.constrainValue(0.0001,0.9999,A[t].percentage);q=u-360*A[t].percentage;var p=a.state.currentState[t]?a.state.currentState[t].path:a.root.paper.path();if(a.options.showInLineValues){var v=true;var n=a.options.radius+a.options.inLinePointerSize;var g=u+a.options.startAngle+(q-u)/2;var d=((g-a.options.startAngle)<-(180-a.options.startAngle))?-1:1;var r=a.root.paper.path([["M",Math.sin(y*g)*a.options.radius,Math.cos(y*g)*a.options.radius],["L",Math.sin(y*g)*n,Math.cos(y*g)*n],["L",Math.sin(y*g)*n+a.options.inLinePointerSize*d,Math.cos(y*g)*n]]);r.attr($.extend({},{stroke:A[t].color},a.options.inLinePointerStyle));var c=a.root.paper.text(Math.sin(y*g)*n+(a.options.inLinePointerSize+3)*d,Math.cos(y*g)*n,A[t].inValueString).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({},{"text-anchor":d<0?"end":"start",fill:A[t].color},a.options.inTextStyle)));c.bb=c.getBBox();for(var s=0;s<h.length;s++){if(Raphael.isBBoxIntersect(h[s],c.bb)){v=false;break}}var x=a.root.paper.set();if(v){h.push(c.bb);x.push(r);x.push(c);x.hide();a.visualSet.push(x);a.visualSubSet.push(x)}else{r.remove();c.remove()}e=$.proxy(function(){this.show()},x)}else{e=function(){}}if(a.root.options.canAnimate){if(w){var f={path:p,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,a.options.radiusInner,a.options.radius,a.options.startAngle-360*(1/A.length)*(t),a.options.startAngle-360*(1/A.length)*(t+1)],fill:A[t].color,stroke:A[t].color},a.options.pieElementStyle)};p.attr(f.attr);a.state.currentState[t]=f}else{if(!a.state.currentState[t]){var f={path:p,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,a.options.radiusInner,a.options.radius,(t!=0?a.state.currentState[t-1].attr["ipg-pie"][5]:a.options.startAngle-360*0.0001),(t!=0?a.state.currentState[t-1].attr["ipg-pie"][5]-360*0.0001:a.options.startAngle-360*0.0001)],fill:A[t].color,stroke:A[t].color},a.options.pieElementStyle)};p.attr(f.attr);a.state.currentState[t]=f}}var f={path:p,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,a.options.radiusInner,a.options.radius,u,q],fill:A[t].color,stroke:A[t].color},a.options.pieElementStyle),after:e};a.state.currentState[t].attr["ipg-pie"][2]=a.options.radiusInner;a.state.currentState[t].attr["ipg-pie"][3]=a.options.radius;f.path.attr(a.state.currentState[t].attr);a.state.newState[t]=f}else{p.attr({"ipg-pie":[a.options.cx,a.options.cy,a.options.radiusInner,a.options.radius,u,q]});p.attr($.extend({fill:A[t].color,stroke:A[t].color},a.options.pieElementStyle));e()}p.context={data:A[t],path:p};j.push(p);u=q}if(a.options.hasGroups&&!(A[0].shape&&!a.options.innerPathOff)){var l;do{l=a.root.paper.text(0,0+a.root.state.fontOffsetY,A[0].group);l.attr(a.options.captionFontStyle);if(a.options.radiusInner*2-15>l.getBBox().width){l.attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.captionFontStyle));l.attr({x:-l.getBBox().width/2});a.visualSet.push(l);a.visualSubSet.push(l);break}l.remove();a.options.captionFontStyle["font-size"]--;if(a.options.captionFontStyle["font-size"]<5){break}}while(true)}if((A[0].shape&&!a.options.innerPathOff)){InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(InfoCharts.Visuals.ShapeGenerator.Path[A[0].shape]);var z=Math.min((a.options.radiusInner*2-15)/InfoCharts.Visuals.ShapeGenerator.Path[A[0].shape].width,(a.options.radiusInner*2-15)/InfoCharts.Visuals.ShapeGenerator.Path[A[0].shape].height);var o=InfoCharts.Visuals.ShapeGenerator.Func.scalePath(InfoCharts.Visuals.ShapeGenerator.Path[A[0].shape],z);var B=null;if(o.image){B=a.root.paper.image(o.image,-o.width/2,-o.height/2,o.width,o.height)}else{o.path=Raphael.transformPath(o.path,[["T",-o.width/2,-o.height/2]]);B=a.root.paper.path(o.path).attr(a.options.innerPathStyle)}a.visualSet.push(B);a.visualSubSet.push(B)}for(var t=A.length;t<a.state.currentState.length;t++){a.state.currentState[t].path.stop();a.state.currentState[t].path.remove();a.state.currentState[t]=null}if(a.root.options.canAnimate){for(var t=0;t<a.state.newState.length;t++){a.state.newState[t].path.stop();a.state.newState[t].path.animate(a.state.newState[t].attr,a.root.options.animationDuration,a.root.options.animationStyle,a.state.newState[t].after)}}setTimeout(function(){a.state.interactionsEnabled=true},a.root.options.animationDuration);a.state.currentState=a.state.newState;return j},polar:function(e){var l=_.reduce(e,function(i,p){return i+p.value},0);var h=a.options.startAngle;var g=0;var o=[];var j=(a.state.currentState.length==0);a.state.newState=[];for(var f=0;f<e.length;f++){e[f].percentage=Math.abs(e[f].value/100);e[f].percentage=InfoCharts.Helper.Misc.constrainValue(0.0001,0.9999,e[f].percentage);var k=(e.length-f*0.7)/e.length;var m=a.options.radius*k;var d=a.options.radius*k-(a.options.radius/e.length*0.4);g=h-360*e[f].percentage;var n=a.state.currentState[f]?a.state.currentState[f].path:a.root.paper.path();if(a.root.options.canAnimate){if(j){var c={path:n,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,m,d,h,h-360*0.0001],fill:e[f].color,stroke:e[f].color},a.options.pieElementStyle)};n.attr(c.attr);a.state.currentState[f]=c}else{if(!a.state.currentState[f]){var c={path:n,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,m,d,(f!=0?a.state.currentState[f-1].attr["ipg-pie"][5]:h-360*0.0001),(f!=0?a.state.currentState[f-1].attr["ipg-pie"][5]-360*0.0001:h-360*0.0001)],fill:e[f].color,stroke:e[f].color},a.options.pieElementStyle)};n.attr(c.attr);a.state.currentState[f]=c}}var c={path:n,attr:$.extend({"ipg-pie":[a.options.cx,a.options.cy,m,d,h,g],fill:e[f].color,stroke:e[f].color},a.options.pieElementStyle)};a.state.currentState[f].attr["ipg-pie"][2]=m;a.state.currentState[f].attr["ipg-pie"][3]=d;c.path.attr(a.state.currentState[f].attr);a.state.newState[f]=c}else{n.attr({"ipg-pie":[a.options.cx,a.options.cy,m,d,h,g]});n.attr($.extend({fill:e[f].color,stroke:e[f].color},a.options.pieElementStyle))}n.context={data:e[f],path:n};o.push(n)}for(var f=e.length;f<a.state.currentState.length;f++){a.state.currentState[f].path.stop();a.state.currentState[f].path.remove();a.state.currentState[f]=null}if(a.root.options.canAnimate){for(var f=0;f<a.state.newState.length;f++){a.state.newState[f].path.stop();a.state.newState[f].path.animate(a.state.newState[f].attr,a.root.options.animationDuration,a.root.options.animationStyle)}}setTimeout(function(){a.state.interactionsEnabled=true},a.root.options.animationDuration);a.state.currentState=a.state.newState;return o}};a.afterAnimation=function(){if(a.options.showInLineValues&&this.actionCounter===a.state.actionCounter){var c=this.data;if(c.inValueString.length>0){}}}};InfoCharts.Visuals.Treemap=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,gridInnerMargin:2,gridOuterMargin:10,groupMaximum:true,horizontalKoeficient:1,maxFontSize:30,minFontSize:11,maxFontSizeInLine:20,minFontSizeInLine:10,showText:true,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},_gridTextOptions:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":0,"text-anchor":"start",fill:"#FFFFFF",cursor:"default","font-weight":"bold"},backgroundStyle:{opacity:0}},showInLineValues:false,_gridTextOptionsInLine:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":0,"text-anchor":"start",fill:"#FFFFFF",cursor:"default"},backgroundStyle:{opacity:0}}};a.state={interactionsEnabled:false,modifiedTextStyle:null,modifiedTextStyleInLine:null,actionCounter:0};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.animationQueue=[];a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);a.state.modifiedTextStyle=$.extend(true,{},a.options._gridTextOptions);a.state.modifiedTextStyleInLine=$.extend(true,{},a.options._gridTextOptionsInLine);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(f,d,g,p){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(g){a.data=InfoCharts.Helper.Data.copyDataArray(f);a.data=_.filter(a.data,function(i){return i.value!==0});if(a.data.length===0){return}}else{a.data=f}InfoCharts.Helper.Data.setAbs(a.data);a.animationQueue=[];var e=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var h=InfoCharts.Helper.Data.getGroups(a.data);d=d||h[0]||null;var k=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,d);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var l=0;var e=a.root.getCenter();if(g){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&h.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:d,onClickCallback:a.eventing.onGroupChanged}),h);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:e.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var n=InfoCharts.Helper.Data.getLabelsUniq(k,a.options.hasValueInLabel);if(n.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),n);l=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,l);if(a.labels){a.labels.setPosition({x:e.x,y:a.root.options.canvasHeight-l/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-l});a.background.bb=a.background.getBBox();if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}a.createBox({x:a.background.bb.x+a.options.gridOuterMargin,y:a.background.bb.y+a.options.gridOuterMargin,width:a.background.bb.width-a.options.gridOuterMargin*2,height:a.background.bb.height-a.options.gridOuterMargin*2},k);var c=[];if(a.root.options.canAnimate){var o=a.animationQueue.length;_.each(a.animationQueue,function(q,i){q.path.attr({transform:["S",0,0,q.box.x+q.box.width/2,q.box.y+q.box.height/2]});c.push({obj:q.path,anim:Raphael.animation({transform:["S",1,1,q.box.x+q.box.width/2,q.box.y+q.box.height/2]},a.root.options.animationDuration,a.root.options.animationStyle,function(){if(q.text){q.text.show()}if(q.textInLine){q.textInLine.show()}}).delay(i/o*a.root.options.animationSequenceDuration)})})}var j=0;for(var m=0;m<c.length;m++){c[m].obj.stop();c[m].obj.animate(c[m].anim);j=Math.max(j,c[m].anim.ms+c[m].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},j);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.createBox=function(g,z){if(z.length==1){var l=a.root.paper.rect(g.x,g.y,g.width,g.height);l.attr({fill:z[0].color,"stroke-width":0,"stroke-opacity":0,stroke:"none"});var u=0;var n=0;if(g.width>=g.height){u=g.width;n=g.height}else{u=g.height;n=g.width}var j=null;var v=null;var e=a.root.paper.set();if(a.options.showText){var k=a.options.maxFontSize;var o=a.options.maxFontSizeInLine;while(true){a.state.modifiedTextStyle.labelFontStyle["font-size"]=k;a.state.modifiedTextStyle.labelFontStyle.fill=InfoCharts.Helper.Misc.getContrastColor(a.options._gridTextOptions.labelFontStyle.fill,z[0].color);if(a.options.showInLineValues){a.state.modifiedTextStyleInLine.labelFontStyle["font-size"]=o;a.state.modifiedTextStyleInLine.labelFontStyle.fill=InfoCharts.Helper.Misc.getContrastColor(a.options._gridTextOptionsInLine.labelFontStyle.fill,z[0].color)}j=new InfoCharts.Visuals.Text(a.root).init({name:z[0].name,color:""},a.state.modifiedTextStyle);if(a.options.showInLineValues){v=new InfoCharts.Visuals.Text(a.root).init({name:z[0].inValueString,color:""},a.state.modifiedTextStyleInLine)}if(a.options.showInLineValues){if(Math.max(j.box.width,v.box.width)<=u&&(j.box.height+v.box.height)<=n){j.text.hide();v.text.hide();break}else{k-=2;o-=2;if(o<a.options.minFontSizeInLine){o=a.options.minFontSizeInLine}}}else{if(j.box.width<=u&&j.box.height<=n){j.text.hide();break}else{k-=2}}j.set.remove();j=null;if(a.options.showInLineValues){v.set.remove();v=null}if(k<a.options.minFontSize){j=null;v=null;break}}if(j&&v){var x=(j.box.height-v.box.height)/2;if(g.width>=g.height){j.setPosition({x:g.x+g.width/2,y:g.y+g.height/2-j.box.height/2+x});v.setPosition({x:g.x+g.width/2,y:g.y+g.height/2+v.box.height/2+x})}else{j.setPositionVertical({x:g.x+g.width/2-j.box.height/2+x,y:g.y+g.height/2});v.setPositionVertical({x:g.x+g.width/2+v.box.height/2+x,y:g.y+g.height/2})}e.push(j.set);e.push(v.set)}else{if(j&&!v){if(g.width>=g.height){j.setPosition({x:g.x+g.width/2,y:g.y+g.height/2})}else{j.setPositionVertical({x:g.x+g.width/2,y:g.y+g.height/2})}e.push(j.set)}}}e.push(l);var p={data:{name:z[0].name,valueString:z[0].valueString,objectId:z[0].objectId},path:l};var c=$.proxy(a.eventing.onMouseOver,p);var m=$.proxy(a.eventing.onMouseOut,p);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+p.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+p.data.objectId,m)}e.mouseover(c);e.mousemove($.proxy(a.eventing.onMouseMove,p));e.mouseout(m);if(a.root.options.canAnimate){a.animationQueue.push({box:g,path:l,text:j&&j.set,textInLine:v&&v.set})}else{if(j){j.text.show()}if(v){v.text.show()}}a.visualSet.push(e)}else{var A=_.reduce(z,function(i,B){return i+B.value},0);var h=[];var f=[];var q=0;var w=0;var y=true;var d=A/2;for(var r=0;r<z.length;r++){if(y){h.push(z[r]);q+=z[r].value;if(q>=d||z.length==2||r==(z.length-2)){if(!a.options.groupMaximum){if(h.length>1){h.pop();q-=z[r].value;r--}}y=false}}else{f.push(z[r])}}w=A-q;var t={};var s={};if(g.width>=g.height*a.options.horizontalKoeficient){t={x:g.x,y:g.y,width:g.width*q/A-a.options.gridInnerMargin/2,height:g.height};s={x:g.x+t.width+a.options.gridInnerMargin,y:g.y,width:g.width*w/A-a.options.gridInnerMargin/2,height:g.height}}else{t={x:g.x,y:g.y,width:g.width,height:g.height*q/A-a.options.gridInnerMargin/2};s={x:g.x,y:g.y+t.height+a.options.gridInnerMargin,width:g.width,height:g.height*w/A-a.options.gridInnerMargin/2}}if(h.length>0){a.createBox(t,h)}if(f.length>0){a.createBox(s,f)}}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Table=function(b){var a=this;a.root=b;a.options={highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:false,showCellColor:true,showColHeader:true,showRowHeader:true,padding:5,showTooltip:false,panelMarginY:15,pictoScale:0.5,pictoProportionalScale:false,cellSpaceing:5,columnHeaderMinHeight:100,rowHeaderMinWidth:100,columnHeaderStyle:{"stroke-width":0,"stroke-opacity":0,fill:"#EEEEEE",stroke:"none"},rowHeaderStyle:{"stroke-width":0,"stroke-opacity":0,fill:"#F4F4F4",stroke:"none"},cellStyle:{"stroke-width":0,"stroke-opacity":0,fill:"url('img/bg.png')",stroke:"none"},backgroundStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},headerTextWrapperOptions:{wrapper:{marginX:4},text:{labelFontStyle:{"font-size":25,"font-weight":"bold",fill:"#307D99"}}},cellTextWrapperOptions:{text:{labelFontStyle:{"font-size":25,fill:"#4E4E4E"}}},pathStyle:{"stroke-width":0,"stroke-opacity":0,fill:"#4E4E4E",stroke:"none"},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.state={interactionsEnabled:false};a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(V,t,z,U){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(z){a.data=InfoCharts.Helper.Data.copyDataArray(V);if(a.data.length===0){return}}else{a.data=V}var d=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var k=InfoCharts.Helper.Data.getGroups(a.data);t=t||k[0]||null;var F=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,t);if(a.root.options.canAnimate){_.each(a.visualSet,function(i){i.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var K=0;var d=a.root.getCenter();if(z){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&k.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:t,onClickCallback:a.eventing.onGroupChanged}),k);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:d.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var r=InfoCharts.Helper.Data.getLabelsUniq(F);if(!a.options.showCellColor){_.each(r,function(i){i.color=a.options.pathStyle.fill})}if(r.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),r);K=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,K);if(a.labels){a.labels.setPosition({x:d.x,y:a.root.options.canvasHeight-K/2})}a.background.attr({x:a.options.padding,y:a.buttonHeight+(a.buttonHeight===0?a.options.padding:0),width:a.root.options.canvasWidth-a.options.padding*2,height:a.root.options.canvasHeight-a.buttonHeight-K-(a.buttonHeight===0?a.options.padding:0)-(K===0?a.options.padding:0)});a.background.bb=a.background.getBBox();var P=Math.max(a.options.columnHeaderStyle["stroke-width"],a.options.rowHeaderStyle["stroke-width"],a.options.cellStyle["stroke-width"]);var n=a.background.bb.x+P;var c=a.background.bb.y+P;var S=_.uniq(_.map(F,function(i){return i.value[0]}));var p=_.uniq(_.map(F,function(i){return i.value[1]}));var J=a.background.bb.width-P;var A=a.background.bb.height-P;var M=a.options.showRowHeader?a.options.rowHeaderMinWidth+a.options.cellSpaceing:0;var q=a.options.showColHeader?a.options.columnHeaderMinHeight+a.options.cellSpaceing:0;cellWidth=(J-M-p.length*a.options.cellSpaceing+a.options.cellSpaceing)/p.length;cellHeight=(A-q-S.length*a.options.cellSpaceing+a.options.cellSpaceing)/S.length;if(P>0){cellWidth=Math.floor(cellWidth);cellHeight=Math.floor(cellHeight)}var w;var B;var R;var C;var l=0;var s;var h=false;if(a.options.pictoProportionalScale){_.each(F,function(i){l=Math.max(l,Math.abs(i.value[2]))});l=Math.sqrt(l)}if(a.options.showColHeader){for(var I=0;I<p.length;I++){B=a.root.paper.rect(n+M+cellWidth*I+a.options.cellSpaceing*I-a.options.columnHeaderStyle["stroke-width"]/2,c-a.options.columnHeaderStyle["stroke-width"]/2,cellWidth,a.options.columnHeaderMinHeight).attr(a.options.columnHeaderStyle);B.bb=B.getBBox();w=new InfoCharts.Visuals.TextWrapper(a.root).init(a.options.headerTextWrapperOptions,p[I],B.bb.width,B.bb.height);w.setPosition({x:B.bb.x+B.bb.width/2,y:B.bb.y+B.bb.height/2});a.visualSet.push(B);a.visualSet.push(w.set)}}if(a.options.showRowHeader){for(var H=0;H<S.length;H++){B=a.root.paper.rect(n-a.options.rowHeaderStyle["stroke-width"]/2,c+q+cellHeight*H+a.options.cellSpaceing*H-a.options.rowHeaderStyle["stroke-width"]/2,a.options.rowHeaderMinWidth,cellHeight).attr(a.options.rowHeaderStyle);B.bb=B.getBBox();w=new InfoCharts.Visuals.TextWrapper(a.root).init(a.options.headerTextWrapperOptions,S[H],B.bb.width,B.bb.height);w.setPosition({x:B.bb.x+B.bb.width/2,y:B.bb.y+B.bb.height/2});a.visualSet.push(w.set);a.visualSet.push(B)}}var f=0;var W=p.length*S.length;var m={};var E;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var j=[];var e={};for(var O=0;O<F.length;O++){e[F[O].value[1]+"|"+F[O].value[0]]=F[O]}for(var I=0;I<p.length;I++){for(var H=0;H<S.length;H++){h=false;C=e[p[I]+"|"+S[H]];B=a.root.paper.rect(n+M+cellWidth*I+a.options.cellSpaceing*I-a.options.cellStyle["stroke-width"]/2,c+q+cellHeight*H+a.options.cellSpaceing*H-a.options.cellStyle["stroke-width"]/2,cellWidth,cellHeight).attr(a.options.cellStyle);a.visualSet.push(B);if(C==null){continue}B.bb=B.getBBox();var g=null;if(C.styleName&&C.styleName.length>0){h=true;if(!m[C.styleName]){var T=InfoCharts.Visuals.ShapeGenerator.Path[C.styleName];InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(T);E=Math.min(cellWidth/T.width,cellHeight/T.height)*a.options.pictoScale;m[C.styleName]={};m[C.styleName]=InfoCharts.Visuals.ShapeGenerator.Func.scalePath(T,E)}newPath=m[C.styleName];if(a.options.pictoProportionalScale){if(C.value[2]!=0){E=(Math.sqrt(Math.abs(C.value[2]))/l)}else{E=0.01}}else{E=1}var N=null;if(newPath.image){N=a.root.paper.image(newPath.image,0,0,newPath.width,newPath.height)}else{N=a.root.paper.path(newPath.path);if(a.options.showCellColor){a.options.pathStyle.fill=C.color}N.attr(a.options.pathStyle)}if(a.root.options.canAnimate){N.attr({transform:[["S",0,0,B.bb.x+B.bb.width/2,B.bb.y+B.bb.height/2]]});j.push({obj:N,anim:Raphael.animation({transform:[["S",E,E],["T",B.bb.x+B.bb.width/2-newPath.width/2,B.bb.y+B.bb.height/2-newPath.height/2]]},a.root.options.animationDuration,a.root.options.animationStyle).delay(a.root.options.animationDuration*f/W)})}else{N.attr({transform:[["S",E,E],["T",B.bb.x+B.bb.width/2-newPath.width/2,B.bb.y+B.bb.height/2-newPath.height/2]]})}a.visualSet.push(N);g=N}else{if(C.valueString!=null&&C.valueString.length>0){h=true;if(a.options.showCellColor){a.options.cellTextWrapperOptions.text.labelFontStyle.fill=C.color}if(a.root.options.canAnimate){a.options.cellTextWrapperOptions.text.labelFontStyle.opacity=0}w=new InfoCharts.Visuals.TextWrapper(a.root).init(a.options.cellTextWrapperOptions,C.valueString,B.bb.width,B.bb.height);w.setPosition({x:B.bb.x+B.bb.width/2,y:B.bb.y+B.bb.height/2});if(a.root.options.canAnimate&&w.label){for(var L=0;L<w.label.items.length;L++){j.push({obj:w.label.items[L].text,anim:Raphael.animation({opacity:1},a.root.options.animationDuration,a.root.options.animationStyle).delay(a.root.options.animationDuration*f/W)})}}a.visualSet.push(w.set);g=w.set}}if(h){R=a.root.paper.rect(B.bb.x,B.bb.y,B.bb.width,B.bb.height).attr({opacity:0,fill:"#FFFFFF"});s={data:{name:C.name,valueString:C.valueString,objectId:C.objectId},path:g.type=="path"?g:null};var v=$.proxy(a.eventing.onMouseOver,s);var D=$.proxy(a.eventing.onMouseOut,s);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+s.data.objectId,v);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+s.data.objectId,D)}R.unbindAll();R.mouseover(v);R.mousemove($.proxy(a.eventing.onMouseMove,s));R.mouseout(D);a.visualSet.push(R)}f++}}var G=0;for(var Q=0;Q<j.length;Q++){j[Q].obj.stop();j[Q].obj.animate(j[Q].anim);G=Math.max(G,j[Q].anim.ms+j[Q].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},G);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){if(this.path){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]})}a.tooltip.dispose();a.tooltip=null}if(this.path){a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}}if(c&&a.options.showTooltip){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}if(this.path){if(a.eventing.helper.preHoverColor[this.data.objectId]){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}}}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Gauge=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,gaugeMargins:15,needleRadius:15,innerRadiusKoeficient:0.7,needleRadiusKoeficient:0.07,backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},gaugeStyle:{"stroke-width":1,stroke:"#C9C9C9",fill:"#E9E9E9"},gaugeFillStyle:{"stroke-width":1,stroke:"#C9C9C9"},gaugeNeedleStyle:{"stroke-width":0,"stroke-opacity":0,fill:"#484848",stroke:"none"},_gaugeTextOptions:{paddingX:0,paddingY:3,enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":17,"text-anchor":"start",fill:"#7D7D7D",cursor:"default"},backgroundStyle:{"stroke-width":0,"stroke-opacity":0,opacity:0,stroke:"none"}},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.visualSet=null;a.visualSubSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.state={currentState:{gauge:{path:null,attr:null},gaugeFill:{path:null,attr:null},gaugeNeedle:{path:null,attr:null}},newState:{gauge:{path:null,attr:null},gaugeFill:{path:null,attr:null},gaugeNeedle:{path:null,attr:null}},interactionsEnabled:false};a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.visualSubSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);InfoCharts.Visuals.ShapeGenerator.Anim["gauge-gauge"](a.root.paper,"ipg-gauge-gauge");InfoCharts.Visuals.ShapeGenerator.Anim["gauge-needle"](a.root.paper,"ipg-gauge-needle");return a};a.loadData=function(f,d,c,e){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(f,d,c,e)},0)}else{a.loadDataActual(f,d,c,e)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(k,w,j,p){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(j){a.data=InfoCharts.Helper.Data.copyDataArray(k);if(a.data.length===0){return}}else{a.data=k}var u=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var t=InfoCharts.Helper.Data.getGroups(a.data);w=w||t[0]||null;var i=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,w);a.visualSubSet.remove();a.visualSubSet=a.root.paper.set();if(a.root.options.canAnimate){_.each(a.visualSet,function(y){y.stop()})}a.visualSet.remove();a.visualSet=a.root.paper.set();var d=0;var u=a.root.getCenter();if(j){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&t.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:w,onClickCallback:a.eventing.onGroupChanged}),t);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:u.x,y:a.buttonHeight/2})}}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var g=InfoCharts.Helper.Data.getLabelsUniq(i,a.options.hasValueInLabel);if(g.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),g);d=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,d);if(a.labels){a.labels.setPosition({x:u.x,y:a.root.options.canvasHeight-d/2})}a.background.attr({x:0,y:a.buttonHeight,width:a.root.options.canvasWidth,height:a.root.options.canvasHeight-a.buttonHeight-d});a.background.bb=a.background.getBBox();var x=i[0];var o=new InfoCharts.Visuals.Text(a.root,null).init({name:x.value[0],color:"#FFFFFF"},a.options._gaugeTextOptions);var m=new InfoCharts.Visuals.Text(a.root,null).init({name:x.value[1],color:"#FFFFFF"},a.options._gaugeTextOptions);var f=Math.min(a.background.bb.height,a.background.bb.width/2)*a.options.needleRadiusKoeficient;var e=Math.min(a.background.bb.height,a.background.bb.width/2)-a.options.gaugeMargins-f;var h=e*a.options.innerRadiusKoeficient;var s=a.background.bb.x+a.background.bb.width/2;var q=a.background.bb.y+e+(a.background.bb.height-e)/2-o.box.height/2;var v=Math.PI/180;var r=180-180*InfoCharts.Helper.Misc.constrainValue(0.001,99.999,Math.abs(x.value[2]))/100;o.setPosition({x:s+(h+(e-h)/2)*Math.cos(-(180)*v),y:q+(h+(e-h)/2)*Math.sin(-(180)*v)+o.box.height/2});m.setPosition({x:s+(h+(e-h)/2)*Math.cos(-(0)*v),y:q+(h+(e-h)/2)*Math.sin(-(0)*v)+m.box.height/2});a.state.currentState.gauge.path=a.state.currentState.gauge.path||a.root.paper.path();a.state.currentState.gaugeFill.path=a.state.currentState.gaugeFill.path||a.root.paper.path();a.state.currentState.gaugeNeedle.path=a.state.currentState.gaugeNeedle.path||a.root.paper.path();if(a.root.options.canAnimate){if(a.state.currentState.gauge.attr==null){a.state.currentState.gauge.attr=$.extend({"ipg-gauge-gauge":[s,q,h,e,180-0.001,0],fill:x.color},a.options.gaugeStyle);a.state.currentState.gaugeFill.attr=$.extend({"ipg-gauge-gauge":[s,q,h,e,180,180-0.001],fill:x.color},a.options.gaugeFillStyle);a.state.currentState.gaugeNeedle.attr=$.extend({"ipg-gauge-needle":[s,q,e+f,180-0.001,f],fill:x.color},a.options.gaugeNeedleStyle);a.state.currentState.gauge.path.attr(a.state.currentState.gauge.attr);a.state.currentState.gaugeFill.path.attr(a.state.currentState.gaugeFill.attr);a.state.currentState.gaugeNeedle.path.attr(a.state.currentState.gaugeNeedle.attr)}a.state.newState=a.state.currentState;a.state.newState.gauge.attr=$.extend({"ipg-gauge-gauge":[s,q,h,e,r,0],fill:x.color},a.options.gaugeStyle);a.state.newState.gaugeFill.attr=$.extend({"ipg-gauge-gauge":[s,q,h,e,180,r],fill:x.color},a.options.gaugeFillStyle);a.state.newState.gaugeNeedle.attr=$.extend({"ipg-gauge-needle":[s,q,e+f,r,f],fill:x.color},a.options.gaugeNeedleStyle);a.state.newState.gauge.path.stop();a.state.newState.gauge.path.animate(a.state.newState.gauge.attr,a.root.options.animationDuration,a.root.options.animationStyle);a.state.newState.gaugeFill.path.stop();a.state.newState.gaugeFill.path.animate(a.state.newState.gaugeFill.attr,a.root.options.animationDuration,a.root.options.animationStyle);a.state.newState.gaugeNeedle.path.stop();a.state.newState.gaugeNeedle.path.animate(a.state.newState.gaugeNeedle.attr,a.root.options.animationDuration,a.root.options.animationStyle)}else{a.state.newState=a.state.currentState;a.state.newState.gauge.attr=$.extend({"ipg-gauge-gauge":[s,q,h,e,r,0],fill:x.color},a.options.gaugeStyle);a.state.newState.gaugeFill.attr=$.extend({"ipg-gauge-gauge":[s,q,h,e,180,r],fill:x.color},a.options.gaugeFillStyle);a.state.newState.gaugeNeedle.attr=$.extend({"ipg-gauge-needle":[s,q,e+f,r,f],fill:x.color},a.options.gaugeNeedleStyle);a.state.newState.gauge.path.attr(a.state.newState.gauge.attr);a.state.newState.gaugeFill.path.attr(a.state.newState.gaugeFill.attr);a.state.newState.gaugeNeedle.path.attr(a.state.newState.gaugeNeedle.attr)}if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var n={data:{name:x.name,valueString:x.valueString,objectId:x.objectId},path:a.state.newState.gaugeFill.path};var c=$.proxy(a.eventing.onMouseOver,n);var l=$.proxy(a.eventing.onMouseOut,n);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+n.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+n.data.objectId,l)}a.state.newState.gaugeFill.path.unbindAll();a.state.newState.gaugeFill.path.mouseover(c);a.state.newState.gaugeFill.path.mousemove($.proxy(a.eventing.onMouseMove,n));a.state.newState.gaugeFill.path.mouseout(l);a.visualSubSet.push(o.set);a.visualSubSet.push(m.set);if(!a.root.options.canAnimate){a.visualSet.push(a.state.newState.gauge);a.visualSet.push(a.state.newState.gaugeFill);a.visualSet.push(a.state.newState.gaugeNeedle)}a.state.currentState=a.state.newState;a.state.newState=null;setTimeout(function(){a.state.interactionsEnabled=true},a.root.options.animationDuration);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.eventing.helper.preHoverColor[this.data.objectId]=null;if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Bubble=function(b){var a=this;a.root=b;a.options={showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,fixedSize:0,bubbleMaxSizePercentage:0.1,absoluteDistribution:false,gridPostOptions:{gridToFront:false,labelsToFront:true,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},bubbleStyle:{"stroke-width":0,"stroke-opacity":0,opacity:1,stroke:"none"},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},_gridOptions:{}};a.state={interactionsEnabled:false,axesTitle:null};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(v,F,u,A,k){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(u){a.data=InfoCharts.Helper.Data.copyDataArray(v);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(A);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(k)}else{a.data=v}if(u){_.each(a.data,function(i){_.each(i.value,function(H){_.each(H,function(I){I[2]=Math.abs(I[2])})})})}var E=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var D=InfoCharts.Helper.Data.getGroups(a.data);F=F||D[0]||null;var r=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,F);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,F)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,F);_.each(a.visualSet,function(i){i.stop()});a.visualSet.remove();a.visualSet=a.root.paper.set();var d=0;var E=a.root.getCenter();if(u){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&D.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:F,onClickCallback:a.eventing.onGroupChanged}),D);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:E.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var f=InfoCharts.Helper.Data.getLabelsUniq(r);if(f.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),f);d=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,d);if(a.labels){a.labels.setPosition({x:E.x,y:a.root.options.canvasHeight-d/2})}if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var o=0;var m=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){o=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){m=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}a.background.attr({x:0+o,y:a.buttonHeight,width:a.root.options.canvasWidth-o*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),height:a.root.options.canvasHeight-a.buttonHeight-d-m});a.background.bb=a.background.getBBox();if(o){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:o/2,y:a.background.bb.y+a.background.bb.height/2})}if(m){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+m/2})}var C=NaN;var B=0;var q=0;var h=0;var j=[];var p=[];var t=null;var l=0;var s=1;var y=0;_.each(r,function(i){_.each(i.value,function(H){_.each(H,function(I){C=isNaN(C)?I[2]:Math.max(C,I[2]);B+=I[2];q++})})});if(!a.options.fixedSize){a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(true,{},a.options._gridOptions,{pos:[0+o,a.buttonHeight],size:[a.root.options.canvasWidthDefault-o*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-d],offset:[{start:0,end:0},{start:0,end:0}],forceDataMargin:false,canResize:false}),a.options.absoluteDistribution?a.data:r);var n=Math.max(a.grid.state.maxVal[0],a.grid.state.maxVal[1]);a.grid=null;h=B/q;s=n*a.options.bubbleMaxSizePercentage;y=s}a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(true,{},a.options._gridOptions,{pos:[0+o,a.buttonHeight],size:[a.root.options.canvasWidthDefault-o*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-d-m],offset:[{start:0,end:0},{start:0,end:0}],dataMarginSize:y,forceDataMargin:true,canResize:false}),a.options.absoluteDistribution?a.data:r);a.grid.createGrid();var g=[];_.each(r,function(i){_.each(i.value,function(H){_.each(H,function(I){j=a.grid.getValuePosition(I);if(!a.options.fixedSize){p=a.grid.getGridPosition([Math.sqrt(I[2]/C)*s,Math.sqrt(I[2]/C)*s])}g.push({size:a.options.fixedSize?a.options.fixedSize:Math.min(p[0].value-p[0].baseline,p[1].baseline-p[1].value),x:j[0].value,y:j[1].value,data:i,coords:I})})})});g=_.sortBy(g,function(i){return i.size});if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var G=[];for(var z=g.length-1;z>=0;z--){if(a.root.options.canAnimate){t=a.root.paper.circle(g[z].x,g[z].y,0);G.push({obj:t,anim:Raphael.animation({r:g[z].size},a.root.options.animationDuration,a.root.options.animationStyle).delay(a.root.options.animationDuration/g.length*z)})}else{t=a.root.paper.circle(g[z].x,g[z].y,g[z].size)}t.attr($.extend({fill:g[z].data.color,stroke:g[z].data.color},a.options.bubbleStyle));a.visualSet.push(t);var x={data:{name:g[z].data.name+" ("+g[z].coords[2]+")",valueString:g[z].data.valueString+" ("+g[z].coords[0]+" | "+g[z].coords[1]+")",objectId:g[z].data.objectId},path:t};var c=$.proxy(a.eventing.onMouseOver,x);var w=$.proxy(a.eventing.onMouseOut,x);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+x.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+x.data.objectId,w)}t.mouseover(c);t.mousemove($.proxy(a.eventing.onMouseMove,x));t.mouseout(w)}a.grid.postDisplayMods(a.options.gridPostOptions);var e=0;for(var z=0;z<G.length;z++){G[z].obj.stop();G[z].obj.animate(G[z].anim);e=Math.max(e,G[z].anim.ms+G[z].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},e);if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Area=function(b){var a=new InfoCharts.Visuals.Lines(b);a.options.showArea=true;a.options.showLines=true;a.options.gridPostOptions={gridToFront:false,labelsToFront:true,baseLinesToFront:false,gridHide:false,labelsHide:false,baseLinesHide:false};a.options.pathStyle["stroke-width"]=0;return a};InfoCharts.Visuals.StackedLines=function(b){var a=new InfoCharts.Visuals.Lines(b);a.options.showArea=false;a.options.showLines=true;a.options.stacked=true;a.options.pathStyle={"stroke-width":3,"fill-opacity":1};return a};InfoCharts.Visuals.StackedArea=function(b){var a=new InfoCharts.Visuals.Streamgraph(b);a.options.alignment="bottom";a.options.showPoints=true;return a};InfoCharts.Visuals.Streamgraph=function(b){var a=this;a.root=b;a.options={smooth:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,showPoints:false,showLines:true,showArea:true,stacked:false,alignment:"center",tooltipForLines:true,tooltipForPoints:true,absoluteDistribution:false,complexAnimations:false,complexAnimationPower:2,gridPostOptions:{gridToFront:false,labelsToFront:true,baseLinesToFront:false},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},pathStyle:{"stroke-width":0.5,opacity:1},circleStyle:{"stroke-width":1.5,fill:"#FFFFFF",r:3},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},_gridOptions:{}};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);if(a.options.smooth){a.options.complexAnimations=false}return a};a.state={currentState:{line:{path:null,attr:null},points:[]},newState:{line:{path:null,attr:null},points:[]},minMax:null,interactionsEnabled:false,axesTitle:null};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(Y,v,C,X,x){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(C){a.data=InfoCharts.Helper.Data.copyDataArray(Y);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(X);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(x)}else{a.data=Y}var f=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var l=InfoCharts.Helper.Data.getGroups(a.data);v=v||l[0]||null;var G=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,v);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,v)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,v);var J=0;_.each(a.visualSet,function(e){e.stop()});a.visualSet.remove();a.visualSet=a.root.paper.set();var L=0;var f=a.root.getCenter();if(C){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&l.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:v,onClickCallback:a.eventing.onGroupChanged}),l);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:f.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var r=InfoCharts.Helper.Data.getLabelsUniq(G);if(r.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),r);L=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,L);if(a.labels){a.labels.setPosition({x:f.x,y:a.root.options.canvasHeight-L/2})}if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var w=0;var t=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){w=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){t=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}a.background.attr({x:0+w,y:a.buttonHeight,width:a.root.options.canvasWidth-w*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),height:a.root.options.canvasHeight-a.buttonHeight-L-t});a.background.bb=a.background.getBBox();if(w){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:w/2,y:a.background.bb.y+a.background.bb.height/2})}if(t){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+t/2})}if(a.options.hasGroups&&a.options.absoluteDistribution){if(C){a.state.minMax={min:NaN,max:NaN};_.each(l,function(g){var e;e=InfoCharts.Helper.Data.copyDataArray(_.filter(a.data,function(i){return i.group==g}));e=InfoCharts.Helper.Data.transformStreamPoints(e,a.options.alignment,true,a.options._gridOptions.gridDef?a.options._gridOptions.gridDef[0]:null);a.state.minMax.max=isNaN(a.state.minMax.max)?e.minMax.max:Math.max(a.state.minMax.max,e.minMax.max);a.state.minMax.min=isNaN(a.state.minMax.min)?e.minMax.min:Math.min(a.state.minMax.min,e.minMax.min)})}}else{a.state.minMax=null}var h;h=InfoCharts.Helper.Data.copyDataArray(G);h=InfoCharts.Helper.Data.transformStreamPoints(h,a.options.alignment,true,a.options._gridOptions.gridDef?a.options._gridOptions.gridDef[0]:null);a.state.minMax=a.state.minMax||h.minMax;a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[0+w,a.buttonHeight],size:[a.root.options.canvasWidthDefault-w*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-L-t],offset:[{start:0,end:0},{start:0,end:0}],minMax:[{min:NaN,max:NaN},a.state.minMax],canResize:false}),a.options.absoluteDistribution?a.data:G);G=h.data;a.grid.createGrid();var T=null;var y=null;var O=null;var o=null;var m=0;var R=null;var Q=null;var B="M";var o=null;var K=a.root.paper.set();var n=a.grid.getGridPosition([0,(h.offset!=0?(h.minMax.max-h.minMax.min)/2:0)]);if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var k=[];var c=[];for(var S=0;S<G.length;S++){m=0;y=[];newPathBottom=[];Q=[];animPathBottom=[];R=a.root.paper.set();for(var U=0;U<G[S].range.length;U++){B="M";var d=0,A=0,H=0;if(a.options.complexAnimations){for(var P=1;P<=G[S].range[U].length;P++){H+=Math.pow(P,a.options.complexAnimationPower)}}for(var V=0;V<G[S].range[U].length;V++){T=a.grid.getGridPosition([G[S].range[U][V][0],G[S].range[U][V][1].top]);posDataBottom=a.grid.getGridPosition([G[S].range[U][V][0],G[S].range[U][V][1].bottom]);if(a.options.showLines){y[m]=[B,T[0].value,T[1].value];if(newPathBottom.length>0){newPathBottom[m]=["LL",posDataBottom[0].value,posDataBottom[1].value]}else{newPathBottom[m]=["L",posDataBottom[0].value,posDataBottom[1].value]}if(a.root.options.canAnimate){Q[m]=[B,T[0].value,n[1].value];if(animPathBottom.length>0){animPathBottom[m]=["LL",posDataBottom[0].value,n[1].value]}else{animPathBottom[m]=["L",posDataBottom[0].value,n[1].value]}}}if(a.options.complexAnimations){A=a.root.options.animationDuration*1.5/H*Math.pow(V+2,a.options.complexAnimationPower)}if(a.options.showPoints&&!G[S].range[U][V][2]){if(a.root.options.canAnimate){if(!a.options.complexAnimations){o=a.root.paper.circle(T[0].value,n[1].value,0);k.push({obj:o,anim:Raphael.animation({cx:T[0].value,cy:T[1].value},a.root.options.animationDuration,a.root.options.animationStyle)})}else{o=a.root.paper.circle(T[0].value,T[1].value,0).attr({opacity:0});k.push({obj:o,anim:Raphael.animation({opacity:1},0,a.root.options.animationStyle).delay(d)})}}else{o=a.root.paper.circle(T[0].value,T[1].value,0)}if(a.options.tooltipForPoints){var s={data:{objectId:G[S].objectId,name:G[S].name,valueString:G[S].originalValue[U][V][0]+" | "+G[S].originalValue[U][V][1]},path:a.root.paper.set().push(o)};var z=$.proxy(a.eventing.onMouseOver,s);var F=$.proxy(a.eventing.onMouseOut,s);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+s.data.objectId,z);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+s.data.objectId,F)}o.mouseover(z);o.mousemove($.proxy(a.eventing.onMouseMove,s));o.mouseout(F)}R.push(o)}if(a.options.complexAnimations){d+=A}m++;B="LL"}}var q=a.root.paper.set();y=InfoCharts.Helper.Misc.linePathToCurvedPath(y,a.root,false,a.options.smooth);newPathBottom=InfoCharts.Helper.Misc.linePathToCurvedPath(newPathBottom,a.root,true,a.options.smooth);Q=InfoCharts.Helper.Misc.linePathToCurvedPath(Q,a.root,false,a.options.smooth);animPathBottom=InfoCharts.Helper.Misc.linePathToCurvedPath(animPathBottom,a.root,true,a.options.smooth);if(y.length>=2){var j=[];for(var M=0;M<Q.length;M++){j[M]=Q[M];j[Q.length+M]=animPathBottom[Q.length-M-1]}Q=j;var D=[];for(var M=0;M<y.length;M++){D[M]=y[M];D[y.length+M]=newPathBottom[y.length-M-1]}y=D;if(a.root.options.canAnimate){if(!a.options.complexAnimations){O=a.root.paper.path(Q);k.push({obj:O,anim:Raphael.animation({path:y},a.root.options.animationDuration,a.root.options.animationStyle)})}else{O=a.root.paper.path();var d=0,A=0,H=0;for(var P=1;P<=y.length/2;P++){H+=Math.pow(P,a.options.complexAnimationPower)}for(var Z=1,E=y.length/2;Z<=E;Z++){var N=y.slice(0,Z)+y.slice(y.length-Z,y.length);var W=y.slice(0,Z)+y.slice(Z-1,Z)+y.slice(y.length-Z,y.length-Z+1)+y.slice(y.length-Z,y.length);A=a.root.options.animationDuration*1.5/H*Math.pow(Z,a.options.complexAnimationPower);c.push({obj:O,anim:Raphael.animation({path:N},A,a.root.options.animationStyle).delay(d),state:{path:W}});d+=A}}}else{O=a.root.paper.path(y)}if(a.options.showLines&&a.options.showArea){O.attr($.extend({stroke:G[S].color,fill:G[S].color},a.options.pathStyle))}else{O.attr($.extend({stroke:G[S].color},a.options.pathStyle))}a.visualSet.push(O);q.push(O);var s={data:{name:G[S].name,valueString:G[S].valueString,objectId:G[S].objectId},path:q};var z=$.proxy(a.eventing.onMouseOver,s);var F=$.proxy(a.eventing.onMouseOut,s);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+s.data.objectId,z);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+s.data.objectId,F)}if(a.options.showLines){if(a.options.tooltipForLines&&!a.options.tooltipForPoints){q.mouseover(z);q.mousemove($.proxy(a.eventing.onMouseMove,s));q.mouseout(F)}else{if(a.options.tooltipForLines){O.mouseover(z);O.mousemove($.proxy(a.eventing.onMouseMove,s));O.mouseout(F)}}}}if(a.options.showPoints){R.attr($.extend({stroke:G[S].color,fill:G[S].color},a.options.circleStyle));a.visualSet.push(R);q.push(R);K.push(R)}}a.grid.postDisplayMods(a.options.gridPostOptions);K.toFront();var I=0;for(var S=0;S<k.length;S++){k[S].obj.stop();k[S].obj.animate(k[S].anim);I=Math.max(I,k[S].anim.ms+k[S].anim.del)}for(var S=0;S<c.length;S++){c[S].obj.animate(c[S].anim);c[S].obj.attr(c[S].state);I=Math.max(I,c[S].anim.ms+c[S].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},I);if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(d){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({stroke:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path[0].attr("stroke");var c=InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId]);this.path.attr({stroke:c});if(a.options.showArea&&this.path[0].type=="path"){this.path[0].attr({fill:c})}if(a.root.options.canGlowPath){var f=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(f);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&d){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&d&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({stroke:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.showArea&&this.path[0].type=="path"){this.path[0].attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.Lines=function(b){var a=this;a.root=b;a.options={smooth:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,panelMarginY:15,showPoints:true,showLines:true,showArea:false,stacked:false,tooltipForLines:true,tooltipForPoints:true,absoluteDistribution:false,complexAnimations:false,complexAnimationPower:2,complexAnimationDraw:false,gridPostOptions:{gridToFront:false,labelsToFront:false,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-opacity":0,"stroke-width":0,stroke:"none"},pathStyle:{"stroke-width":4,"stroke-linejoin":"round","stroke-linecap":"round","fill-opacity":1},circleStyle:{"stroke-width":3,fill:"#FFFFFF",r:5},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{},_gridOptions:{}};a.visualSet=null;a.data=null;a.buttons=null;a.labels=null;a.background=null;a.buttonHeight=0;a.gridDef=null;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);if(a.options.smooth){a.options.complexAnimations=false}return a};a.state={currentState:{line:{path:null,attr:null},points:[]},newState:{line:{path:null,attr:null},points:[]},minMax:null,interactionsEnabled:false,axesTitle:null};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(R,t,A,Q,v){a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(A){a.data=InfoCharts.Helper.Data.copyDataArray(R);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(Q);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(v)}else{a.data=R}var f=a.root.getCenter();InfoCharts.Helper.Data.setDefaults(a.data);var k=InfoCharts.Helper.Data.getGroups(a.data);t=t||k[0]||null;var D=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,t);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,t)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,t);_.each(a.visualSet,function(e){e.stop()});a.visualSet.remove();a.visualSet=a.root.paper.set();var H=0;var f=a.root.getCenter();if(A){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&k.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:t,onClickCallback:a.eventing.onGroupChanged}),k);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:f.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var q=InfoCharts.Helper.Data.getLabelsUniq(D);if(q.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),q);H=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,H);if(a.labels){a.labels.setPosition({x:f.x,y:a.root.options.canvasHeight-H/2})}if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var u=0;var s=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){u=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){s=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}a.background.attr({x:0+u,y:a.buttonHeight,width:a.root.options.canvasWidth-u*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),height:a.root.options.canvasHeight-a.buttonHeight-H-s});a.background.bb=a.background.getBBox();if(u){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:u/2,y:a.background.bb.y+a.background.bb.height/2})}if(s){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+s/2})}var h=null;if(a.options.stacked){if(a.options.hasGroups&&a.options.absoluteDistribution){if(A){a.state.minMax={min:NaN,max:NaN};_.each(k,function(g){var e;e=InfoCharts.Helper.Data.copyDataArray(_.filter(a.data,function(i){return i.group==g}));e=InfoCharts.Helper.Data.transformStackedPoints(e,a.options._gridOptions.gridDef?a.options._gridOptions.gridDef[0]:null);a.state.minMax.max=isNaN(a.state.minMax.max)?e.minMax.max:Math.max(a.state.minMax.max,e.minMax.max);a.state.minMax.min=isNaN(a.state.minMax.min)?e.minMax.min:Math.min(a.state.minMax.min,e.minMax.min)})}}else{a.state.minMax=null}h=InfoCharts.Helper.Data.copyDataArray(D);h=InfoCharts.Helper.Data.transformStackedPoints(h,a.options._gridOptions.gridDef?a.options._gridOptions.gridDef[0]:null);a.state.minMax=a.state.minMax||h.minMax}else{h={};h.minMax={min:NaN,max:NaN};a.state.minMax=h.minMax}a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[u,a.buttonHeight],size:[a.root.options.canvasWidthDefault-u*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-H-s],offset:[{start:0,end:0},{start:0,end:0}],minMax:[{min:NaN,max:NaN},a.state.minMax],canResize:false}),a.options.absoluteDistribution?a.data:D);if(h.data){D=h.data}a.grid.createGrid();var N=null;var w=null;var I=null;var n=null;var l=0;var L=null;var K=null;var z="M";var n=null;var G=a.root.paper.set();var m=a.grid.getGridPositionBase();if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var j=[];var c=[];for(var M=0;M<D.length;M++){l=0;w=[];K=[];L=a.root.paper.set();for(var O=0;O<D[M].value.length;O++){z="M";var d=0,y=0,E=0;if(a.options.complexAnimations){for(var J=0;J<D[M].value[O].length;J++){E+=Math.pow(J+1,a.options.complexAnimationPower)}}for(var P=0;P<D[M].value[O].length;P++){if(a.options.stacked){N=a.grid.getGridPosition(D[M].value[O][P])}else{N=a.grid.getValuePosition(D[M].value[O][P])}if(a.options.showLines&&a.options.showArea&&P==0){w[l]=[z,N[0].value,m[1].value];if(a.root.options.canAnimate){K[l]=[z,N[0].value,m[1].value]}l++;z="L"}if(a.options.showLines){w[l]=[z,N[0].value,N[1].value];if(a.root.options.canAnimate){K[l]=[z,N[0].value,m[1].value]}}if(a.options.complexAnimations){y=a.root.options.animationDuration*1.5/E*Math.pow(P+1,a.options.complexAnimationPower)}if(a.options.showPoints&&!D[M].value[O][P][2]){if(a.root.options.canAnimate){if(!a.options.complexAnimations){n=a.root.paper.circle(N[0].value,m[1].value,0);if(!a.options.showLines){j.push({obj:n,anim:Raphael.animation({cx:N[0].value,cy:N[1].value},a.root.options.animationDuration,a.root.options.animationStyle).delay(a.root.options.animationDuration/D[M].value[O].length*P)})}else{j.push({obj:n,anim:Raphael.animation({cx:N[0].value,cy:N[1].value},a.root.options.animationDuration,a.root.options.animationStyle)})}}else{n=a.root.paper.circle(N[0].value,N[1].value,0).attr({opacity:0});j.push({obj:n,anim:Raphael.animation({opacity:1},0,y).delay(d)})}}else{n=a.root.paper.circle(N[0].value,N[1].value,0)}if(a.options.tooltipForPoints){var r;if(a.options.stacked){r={data:{objectId:D[M].objectId,name:D[M].name,valueString:D[M].valueString+" ("+D[M].originalValue[O][P][0]+" | "+D[M].originalValue[O][P][1]+")"},path:a.root.paper.set().push(n)}}else{r={data:{objectId:D[M].objectId,name:D[M].name,valueString:D[M].valueString+" ("+N[0].data.valueString+" | "+N[1].data.valueString+")"},path:a.root.paper.set().push(n)}}var x=$.proxy(a.eventing.onMouseOver,r);var C=$.proxy(a.eventing.onMouseOut,r);n.mouseover(x);n.mousemove($.proxy(a.eventing.onMouseMove,r));n.mouseout(C);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+r.data.objectId,x);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+r.data.objectId,C)}}L.push(n)}d+=y;if(a.options.showLines&&a.options.showArea&&P==(D[M].value[O].length-1)){l++;w[l]=["L",N[0].value,m[1].value];if(a.root.options.canAnimate){K[l]=["L",N[0].value,m[1].value]}}l++;z="LL"}}var o=a.root.paper.set();w=InfoCharts.Helper.Misc.linePathToCurvedPath(w,a.root,false,a.options.smooth);K=InfoCharts.Helper.Misc.linePathToCurvedPath(K,a.root,false,a.options.smooth);if(w.length>=2){if(a.root.options.canAnimate){if(!a.options.complexAnimations){I=a.root.paper.path(K);j.push({obj:I,anim:Raphael.animation({path:w},a.root.options.animationDuration,a.root.options.animationStyle)})}else{I=a.root.paper.path(w.slice(0,1));var d=0,y=0,E=0;newP=null,newP2=null,anim=null;for(var J=1;J<=w.length;J++){E+=Math.pow(J,a.options.complexAnimationPower)}for(var S=1,B=w.length;S<=B;S++){y=a.root.options.animationDuration*1.5/E*Math.pow(S,a.options.complexAnimationPower);if(a.options.complexAnimationDraw&&!a.options.showArea){newP=w.slice(0,S);newP2=w.slice(0,S)}else{newP=w.slice(0,S)+K.slice(S,K.length);newP2=w.slice(0,S)+K.slice(S,K.length)}c.push({obj:I,anim:Raphael.animation({path:newP},y,a.root.options.animationStyle).delay(d),state:{path:newP2}});d+=y}}}else{I=a.root.paper.path(w)}if(a.options.showLines&&a.options.showArea){I.attr($.extend({stroke:D[M].color,fill:D[M].color},a.options.pathStyle))}else{I.attr($.extend({stroke:D[M].color},a.options.pathStyle))}a.visualSet.push(I);o.push(I);var r={data:{name:D[M].name,valueString:D[M].valueString,objectId:D[M].objectId},path:o};var x=$.proxy(a.eventing.onMouseOver,r);var C=$.proxy(a.eventing.onMouseOut,r);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+r.data.objectId,x);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+r.data.objectId,C)}if(a.options.showLines){if(a.options.tooltipForLines&&!a.options.tooltipForPoints){o.mouseover(x);o.mousemove($.proxy(a.eventing.onMouseMove,r));o.mouseout(C)}else{if(a.options.tooltipForLines){I.mouseover(x);I.mousemove($.proxy(a.eventing.onMouseMove,r));I.mouseout(C)}}}}if(a.options.showPoints){L.attr($.extend({stroke:D[M].color,fill:D[M].color},a.options.circleStyle));a.visualSet.push(L);o.push(L);G.push(L)}}a.grid.postDisplayMods(a.options.gridPostOptions);G.toFront();var F=0;for(var M=0;M<j.length;M++){j[M].obj.stop();j[M].obj.animate(j[M].anim);F=Math.max(F,j[M].anim.ms+j[M].anim.del)}for(var M=0;M<c.length;M++){c[M].obj.animate(c[M].anim);c[M].obj.attr(c[M].state);F=Math.max(F,c[M].anim.ms+c[M].anim.del)}if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}setTimeout(function(){a.state.interactionsEnabled=true},F);if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(d){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({stroke:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path[0].attr("stroke");var c=InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId]);this.path.attr({stroke:c});if(a.options.showArea&&this.path[0].type=="path"){this.path[0].attr({fill:c})}if(a.root.options.canGlowPath){var f=$.extend({color:c},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(f);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&d){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&d&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({stroke:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.options.showArea&&this.path[0].type=="path"){this.path[0].attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]})}if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.HorizontalStackBars=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,showCategorys:true,style:"bar-bar",panelMarginY:15,barMaxWidth:40,barSpaceFraction:0.8,absoluteDistribution:false,showInLineValues:false,inTextStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,fill:"#FFFFFF"},chartDistribution:{canvasMargin:0.5,groupMargin:0.5,barMargin:0},gridPostOptions:{gridToFront:false,labelsToFront:false,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyle:{"stroke-width":0,"stroke-opacity":0,opacity:1,stroke:"none"},textStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,cursor:"default"},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_categoryOptions:{},_gridOptions:{},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.data=null;a.set=null;a.background=null;a.grid=null;a.buttons=null;a.labels=null;a.categoryLabel=null;a.tooltip=null;a.buttonHeight=0;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.state={currentState:[],interactionsEnabled:false,axesTitle:null,actionCounter:0,inTextStyleFontSize:0};a.init=function(c){a.set=a.root.paper.set();a.options=$.extend(a.root.options.deepExtend,a.options,c);a.state.inTextStyleFontSize=a.options.inTextStyle["font-size"];a.set=a.root.paper.set();a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.setPosition=function(c){a.set.transform(["T",c.x,c.y])};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(g,d,h,s,f){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(h){a.data=InfoCharts.Helper.Data.copyDataArray(g);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(s);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(f)}else{a.data=g}InfoCharts.Helper.Data.setDefaults(a.data);var o=0;var e=a.root.getCenter();var i=InfoCharts.Helper.Data.getGroups(a.data);d=d||i[0]||"";var k=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,d);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,d)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,d);a.state.axesTitle[0]=null;var c=InfoCharts.Helper.Data.getPropertyValuesUniq(k,"category");a.options.barSpaceFraction=1-c.length/(c.length+9);if(h){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&i.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:d,onClickCallback:a.eventing.onGroupChanged}),i);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:e.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.categoryLabel){a.categoryLabel.dispose();a.categoryLabel=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var r=InfoCharts.Helper.Data.getLabelsUniq(k,a.options.hasValueInLabel);if(r.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),r);o=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,o);if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var l=0;var j=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){l=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){j=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}var p=(a.root.options.canvasHeight-o)-(a.buttonHeight);var n=a.buttonHeight;a.background.attr({x:0+l,width:a.root.options.canvasWidth-l*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),y:n,height:p-j});a.background.bb=a.background.getBBox();var q=-1;if(a.options.showCategorys&&c&&c.length>1){a.categoryLabel=new InfoCharts.Visuals.CategorysHorizontal(a.root,a).init(a.options._categoryOptions,k,true);q=a.categoryLabel.height+2;a.categoryLabel.setPosition({x:a.categoryLabel.height/2,y:n})}a.background.attr({x:q+l,width:a.root.options.canvasWidth-q-l*(a.options.axesTitleBalanceHorizontalSpaceing?2:1)});var m={min:NaN,max:NaN};if(a.options.absoluteDistribution&&a.options.hasGroups){_.each(i,function(t){a.getGroupMinMax(_.filter(a.data,function(u){return u.group==t}),a.options.showCategorys?c:[""],m)})}else{a.getGroupMinMax(k,a.options.showCategorys?c:[""],m)}a.background.bb=a.background.getBBox();if(l){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:l/2+q,y:a.background.bb.y+a.background.bb.height/2})}if(j){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+j/2})}a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[q+l,a.buttonHeight],size:[a.root.options.canvasWidthDefault-q-l*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-o-j],offset:[{start:0,end:0},{start:0,end:0}],zeroValues:[{top:0,bottom:1},{top:1,bottom:0}],hideGrid:[false,true],showGridOnEdge:false,canResize:false,labelXToBottom:false,minMax:[m,{min:NaN,max:NaN}]}),a.options.absoluteDistribution?a.data:k,"x");a.grid.createGrid();if(a.labels){a.labels.setPosition({x:e.x,y:a.root.options.canvasHeight-o/2})}a.generateBars(k);a.grid.postDisplayMods(a.options.gridPostOptions);if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.getGroupMinMax=function(g,e,d){var f={};var c={};_.each(g,function(h){if(e.length==1&&e[0]==""){c[""]=c[""]||0;f[""]=f[""]||0;if(h.value>0){c[""]+=h.value}else{f[""]+=h.value}}else{c[h.category]=c[h.category]||0;f[h.category]=f[h.category]||0;if(h.value>0){c[h.category]+=h.value}else{f[h.category]+=h.value}}});_.each(e,function(h){d.max=isNaN(d.max)?c[h]:Math.max(d.max,c[h]);d.min=isNaN(d.min)?f[h]:Math.min(d.min,f[h])})};a.generateBars=function(G){_.each(a.set,function(i){i.stop()});a.set.remove();a.set=a.root.paper.set();var A=a.options.barMaxWidth;var l=a.options.showCategorys?InfoCharts.Helper.Data.getPropertyValuesUniq(G,"category"):[""];var t=a.background.bb.height-a.options.textStyle["font-size"];var r=Math.round((t)/(l.length)*a.options.barSpaceFraction);if(r>A){r=A}t=(t-r*l.length);var D=t/2*a.options.chartDistribution.canvasMargin;var q=t/2/(!a.options.showCategorys?1:l.length)*a.options.chartDistribution.groupMargin;var w=t/2/G.length*a.options.chartDistribution.barMargin;var m=a.background.bb.y+D;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var p=0;var h=(!a.options.showCategorys?1:l.length);var H=[];for(var z=0;z<h;z++){var k=_.filter(G,function(i){return !a.options.showCategorys||i.category==l[z]});var E=0;var o=0;m+=q;m+=w;for(var y=0;y<k.length;y++){var g=k[y].styleName||a.options.style;var C=g;g+="-horizontal";var F="ipg-"+g;if(InfoCharts.Visuals.ShapeGenerator.Anim[g]){InfoCharts.Visuals.ShapeGenerator.Anim[g](a.root.paper,F)}else{g=C.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path-horizontal"](a.root.paper,F,g)}var e=a.grid.getValuePositionX(k[y].value);var d=a.root.paper.path();if(true){if(a.state.currentState[p]&&a.state.currentState[p].colIndex==z){a.state.currentState[p].anim[1]=m+r/2;d.attr(InfoCharts.Helper.Misc.addProperty(a.state.currentState[p].base,F,a.state.currentState[p].anim))}else{d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle),F,[e.baseline,m+r/2,0,r]))}a.state.currentState[p]={};if(e.dev<0){a.state.currentState[p].anim=[e.baseline-E,m+r/2,e.height,r]}else{a.state.currentState[p].anim=[e.baseline+o,m+r/2,e.height,r]}a.state.currentState[p].base=$.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle);a.state.currentState[p].colIndex=z;var n=$.proxy(a.afterAnimation,{anim:a.state.currentState[p].anim,data:k[y],shape:d,vb:e,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){H.push({obj:d,anim:Raphael.animation(InfoCharts.Helper.Misc.addProperty($.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle),F,a.state.currentState[p].anim),a.root.options.animationDuration,a.root.options.animationStyle,n).delay(z/h*a.root.options.animationSequenceDuration)})}else{d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle),F,a.state.currentState[p].anim));n()}}a.set.push(d);var v={data:k[y],path:d};var c=$.proxy(a.eventing.onMouseOver,v);var u=$.proxy(a.eventing.onMouseOut,v);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+v.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+v.data.objectId,u)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,v));d.mouseout(u);if(e.dev<0){E-=e.height}else{o+=e.height}p++}m+=r+w;m+=q}var B=null;while(a.state.currentState.length>p){B=a.state.currentState.pop();B=null}a.grid.baseLine.toFront();var f=0;for(var z=0;z<H.length;z++){H[z].obj.stop();H[z].obj.animate(H[z].anim);f=Math.max(f,H[z].anim.ms+H[z].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f)};a.afterAnimation=function(){if(a.options.showInLineValues&&this.actionCounter===a.state.actionCounter){var g=this.data;if(g.inValueString.length>0){var f=this.anim;var c=this.shape.getBBox();var e=this.vb;if(c.height<=15){return}a.options.inTextStyle["font-size"]=a.state.inTextStyleFontSize;var d=InfoCharts.Helper.Misc.getContrastColor(a.options.inTextStyle.fill,g.color);var i=f[0]-e.baseline;do{var h=a.root.paper.text(e.baseline-3*-e.dev+i,f[1],g.inValueString).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({},a.options.inTextStyle,{"text-anchor":((-e.dev>0)?"end":"start"),fill:d})));h.bb=h.getBBox();if((h.bb.width+6)<c.width&&h.bb.height<c.height){a.set.push(h);break}else{h.remove();a.options.inTextStyle["font-size"]-=1}}while(a.options.inTextStyle["font-size"]>=8)}}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.VerticalStackBars=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,showCategorys:true,style:"bar-bar",panelMarginY:15,barMaxWidth:40,barSpaceFraction:0.8,absoluteDistribution:false,chartDistribution:{canvasMargin:0.5,groupMargin:0.5,barMargin:0},showInLineValues:false,inTextStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,fill:"#FFFFFF"},gridPostOptions:{gridToFront:false,labelsToFront:false,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyle:{"stroke-width":0,"stroke-opacity":0,opacity:1,stroke:"none"},textStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,cursor:"default"},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_categoryOptions:{},_gridOptions:{},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.data=null;a.set=null;a.background=null;a.grid=null;a.buttons=null;a.labels=null;a.categoryLabel=null;a.tooltip=null;a.buttonHeight=0;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.state={currentState:[],interactionsEnabled:false,axesTitle:null,actionCounter:0,inTextStyleFontSize:0};a.init=function(c){a.set=a.root.paper.set();a.options=$.extend(a.root.options.deepExtend,a.options,c);a.state.inTextStyleFontSize=a.options.inTextStyle["font-size"];a.set=a.root.paper.set();a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.setPosition=function(c){a.set.transform(["T",c.x,c.y])};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(g,d,h,s,f){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(h){a.data=InfoCharts.Helper.Data.copyDataArray(g);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(s);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(f)}else{a.data=g}InfoCharts.Helper.Data.setDefaults(a.data);var o=0;var e=a.root.getCenter();var i=InfoCharts.Helper.Data.getGroups(a.data);d=d||i[0]||"";var k=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,d);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,d)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,d);a.state.axesTitle[1]=null;var c=InfoCharts.Helper.Data.getPropertyValuesUniq(k,"category");a.options.barSpaceFraction=1-c.length/(c.length+9);if(h){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&i.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:d,onClickCallback:a.eventing.onGroupChanged}),i);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:e.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.categoryLabel){a.categoryLabel.dispose();a.categoryLabel=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var r=InfoCharts.Helper.Data.getLabelsUniq(k,a.options.hasValueInLabel);if(r.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),r);o=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,o);var n={min:NaN,max:NaN};if(a.options.absoluteDistribution&&a.options.hasGroups){_.each(i,function(t){a.getGroupMinMax(_.filter(a.data,function(u){return u.group==t}),a.options.showCategorys?c:[""],n)})}else{a.getGroupMinMax(k,a.options.showCategorys?c:[""],n)}if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var l=0;var j=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){l=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){j=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[0+l,a.buttonHeight],size:[a.root.options.canvasWidthDefault-l*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-o-j],offset:[{start:0,end:0},{start:0,end:0}],zeroValues:[{top:1,bottom:0},{top:0,bottom:1}],hideGrid:[true,false],showGridOnEdge:false,labelXToBottom:false,minMax:[{min:NaN,max:NaN},n]}),k,"y");a.grid.createGrid();var p=(a.root.options.canvasHeight-o)-(a.buttonHeight)-j;var m=a.buttonHeight;a.background.attr({y:m,height:p,x:0+l,width:a.root.options.canvasWidth-l*(a.options.axesTitleBalanceHorizontalSpaceing?2:1)});a.background.bb=a.background.getBBox();if(l){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:l/2,y:a.background.bb.y+a.background.bb.height/2})}if(j){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+j/2})}var q=0;if(a.options.showCategorys&&c&&c.length>1){a.categoryLabel=new InfoCharts.Visuals.Categorys(a.root,a).init(a.options._categoryOptions,k,true);q=a.categoryLabel.height+2;a.categoryLabel.setPosition({x:0,y:m+p+a.categoryLabel.height/2+2+j})}a.root.resize(a.root.options.canvasWidth,a.root.options.canvasHeight+q);if(a.labels){a.labels.setPosition({x:e.x,y:a.root.options.canvasHeight-o/2})}a.generateBars(k);a.grid.postDisplayMods(a.options.gridPostOptions);if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.getGroupMinMax=function(g,e,d){var f={};var c={};_.each(g,function(h){if(e.length==1&&e[0]==""){c[""]=c[""]||0;f[""]=f[""]||0;if(h.value>0){c[""]+=h.value}else{f[""]+=h.value}}else{c[h.category]=c[h.category]||0;f[h.category]=f[h.category]||0;if(h.value>0){c[h.category]+=h.value}else{f[h.category]+=h.value}}});_.each(e,function(h){d.max=isNaN(d.max)?c[h]:Math.max(d.max,c[h]);d.min=isNaN(d.min)?f[h]:Math.min(d.min,f[h])})};a.generateBars=function(F){_.each(a.set,function(i){i.stop()});a.set.remove();a.set=a.root.paper.set();var A=a.options.barMaxWidth;var l=a.options.showCategorys?InfoCharts.Helper.Data.getPropertyValuesUniq(F,"category"):[""];var t=a.root.options.canvasWidth-a.grid.state.axisSize[1];var r=Math.round((t)/(l.length)*a.options.barSpaceFraction);if(r>A){r=A}t=(t-r*l.length);var C=t/2*a.options.chartDistribution.canvasMargin;var q=t/2/(!a.options.showCategorys?1:l.length)*a.options.chartDistribution.groupMargin;var w=t/2/F.length*a.options.chartDistribution.barMargin;var m=C+a.grid.state.axisSize[1];var p=0;var h=(!a.options.showCategorys?1:l.length);if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var G=[];for(var z=0;z<h;z++){var k=_.filter(F,function(i){return !a.options.showCategorys||i.category==l[z]});var D=0;var o=0;m+=q;m+=w;for(var y=0;y<k.length;y++){var g=k[y].styleName||a.options.style;var E="ipg-"+g;if(InfoCharts.Visuals.ShapeGenerator.Anim[g]){InfoCharts.Visuals.ShapeGenerator.Anim[g](a.root.paper,E)}else{g=g.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path"](a.root.paper,E,g)}var e=a.grid.getValuePositionY(k[y].value);var d=a.root.paper.path();if(true){if(a.state.currentState[p]&&a.state.currentState[p].colIndex==z){a.state.currentState[p].anim[0]=m+r/2;d.attr(InfoCharts.Helper.Misc.addProperty(a.state.currentState[p].base,E,a.state.currentState[p].anim))}else{d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle),E,[m+r/2,e.baseline,r,0]))}a.state.currentState[p]={};if(e.dev<0){a.state.currentState[p].anim=[m+r/2,e.baseline-D,r,e.height]}else{a.state.currentState[p].anim=[m+r/2,e.baseline+o,r,e.height]}a.state.currentState[p].colIndex=z;a.state.currentState[p].base=$.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle);var n=$.proxy(a.afterAnimation,{anim:a.state.currentState[p].anim,data:k[y],shape:d,vb:e,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){G.push({obj:d,anim:Raphael.animation(InfoCharts.Helper.Misc.addProperty($.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle),E,a.state.currentState[p].anim),a.root.options.animationDuration,a.root.options.animationStyle,n).delay(z/h*a.root.options.animationSequenceDuration)})}else{d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:k[y].color,stroke:k[y].color},a.options.shapeStyle),E,a.state.currentState[p].anim));n()}}a.set.push(d);var v={data:k[y],path:d};var c=$.proxy(a.eventing.onMouseOver,v);var u=$.proxy(a.eventing.onMouseOut,v);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+v.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+v.data.objectId,u)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,v));d.mouseout(u);if(e.dev<0){D-=e.height}else{o+=e.height}p++}m+=r+w;m+=q}var B=null;while(a.state.currentState.length>p){B=a.state.currentState.pop();B=null}a.grid.baseLine.toFront();var f=0;for(var z=0;z<G.length;z++){G[z].obj.stop();G[z].obj.animate(G[z].anim);f=Math.max(f,G[z].anim.ms+G[z].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f)};a.afterAnimation=function(){if(a.options.showInLineValues&&this.actionCounter===a.state.actionCounter){var g=this.data;if(g.inValueString.length>0){var f=this.anim;var c=this.shape.getBBox();var e=this.vb;if(c.width<=15){return}a.options.inTextStyle["font-size"]=a.state.inTextStyleFontSize;var d=InfoCharts.Helper.Misc.getContrastColor(a.options.inTextStyle.fill,g.color);do{var h=a.root.paper.text(f[0],f[1]-a.options.inTextStyle["font-size"]/2*e.dev*-1,g.inValueString).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({},a.options.inTextStyle,{"text-anchor":((e.dev*-1<0)?"end":"start"),fill:d})));h.bb=h.getBBox();if((h.bb.height)<c.width&&(h.bb.width+a.options.inTextStyle["font-size"])<c.height){h.transform(["R",-90,f[0],f[1]-a.options.inTextStyle["font-size"]/2*e.dev*-1]);a.set.push(h);break}else{h.remove();a.options.inTextStyle["font-size"]-=1}}while(a.options.inTextStyle["font-size"]>=8)}}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.HorizontalBars=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,autoLabelToggle:true,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,showBarLabels:true,showCategorys:true,style:"bar-bar",panelMarginY:15,barMaxWidth:40,barMinWidth:25,barSpaceFraction:0.8,absoluteDistribution:false,showInLineValues:false,inTextStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,fill:"#FFFFFF"},chartDistribution:{canvasMargin:0.15,groupMargin:0.7,barMargin:0.15},gridPostOptions:{gridToFront:false,labelsToFront:false,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},textStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,cursor:"default"},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_categoryOptions:{},_gridOptions:{},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.data=null;a.set=null;a.background=null;a.grid=null;a.buttons=null;a.labels=null;a.categoryLabel=null;a.tooltip=null;a.buttonHeight=0;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.state={currentState:[],showBarLabels:true,interactionsEnabled:false,axesTitle:null,inTextStyleFontSize:0,actionCounter:0};a.init=function(c){a.set=a.root.paper.set();a.options=$.extend(a.root.options.deepExtend,a.options,c);a.state.inTextStyleFontSize=a.options.inTextStyle["font-size"];a.state.showBarLabels=a.options.showBarLabels;a.set=a.root.paper.set();a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.setPosition=function(c){a.set.transform(["T",c.x,c.y])};a.loadData=function(g,e,d,f,c){if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(g,e,d,f,c)},0)}else{a.loadDataActual(g,e,d,f,c)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(r,y,q,u,g){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};a.options.showBarLabels=a.state.showBarLabels;if(q){a.data=InfoCharts.Helper.Data.copyDataArray(r);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(u);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(g)}else{a.data=r}InfoCharts.Helper.Data.setDefaults(a.data);var c=0;var x=a.root.getCenter();var w=InfoCharts.Helper.Data.getGroups(a.data);y=y||w[0]||"";var n=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,y);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,y)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,y);a.state.axesTitle[0]=null;var h=InfoCharts.Helper.Data.getPropertyValuesUniq(a.data,"category");a.options.barSpaceFraction=1-h.length/(h.length+9);if(q){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&w.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:y,onClickCallback:a.eventing.onGroupChanged}),w);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:x.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.categoryLabel){a.categoryLabel.dispose();a.categoryLabel=null}if(a.labels){a.labels.dispose();a.labels=null}var d=0;a.root.resizeHeight(a.buttonHeight,0,d);if(a.root.options.canvasHeightDefault-a.buttonHeight<(n.length*a.options.barMinWidth)*1.1){var k=(n.length*a.options.barMinWidth)*1.1+a.buttonHeight;d=k-a.root.options.canvasWidthDefault;if(k!==a.root.options.canvasHeight){}}else{if(a.root.options.canvasHeightDefault!==a.root.options.canvasHeight){}}a.root.resizeHeight(a.buttonHeight,0,d);if(a.options.autoLabelToggle){var s=a.root.options.canvasHeight-a.buttonHeight-a.options.textStyle["font-size"];var p=Math.round((s)/(n.length)*a.options.barSpaceFraction);if(p>a.options.barMaxWidth){p=a.options.barMaxWidth}if(a.options.textStyle["font-size"]>=p){a.options.showLabels=true;a.options.showBarLabels=false}else{a.options.showLabels=false;a.options.showBarLabels=true}}if(a.options.showLabels){var e=InfoCharts.Helper.Data.getLabelsUniq(n,a.options.hasValueInLabel);if(e.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),e);c=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,c,d);if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var m=0;var l=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){m=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){l=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}var v=(a.root.options.canvasHeight-c)-(a.buttonHeight);var t=a.buttonHeight;a.background.attr({y:t,height:v-l});a.background.bb=a.background.getBBox();var o=-1;if(a.options.showCategorys&&h&&h.length>1){a.categoryLabel=new InfoCharts.Visuals.CategorysHorizontal(a.root,a).init(a.options._categoryOptions,n);o=a.categoryLabel.height+2;a.categoryLabel.setPosition({x:a.categoryLabel.height/2,y:t})}a.background.attr({x:o+m,width:a.root.options.canvasWidth-o-m*(a.options.axesTitleBalanceHorizontalSpaceing?2:1)});var f={top:0,bottom:0};if(a.options.showBarLabels){f=a.getAxesOffsetTopBottom(n);if(f.bottom+f.top>=(a.root.options.canvasWidthDefault-o)*0.98){f.bottom=0;f.top=0;a.options.showBarLabels=false;a.options.showLabels=true;if(a.categoryLabel){a.categoryLabel.dispose();a.categoryLabel=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.showLabels){var e=InfoCharts.Helper.Data.getLabelsUniq(n);if(e.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),e);c=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,c,d);var v=(a.root.options.canvasHeight-c)-(a.buttonHeight);var t=a.buttonHeight;a.background.attr({y:t,height:v-l});a.background.bb=a.background.getBBox();var o=-1;if(a.options.showCategorys&&h&&h.length>1){a.categoryLabel=new InfoCharts.Visuals.CategorysHorizontal(a.root,a).init(a.options._categoryOptions,n);o=a.categoryLabel.height+2;a.categoryLabel.setPosition({x:a.categoryLabel.height/2,y:t})}}}a.background.bb=a.background.getBBox();if(m){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:o+m/2,y:a.background.bb.y+a.background.bb.height/2})}if(l){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+l/2})}a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[o+m,a.buttonHeight],size:[a.root.options.canvasWidthDefault-o-m*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeight-a.buttonHeight-c-l],offset:[{start:f.bottom,end:f.top},{start:0,end:0}],zeroValues:[{top:0,bottom:1},{top:1,bottom:0}],hideGrid:[false,true],showGridOnEdge:false,labelXToBottom:false,canResize:false}),a.options.absoluteDistribution?a.data:n,"x");if(f.bottom+f.top!=0){a.grid.createGrid(false);if(a.grid.state.maxVal[0]>0&&a.grid.state.minVal[0]<0){var j=Math.abs(a.grid.state.minVal[0]/(Math.abs(a.grid.state.minVal[0])+a.grid.state.maxVal[0]));a.grid.state.offset[0].start=a.grid.state.offset[0].start/(1-j);var i=Math.abs(a.grid.state.maxVal[0]/(Math.abs(a.grid.state.minVal[0])+a.grid.state.maxVal[0]));a.grid.state.offset[0].end=a.grid.state.offset[0].end/(1-i)}if(a.grid.state.offset[0].end+a.grid.state.offset[0].start>=(a.root.options.canvasWidthDefault-o)*0.9){a.options.showBarLabels=false}else{a.grid.options.pos=[o+a.grid.state.offset[0].start+m,a.buttonHeight];a.grid.options.size=[a.root.options.canvasWidthDefault-o-a.grid.state.offset[0].start-a.grid.state.offset[0].end-m*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeight-a.buttonHeight-c-l]}a.grid.options.offset=[{start:0,end:0},{start:0,end:0}]}a.grid.createGrid();if(a.labels){a.labels.setPosition({x:x.x,y:a.root.options.canvasHeight-c/2})}a.generateBars(n);a.grid.postDisplayMods(a.options.gridPostOptions);if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.getAxesOffsetTopBottom=function(e){if(a.options.showBarLabels){var d=_.reduce(e,function(f,g){if(typeof(g.value)==="number"&&g.value<0){var h=a.root.paper.text(0,0,g.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));var i=h.getBBox().width+4;h.remove();return Math.max(f,i)}return f},null);var c=_.reduce(e,function(g,i){if(typeof(i.value)==="string"||i.value>0){var h=a.root.paper.text(0,0,i.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));var f=h.getBBox().width+4;h.remove();return Math.max(g,f)}return g},null);if(!(d>0)){d=0}if(!(c>0)){c=0}return{top:d,bottom:c}}else{return{top:0,bottom:0}}};a.getAxesOffsetTopBottom_=function(h){if(a.options.showBarLabels){var d=_.reduce(h,function(j,k){if(typeof(k.value)=="number"&&k.value<0){return(!j||k.name.length>j.name.length)?k:j}return j},null);var c=_.reduce(h,function(j,k){if(typeof(k.value)=="string"||k.value>0){return(!j||k.name.length>j.name.length)?k:j}return j},null);var i=0,e=0;if(d){var g=a.root.paper.text(0,0,d.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));i=g.getBBox().width+4;g.remove()}if(c){var f=a.root.paper.text(0,0,c.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));e=f.getBBox().width+4;f.remove()}return{top:i,bottom:e}}else{return{top:0,bottom:0}}};a.generateBars=function(F){_.each(a.set,function(i){i.stop()});a.set.remove();a.set=a.root.paper.set();var A=a.options.barMaxWidth;var k=InfoCharts.Helper.Data.getPropertyValuesUniq(F,"category");var t=a.background.bb.height-a.options.textStyle["font-size"];var r=(t)/(F.length)*a.options.barSpaceFraction;if(r>1){r=Math.floor(r)}if(r>A){r=A}t=(t-r*F.length);var C=t/2*a.options.chartDistribution.canvasMargin;var q=t/2/(!a.options.showCategorys?1:k.length)*a.options.chartDistribution.groupMargin;var w=t/2/F.length*a.options.chartDistribution.barMargin;var m=a.background.bb.y+C;var p=0;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var G=[];for(var z=0;z<(!a.options.showCategorys?1:k.length);z++){var h=_.filter(F,function(i){return !a.options.showCategorys||i.category==k[z]});m+=q;for(var y=0;y<h.length;y++){m+=w;var g=h[y].styleName||a.options.style;var D=g;g+="-horizontal";var E="ipg-"+g;if(InfoCharts.Visuals.ShapeGenerator.Anim[g]){InfoCharts.Visuals.ShapeGenerator.Anim[g](a.root.paper,E)}else{g=D.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path-horizontal"](a.root.paper,E,g)}var e=a.grid.getValuePositionX(h[y].value);var d=a.root.paper.path();if(true){if(!a.state.currentState[p]){d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:h[y].color,stroke:h[y].color},a.options.shapeStyle),E,[e.baseline,m+r/2,0,r]))}else{a.state.currentState[p].anim[0]=e.baseline;a.state.currentState[p].anim[1]=m+r/2;d.attr(InfoCharts.Helper.Misc.addProperty(a.state.currentState[p].base,E,a.state.currentState[p].anim))}a.state.currentState[p]={};a.state.currentState[p].anim=[e.baseline,m+r/2,e.height,r];a.state.currentState[p].base=$.extend({fill:h[y].color,stroke:h[y].color},a.options.shapeStyle);var n=$.proxy(a.afterAnimation,{anim:a.state.currentState[p].anim,data:h[y],shape:d,vb:e,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){G.push({obj:d,anim:Raphael.animation(InfoCharts.Helper.Misc.addProperty($.extend({fill:h[y].color,stroke:h[y].color},a.options.shapeStyle),E,a.state.currentState[p].anim),a.root.options.animationDuration,a.root.options.animationStyle,n).delay(p/F.length*a.root.options.animationSequenceDuration)})}else{d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:h[y].color,stroke:h[y].color},a.options.shapeStyle),E,a.state.currentState[p].anim));n()}}a.set.push(d);var v={data:h[y],path:d};var c=$.proxy(a.eventing.onMouseOver,v);var u=$.proxy(a.eventing.onMouseOut,v);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+v.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+v.data.objectId,u)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,v));d.mouseout(u);if(a.options.showBarLabels){var o=a.root.paper.text(e.baseline-3*e.dev,m+r/2,h[y].name).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({"text-anchor":((e.dev>0)?"end":"start"),fill:h[y].color},a.options.textStyle)));var l=o.getBBox();a.set.push(o)}m+=r+w;p++}m+=q}var B=null;while(a.state.currentState.length>p){B=a.state.currentState.pop();B=null}a.grid.baseLine.toFront();var f=0;for(var z=0;z<G.length;z++){G[z].obj.stop();G[z].obj.animate(G[z].anim);f=Math.max(f,G[z].anim.ms+G[z].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f)};a.afterAnimation=function(){if(a.options.showInLineValues&&this.actionCounter===a.state.actionCounter){var g=this.data;if(g.inValueString.length>0){var f=this.anim;var c=this.shape.getBBox();var e=this.vb;if(c.height<=15){return}a.options.inTextStyle["font-size"]=a.state.inTextStyleFontSize;var d=InfoCharts.Helper.Misc.getContrastColor(a.options.inTextStyle.fill,g.color);do{var h=a.root.paper.text(e.baseline-3*-e.dev,f[1],g.inValueString).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({},a.options.inTextStyle,{"text-anchor":((-e.dev>0)?"end":"start"),fill:d})));h.bb=h.getBBox();if((h.bb.width+6)<c.width&&h.bb.height<c.height){a.set.push(h);break}else{h.remove();a.options.inTextStyle["font-size"]-=1}}while(a.options.inTextStyle["font-size"]>=8)}}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.VerticalBars=function(b){var a=this;a.root=b;a.options={hasValueInLabel:false,autoLabelToggle:true,showTooltip:true,highlightLegendItem:true,hasGroups:true,showGroups:true,showLabels:true,showBarLabels:true,showCategorys:true,style:"bar-bar",panelMarginY:15,barMaxWidth:40,barSpaceFraction:0.8,absoluteDistribution:false,chartDistribution:{canvasMargin:0.15,groupMargin:0.7,barMargin:0.15},gridPostOptions:{gridToFront:false,labelsToFront:false,baseLinesToFront:false},backgroundStyle:{fill:"url('img/bg.png')","stroke-width":0,"stroke-opacity":0,stroke:"none"},shapeStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},textStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,cursor:"default"},showInLineValues:false,inTextStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,fill:"#FFFFFF"},axesTitleSpaceing:3,axesTitleBalanceHorizontalSpaceing:false,axesTitleStyle:{enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{opacity:0}},_categoryOptions:{},_gridOptions:{},_buttonWrapperOptions:{},_labelWrapperOptions:{},_buttonTextOptions:{},_labelTextOptions:{}};a.data=null;a.set=null;a.background=null;a.grid=null;a.buttons=null;a.labels=null;a.categoryLabel=null;a.tooltip=null;a.buttonHeight=0;a.axesTitle=null;a.axesTitleX=null;a.axesTitleY=null;a.state={currentState:[],interactionsEnabled:false,axesTitle:null,actionCounter:0,inTextStyleFontSize:0};a.init=function(c){a.set=a.root.paper.set();a.options=$.extend(a.root.options.deepExtend,a.options,c);a.state.inTextStyleFontSize=a.options.inTextStyle["font-size"];a.set=a.root.paper.set();a.visualSet=a.root.paper.set();a.background=a.root.paper.rect(0,0,a.root.options.canvasWidth,a.root.options.canvasHeight);a.background.attr(a.options.backgroundStyle);return a};a.setPosition=function(c){a.set.transform(["T",c.x,c.y])};a.loadData=function(h,e,d,g,c){try{if(a.root.options.loadDataAsync){setTimeout(function(){a.loadDataActual(h,e,d,g,c)},0)}else{a.loadDataActual(h,e,d,g,c)}}catch(f){alert(f)}};a.loadDataActual=function(){if(a.root.options.errorCallback){try{a._loadDataActual.apply(a,arguments)}catch(c){a.root.options.errorCallback.call(a.root,c);if(a.root.options.reThrowException){throw c}}}else{a._loadDataActual.apply(a,arguments)}};a._loadDataActual=function(n,u,m,q,f){a.state.actionCounter++;a.state.interactionsEnabled=!a.root.options.canAnimate;a.eventing.helper.preHoverColor={};if(m){a.data=InfoCharts.Helper.Data.copyDataArray(n);if(a.data.length===0){return}a.gridDef=InfoCharts.Helper.Data.copyDataArray(q);a.axesTitle=InfoCharts.Helper.Data.copyDataArray(f)}else{a.data=n}InfoCharts.Helper.Data.setDefaults(a.data);var c=0;var t=a.root.getCenter();var s=InfoCharts.Helper.Data.getGroups(a.data);u=u||s[0]||"";var j=InfoCharts.Helper.Data.getActiveData(a.data,a.options.hasGroups,u);if(a.options._gridOptions&&a.gridDef){a.options._gridOptions.gridDef=InfoCharts.Helper.Data.getGridDefinition(a.gridDef,a.options.hasGroups,u)}a.state.axesTitle=InfoCharts.Helper.Data.getAxesTitle(a.axesTitle,u);a.state.axesTitle[1]=null;var g=InfoCharts.Helper.Data.getPropertyValuesUniq(a.data,"category");a.options.barSpaceFraction=1-g.length/(g.length+9);if(m){if(a.buttons){a.buttons.dispose();a.buttons=null}if(a.options.showGroups&&a.options.hasGroups&&s.length>1){a.buttons=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.RadioButton,$.extend(a.options._buttonWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._buttonTextOptions,{selectedGroup:u,onClickCallback:a.eventing.onGroupChanged}),s);a.buttonHeight=a.buttons.set.getBBox().height+a.options.panelMarginY*2;a.buttons.setPosition({x:t.x,y:a.buttonHeight/2})}}if(a.grid){a.grid.dispose();a.grid=null}if(a.categoryLabel){a.categoryLabel.dispose();a.categoryLabel=null}if(a.labels){a.labels.dispose();a.labels=null}if(a.options.autoLabelToggle){var o=a.root.options.canvasWidth-20;var l=Math.round((o)/(j.length)*a.options.barSpaceFraction);if(l>a.options.barMaxWidth){l=a.options.barMaxWidth}if(a.options.textStyle["font-size"]>=l){a.options.showLabels=true;a.options.showBarLabels=false}else{a.options.showLabels=false;a.options.showBarLabels=true}}if(a.options.showLabels){var d=InfoCharts.Helper.Data.getLabelsUniq(j,a.options.hasValueInLabel);if(d.length>0){a.labels=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options._labelWrapperOptions,{maxWidth:a.root.options.canvasWidth*0.9}),$.extend(a.options._labelTextOptions,{enableHover:a.options.highlightLegendItem}),d);c=a.labels.set.getBBox().height+a.options.panelMarginY*2}}a.root.resizeHeight(a.buttonHeight,c);if(a.axesTitleX){a.axesTitleX.dispose()}if(a.axesTitleY){a.axesTitleY.dispose()}var i=0;var h=0;if(a.state.axesTitle){if(a.state.axesTitle[0]){i=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}if(a.state.axesTitle[1]){h=a.options.axesTitleStyle.labelFontStyle["font-size"]+a.options.axesTitleSpaceing*2}}var e=a.getAxesOffsetTopBottom(j);a.grid=new InfoCharts.Visuals.Grid(a.root).init($.extend(a.options._gridOptions,{pos:[0+i,a.buttonHeight],size:[a.root.options.canvasWidthDefault-i*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),a.root.options.canvasHeightDefault-a.buttonHeight-c-h],offset:[{start:0,end:0},{start:e.top,end:e.bottom}],zeroValues:[{top:1,bottom:0},{top:-1,bottom:0}],hideGrid:[true,false],labelXToBottom:false,showGridOnEdge:false}),a.options.absoluteDistribution?a.data:j,"y");a.grid.createGrid();var r=a.root.options.canvasHeight-c-a.buttonHeight;var p=a.buttonHeight;a.background.attr({x:0+i,y:p,width:a.root.options.canvasWidth-i*(a.options.axesTitleBalanceHorizontalSpaceing?2:1),height:r-h});a.background.bb=a.background.getBBox();if(i){a.axesTitleX=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[0],color:""},a.options.axesTitleStyle);a.axesTitleX.setPositionVertical({x:i/2,y:a.background.bb.y+a.background.bb.height/2})}if(h){a.axesTitleY=new InfoCharts.Visuals.Text(a.root).init({name:a.state.axesTitle[1],color:""},a.options.axesTitleStyle);a.axesTitleY.setPosition({x:a.background.bb.x+a.background.bb.width/2,y:a.background.bb.y2+h/2})}var k=0;if(a.options.showCategorys&&g&&g.length>1){a.categoryLabel=new InfoCharts.Visuals.Categorys(a.root,a).init(a.options._categoryOptions,j);k=a.categoryLabel.height+2;a.categoryLabel.setPosition({x:0,y:p+r+a.categoryLabel.height/2+2})}a.root.resize(a.root.options.canvasWidth,a.root.options.canvasHeight+k);if(a.labels){a.labels.setPosition({x:t.x,y:a.root.options.canvasHeight-c/2})}a.generateBars(j);a.grid.postDisplayMods(a.options.gridPostOptions);if(a.root.options.canAnimate&&a.root.options.canAnimateGrid){a.grid.set.attr({opacity:0});a.grid.set.animate({opacity:1},a.root.options.animationDuration,a.root.options.animationStyleGrid)}if(a.root.options.loadedCallback){a.root.options.loadedCallback()}};a.getAxesOffsetTopBottom=function(e){if(a.options.showBarLabels){var d=_.reduce(e,function(f,g){if(typeof(g.value)==="number"&&g.value<0){var h=a.root.paper.text(0,0,g.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));var i=(h.getBBox().width||0)+a.options.textStyle["font-size"]*2;h.remove();return Math.max(f,i)}return f},null);var c=_.reduce(e,function(g,i){if(typeof(i.value)==="string"||i.value>0){var h=a.root.paper.text(0,0,i.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));var f=(h.getBBox().width||0)+a.options.textStyle["font-size"]*2;h.remove();return Math.max(g,f)}return g},null);if(!(d>0)){d=0}if(!(c>0)){c=0}return{top:d,bottom:c}}else{return{top:0,bottom:0}}};a.getAxesOffsetTopBottom_=function(f){if(a.options.showBarLabels){var d=_.reduce(f,function(i,j){if(typeof(j.value)=="number"&&j.value<0){return(!i||j.name.length>i.name.length)?j:i}return i},null);var c=_.reduce(f,function(i,j){if(typeof(j.value)=="string"||j.value>0){return(!i||j.name.length>i.name.length)?j:i}return i},null);var g=0,e=0;if(d){var h=a.root.paper.text(0,0,d.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));g=(h.getBBox().width||0)+a.options.textStyle["font-size"]*2;h.remove()}if(c){var h=a.root.paper.text(0,0,c.name).attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.textStyle));e=(h.getBBox().width||0)+a.options.textStyle["font-size"]*2;h.remove()}return{top:g,bottom:e}}else{return{top:0,bottom:0}}};a.generateBars=function(D){_.each(a.set,function(i){i.stop()});a.set.remove();a.set=a.root.paper.set();var z=a.options.barMaxWidth;var k=InfoCharts.Helper.Data.getPropertyValuesUniq(D,"category");var r=a.background.bb.width-a.grid.state.axisSize[1];var q=(r)/(D.length)*a.options.barSpaceFraction;if(q>1){q=Math.floor(q)}if(q>z){q=z}r=(r-q*D.length);var B=r/2*a.options.chartDistribution.canvasMargin;var p=r/2/(!a.options.showCategorys?1:k.length)*a.options.chartDistribution.groupMargin;var v=r/2/D.length*a.options.chartDistribution.barMargin;var l=B+a.grid.state.axisSize[1]+a.background.bb.x;var o=0;if(a.options.highlightLegendItem&&a.options.showLabels){eve.off("mouseovertext."+a.root.options.canvasSelectorId+".*");eve.off("mouseouttext."+a.root.options.canvasSelectorId+".*")}var E=[];for(var y=0;y<(!a.options.showCategorys?1:k.length);y++){var h=_.filter(D,function(i){return !a.options.showCategorys||i.category==k[y]});l+=p;for(var w=0;w<h.length;w++){l+=v;var g=h[w].styleName||a.options.style;var C="ipg-"+g;if(InfoCharts.Visuals.ShapeGenerator.Anim[g]){InfoCharts.Visuals.ShapeGenerator.Anim[g](a.root.paper,C)}else{g=g.replace("bar-path-","");InfoCharts.Visuals.ShapeGenerator.Anim["bar-path"](a.root.paper,C,g)}var e=a.grid.getValuePositionY(h[w].value);var d=a.root.paper.path();if(true){if(!a.state.currentState[o]){d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:h[w].color,stroke:h[w].color},a.options.shapeStyle),C,[l+q/2,e.baseline,q,0]))}else{a.state.currentState[o].anim[0]=l+q/2;a.state.currentState[o].anim[1]=e.baseline;d.attr(InfoCharts.Helper.Misc.addProperty(a.state.currentState[o].base,C,a.state.currentState[o].anim))}a.state.currentState[o]={};a.state.currentState[o].anim=[l+q/2,e.baseline,q,e.height];a.state.currentState[o].base=$.extend({fill:h[w].color,stroke:h[w].color},a.options.shapeStyle);var m=$.proxy(a.afterAnimation,{anim:a.state.currentState[o].anim,data:h[w],shape:d,vb:e,actionCounter:a.state.actionCounter});if(a.root.options.canAnimate){E.push({obj:d,anim:Raphael.animation(InfoCharts.Helper.Misc.addProperty($.extend({fill:h[w].color,stroke:h[w].color},a.options.shapeStyle),C,a.state.currentState[o].anim),a.root.options.animationDuration,a.root.options.animationStyle,m).delay(o/D.length*a.root.options.animationSequenceDuration)})}else{d.attr(InfoCharts.Helper.Misc.addProperty($.extend({fill:h[w].color,stroke:h[w].color},a.options.shapeStyle),C,a.state.currentState[o].anim));m()}}a.set.push(d);var u={data:h[w],path:d};var c=$.proxy(a.eventing.onMouseOver,u);var t=$.proxy(a.eventing.onMouseOut,u);if(a.options.highlightLegendItem&&a.options.showLabels){eve.on("mouseovertext."+a.root.options.canvasSelectorId+"."+u.data.objectId,c);eve.on("mouseouttext."+a.root.options.canvasSelectorId+"."+u.data.objectId,t)}d.mouseover(c);d.mousemove($.proxy(a.eventing.onMouseMove,u));d.mouseout(t);if(a.options.showBarLabels&&h[w].name&&h[w].name.length>0){var n=a.root.paper.text(l+q/2,e.baseline-a.options.textStyle["font-size"]/2*e.dev,h[w].name).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({"text-anchor":((e.dev<0)?"end":"start"),fill:h[w].color},a.options.textStyle)));n.transform(["R",-90,l+q/2,e.baseline-a.options.textStyle["font-size"]/2*e.dev]);a.set.push(n)}l+=q+v;o++}l+=p}var A=null;while(a.state.currentState.length>o){A=a.state.currentState.pop();A=null}a.grid.baseLine.toFront();var f=0;for(var y=0;y<E.length;y++){E[y].obj.stop();E[y].obj.animate(E[y].anim);f=Math.max(f,E[y].anim.ms+E[y].anim.del)}setTimeout(function(){a.state.interactionsEnabled=true},f)};a.afterAnimation=function(){if(a.options.showInLineValues&&this.actionCounter===a.state.actionCounter){var g=this.data;if(g.inValueString.length>0){var f=this.anim;var c=this.shape.getBBox();var e=this.vb;if(c.width<=15){return}a.options.inTextStyle["font-size"]=a.state.inTextStyleFontSize;var d=InfoCharts.Helper.Misc.getContrastColor(a.options.inTextStyle.fill,g.color);do{var h=a.root.paper.text(f[0],f[1]-a.options.inTextStyle["font-size"]/2*e.dev*-1,g.inValueString).attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({},a.options.inTextStyle,{"text-anchor":((e.dev*-1<0)?"end":"start"),fill:d})));h.bb=h.getBBox();if((h.bb.height)<c.width&&(h.bb.width+a.options.inTextStyle["font-size"])<c.height){h.transform(["R",-90,f[0],f[1]-a.options.inTextStyle["font-size"]/2*e.dev*-1]);a.set.push(h);break}else{h.remove();a.options.inTextStyle["font-size"]-=1}}while(a.options.inTextStyle["font-size"]>=8)}}};a.eventing={helper:{preHoverColor:{}},onMouseOver:function(c){if(a.state.interactionsEnabled){if(a.tooltip!=null){this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});a.tooltip.dispose();a.tooltip=null}a.eventing.helper.preHoverColor[this.data.objectId]=this.path.attr("fill");this.path.attr({fill:InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor[this.data.objectId])});if(a.root.options.canGlowPath){var d=$.extend({color:a.eventing.helper.preHoverColor[this.data.objectId]},a.root.options.glowStyle);InfoCharts.Helper.Misc.forEachDeep(this.path,function(e){if(!e.myGlow){e.myGlow=e.glow(d);a.visualSet.push(e.myGlow)}})}if(a.options.showTooltip&&c){a.tooltip=new InfoCharts.Visuals.ToolTip(a.root).init(a.options.tooltipOptions);a.tooltip.loadData(this.data)}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoverdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}},onMouseMove:function(c){if(a.state.interactionsEnabled){if(a.options.showTooltip){if(a.tooltip!=null){a.tooltip.setPosition(a.root.getMousePosition(c))}else{}}}},onMouseOut:function(c){if(a.state.interactionsEnabled){if(a.eventing.helper.preHoverColor[this.data.objectId]){if(a.tooltip!=null){a.tooltip.dispose();a.tooltip=null}this.path.attr({fill:a.eventing.helper.preHoverColor[this.data.objectId]});if(a.root.options.canGlowPath){InfoCharts.Helper.Misc.forEachDeep(this.path,function(d){if(d.myGlow){d.myGlow.remove();d.myGlow=null}})}if(a.options.highlightLegendItem&&a.options.showLabels&&c&&this.data.objectId){eve("mouseoutdata."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}}}},onGroupChanged:function(c){a.loadData(a.data,c)}}};InfoCharts.Visuals.CategorysHorizontal=function(c,b){var a=this;a.root=c;a.parent=b;a.labelArray=[];a.bg=null;a.set=null;a.height=0;a.options={backgroundStyle:{fill:"#F3F3F3","stroke-width":0,"stroke-opacity":0,stroke:"none"},wrapper:{marginX:2,marginY:0},text:{paddingX:0,paddingY:1,enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{"stroke-width":0}}};a.init=function(o,z,d){d=d||false;a.options=$.extend(a.root.options.deepExtend,a.options,o);var u=a.parent.options.barMaxWidth;var g=InfoCharts.Helper.Data.getPropertyValuesUniq(z,"category");var n=a.parent.background.bb.height-a.parent.options.textStyle["font-size"];var m;if(d){m=(n)/(g.length)*a.parent.options.barSpaceFraction}else{m=(n)/(z.length)*a.parent.options.barSpaceFraction}if(m>1){m=Math.floor(m)}if(m>u){m=u}if(d){n=(n-m*g.length)}else{n=(n-m*z.length)}var y=n/2*a.parent.options.chartDistribution.canvasMargin;var l=n/2/(!a.parent.options.showCategorys?1:g.length)*a.parent.options.chartDistribution.groupMargin;var r=n/2/z.length*a.parent.options.chartDistribution.barMargin;var h=y;var p=0;var v=a.root.paper.set();for(var s=0;s<(!a.parent.options.showCategorys?1:g.length);s++){var f=_.filter(z,function(i){return !a.parent.options.showCategorys||i.category==g[s]});if(d){var q=1*r*2+1*m+l*2}else{var q=f.length*r*2+f.length*m+l*2}var e=g[s].split(" ");var j=[];for(var k=0;k<e.length;k++){j.push({name:e[k]||"",color:null})}var w=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options.wrapper,{maxWidth:q*0.95}),a.options.text,j);w.bb=w.set.getBBox();a.labelArray.push({x:0,y:h+q/2,label:w});v.push(w.set);p=Math.max(p,w.bb.height);h+=q}a.height=p;a.bg=a.root.paper.rect(0,0,a.height,a.parent.background.bb.height).attr(a.options.backgroundStyle);v.insertAfter(a.bg);v.push(a.bg);a.set=v;return a};a.setPosition=function(e){for(var d=0;d<a.labelArray.length;d++){a.labelArray[d].label.setPositionVertical({x:a.labelArray[d].x+e.x,y:a.labelArray[d].y+e.y})}a.bg.transform([["T",e.x-a.height/2,e.y]])};a.dispose=function(){a.set.remove()}};InfoCharts.Visuals.Categorys=function(c,b){var a=this;a.root=c;a.parent=b;a.labelArray=[];a.bg=null;a.set=null;a.height=0;a.options={backgroundStyle:{fill:"#F3F3F3","stroke-width":0,"stroke-opacity":0,stroke:"none"},wrapper:{marginX:2,marginY:0},text:{paddingX:0,paddingY:1,enableHover:false,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"}}};a.init=function(o,z,d){d=d||false;a.options=$.extend(a.root.options.deepExtend,a.options,o);var u=a.parent.options.barMaxWidth;var g=InfoCharts.Helper.Data.getPropertyValuesUniq(z,"category");var n=a.parent.background.bb.width-a.parent.grid.state.axisSize[1];var m;if(d){m=(n)/(g.length)*a.parent.options.barSpaceFraction}else{m=(n)/(z.length)*a.parent.options.barSpaceFraction}if(m>1){m=Math.floor(m)}if(m>u){m=u}if(d){n=(n-m*g.length)}else{n=(n-m*z.length)}var y=n/2*a.parent.options.chartDistribution.canvasMargin;var l=n/2/(!a.parent.options.showCategorys?1:g.length)*a.parent.options.chartDistribution.groupMargin;var r=n/2/z.length*a.parent.options.chartDistribution.barMargin;var h=y+a.parent.grid.state.axisSize[1]+a.parent.background.bb.x;var p=0;var v=a.root.paper.set();for(var s=0;s<(!a.parent.options.showCategorys?1:g.length);s++){var f=_.filter(z,function(i){return !a.parent.options.showCategorys||i.category==g[s]});if(d){var q=1*r*2+1*m+l*2}else{var q=f.length*r*2+f.length*m+l*2}var e=g[s].split(" ");var j=[];for(var k=0;k<e.length;k++){j.push({name:e[k]||"",color:null})}var w=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options.wrapper,{maxWidth:q*0.95}),a.options.text,j);w.bb=w.set.getBBox();a.labelArray.push({x:h+q/2,y:0,label:w});v.push(w.set);p=Math.max(p,w.bb.height||0);h+=q}a.height=p;a.bg=a.root.paper.rect(a.parent.background.bb.x,0,a.parent.background.bb.width,a.height).attr(a.options.backgroundStyle);v.insertAfter(a.bg);v.push(a.bg);a.set=v;return a};a.setPosition=function(e){for(var d=0;d<a.labelArray.length;d++){a.labelArray[d].label.setPosition({x:a.labelArray[d].x+e.x,y:a.labelArray[d].y+e.y})}a.bg.transform([["T",e.x,e.y-a.height/2]])};a.dispose=function(){a.set.remove()}};InfoCharts.Visuals.Grid=function(c){var b=this;b.root=c;b.options={pos:[0,0],minGridlineCount:[4,3],offset:[{start:0,end:0},{start:0,end:0}],size:[b.root.options.canvasWidthDefault,b.root.options.canvasHeightDefault],zeroValues:[{top:1,bottom:-1},{top:1,bottom:-1}],valueType:["number","number"],format:[{prefix:"",sufix:""},{prefix:"",sufix:""}],hideGrid:[false,false],minMax:[{min:NaN,max:NaN},{min:NaN,max:NaN}],gridDef:[[],[]],labelOffset:2,canResize:true,showGridOnEdge:true,forceDataMargin:false,dataMarginSize:5e-7,typeAutoDetect:true,canAnimate:false,labelXToBottom:true,fontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":14,"text-anchor":"start",fill:"#767676",cursor:"default"},lineStyle:{"stroke-width":1,stroke:"#A6A6A6","stroke-dasharray":"."},marginLineStyle:{"stroke-width":3,stroke:"White"},baseLineStyle:{"stroke-width":1,stroke:"#959595"},range:[{min:NaN,max:NaN},{min:NaN,max:NaN}],autoZoom:false};b.state={axisSize:[0,0],offset:[{start:0,end:0},{start:0,end:0}],pow:null,maxSize:[0,0],startValue:[0,0],endValue:[0,0],koeficient:[1,1],maxVal:[NaN,NaN],minVal:[NaN,NaN],empty:[false,false],labelXToBottom:false,gridLabels:b.root.paper.set(),gridLines:b.root.paper.set(),gridLinesBorder:b.root.paper.set(),gridBaseLines:b.root.paper.set(),baseVal:[0,0],range:[{min:NaN,max:NaN},{min:NaN,max:NaN}]};b.textBuffer=[[],[]];b.baseLineBuffer=[];b.valueMap=[{},{}];b.gridMap=[{},{}];b.baseLine=null;b.set=null;b.getValuePositionY=function(f){var e=1;var d=(-b.valueMap[e][f].valueGrid+b.state.startValue[e])*b.state.koeficient[e]+b.options.pos[e]+b.state.offset[e].start;var g=(-b.state.baseVal[e]+b.state.startValue[e])*b.state.koeficient[e]+b.options.pos[e]+b.state.offset[e].start;return{value:d,baseline:g,height:d-g,dev:(d>g)?1:-1}};b.getValuePositionX=function(f){var e=0;var d=(b.valueMap[e][f].valueGrid-b.state.endValue[e])*b.state.koeficient[e]+b.options.pos[e]+b.state.offset[e].start;var g=(b.state.baseVal[e]-b.state.endValue[e])*b.state.koeficient[e]+b.options.pos[e]+b.state.offset[e].start;return{value:d,baseline:g,height:d-g,dev:(d>g)?1:-1}};b.getValuePosition=function(g){var d=[];var e,h;for(var f=0;f<2;f++){switch(f){case 0:e=(b.valueMap[f][g[f]].valueGrid-b.state.endValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;h=(b.state.baseVal[f]-b.state.endValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;break;case 1:e=(-b.valueMap[f][g[f]].valueGrid+b.state.startValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;h=(-b.state.baseVal[f]+b.state.startValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;break}d[f]={value:e,baseline:h,data:b.valueMap[f][g[f]]}}return d};b.getGridPosition=function(g){var d=[];var e,h;for(var f=0;f<2;f++){switch(f){case 0:e=(g[f]-b.state.endValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;h=(b.state.baseVal[f]-b.state.endValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;break;case 1:e=(-g[f]+b.state.startValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;h=(-b.state.baseVal[f]+b.state.startValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;break}d[f]={value:e,baseline:h,data:b.gridMap[f][g[f]]}}return d};b.getPositionAuto=function(h){var d=[];var e,k;for(var f=0;f<2;f++){var j=typeof(b.valueMap[f][h[f]])==="undefined";var i=j?h[f]:b.valueMap[f][h[f]].valueGrid;var g=j?b.gridMap[f][h[f]]:b.valueMap[f][h[f]];switch(f){case 0:e=(i-b.state.endValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;k=(b.state.baseVal[f]-b.state.endValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;break;case 1:e=(-i+b.state.startValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;k=(-b.state.baseVal[f]+b.state.startValue[f])*b.state.koeficient[f]+b.options.pos[f]+b.state.offset[f].start;break}d[f]={value:e,baseline:k,data:g}}return d};b.getGridPositionBase=function(){return b.getPositionAuto([b.state.baseVal[0],b.state.baseVal[1]])};b.postDisplayMods=function(d){if(d.gridToFront){b.state.gridLines.toFront()}if(d.labelsToFront){b.state.gridLabels.toFront()}if(d.baseLinesToFront){b.state.gridBaseLines.toFront()}if(d.gridHide){b.state.gridLines.hide();b.state.gridLinesBorder.hide()}if(d.labelsHide){b.state.gridLabels.hide()}if(d.baseLinesHide){b.state.gridBaseLines.hide()}};b.initGridMap=function(g){var e={};var d={};if(b.options.gridDef[g].length>0){for(var f=0;f<b.options.gridDef[g].length;f++){var h={valueOriginal:b.options.gridDef[g][f],valueString:b.options.format[g].prefix+b.options.gridDef[g][f]+b.options.format[g].sufix,valueGrid:f+1};e[f+1]=h;d[b.options.gridDef[g][f]]=h}}return{gridmap:e,valuegrid:d}};b.init=function(d,i,k,g){b.set=b.root.paper.set();b.options=$.extend(b.root.options.deepExtend,b.options,d);var h=0;var j=null;if(k){var f=1;switch(k){case"y":h=1;break;case"x":h=0;break}if(b.options.typeAutoDetect){b.options.valueType[h]=i[0]?typeof(i[0].value):b.options.valueType[h]}if(b.options.gridDef[h].length>0){var e=b.initGridMap(h);b.valueMap[h]=e.valuegrid;b.gridMap[h]=e.gridmap;b.state.maxVal[h]=b.options.gridDef[h].length;b.state.minVal[h]=1}else{_.each(i,function(l){j={valueOriginal:l.value,valueString:b.options.format[h].prefix+l.value+b.options.format[h].sufix,valueGrid:(b.options.valueType[h]=="number")?l.value:f++};b.valueMap[h][j.valueOriginal]=j;b.gridMap[h][j.valueGrid]=j;b.state.maxVal[h]=isNaN(b.state.maxVal[h])?j.valueGrid:Math.max(b.state.maxVal[h],j.valueGrid);b.state.minVal[h]=isNaN(b.state.minVal[h])?j.valueGrid:Math.min(b.state.minVal[h],j.valueGrid)})}}else{var f=[1,1];for(h=0;h<2;h++){if(b.options.typeAutoDetect){b.options.valueType[h]=(i[0]&&i[0].value[0]&&i[0].value[0][0])?typeof(i[0].value[0][0][h]):b.options.valueType[h]}if(b.options.gridDef[h].length>0){var e=b.initGridMap(h);b.valueMap[h]=e.valuegrid;b.gridMap[h]=e.gridmap;b.state.maxVal[h]=b.options.gridDef[h].length;b.state.minVal[h]=1}else{_.each(i,function(l){_.each(l.value,function(m){_.each(m,function(n){if(!b.valueMap[h][n[h]]){j={valueOriginal:n[h],valueString:b.options.format[h].prefix+n[h]+b.options.format[h].sufix,valueGrid:(b.options.valueType[h]=="number")?n[h]:f[h]++};b.valueMap[h][j.valueOriginal]=j;b.gridMap[h][j.valueGrid]=j;b.state.maxVal[h]=isNaN(b.state.maxVal[h])?j.valueGrid:Math.max(b.state.maxVal[h],j.valueGrid);b.state.minVal[h]=isNaN(b.state.minVal[h])?j.valueGrid:Math.min(b.state.minVal[h],j.valueGrid)}})})})}}}if(b.options.valueType[0]!="number"){b.state.maxVal[0]+=1}if(b.options.valueType[1]!="number"){b.state.maxVal[1]+=1}if(b.options.forceDataMargin){if(b.options.valueType[0]!="number"){b.state.maxVal[0]-=b.options.dataMarginSize}if(b.options.valueType[1]!="number"){b.state.maxVal[1]-=b.options.dataMarginSize}}b.state.maxSize=[b.options.fontStyle["font-size"]*2+b.options.labelOffset*2,b.options.fontStyle["font-size"]*2+b.options.labelOffset*2];b.baseLine=b.root.paper.set();b.state.maxVal[0]=isNaN(b.options.minMax[0].max)?b.state.maxVal[0]:b.options.minMax[0].max;b.state.minVal[0]=isNaN(b.options.minMax[0].min)?b.state.minVal[0]:b.options.minMax[0].min;b.state.maxVal[1]=isNaN(b.options.minMax[1].max)?b.state.maxVal[1]:b.options.minMax[1].max;b.state.minVal[1]=isNaN(b.options.minMax[1].min)?b.state.minVal[1]:b.options.minMax[1].min;return b};b.getPower=function a(e){for(var d=10;d>=-10;d--){if((e-(e%Math.pow(10,d)))!=0){return d}}};b.createGrid=function(e){e=(typeof(e)==="undefined"?true:e);b.textBuffer=[[],[]];b.baseLineBuffer=[[0,0],[0,0]];b.baseOffset=[[1,1],[1,1]];var m=[];var f=[];for(var n=0;n<2;n++){if(b.options.showGridOnEdge){b.options.pos[n]+=1;b.options.size[n]-=2}if(b.options.forceDataMargin&&!(b.state.maxVal[n]==0&&b.state.minVal[n]==0)){b.state.maxVal[n]+=b.options.dataMarginSize;if((n===0)||(n===1&&b.state.minVal[n]!==0)){b.state.minVal[n]-=b.options.dataMarginSize}}if(b.options.autoZoom){b.options.range[n]={min:b.state.minVal[n],max:b.state.maxVal[n]}}var t=b.state.maxVal[n]>0?b.state.maxVal[n]:0;var h=b.state.minVal[n]<0?b.state.minVal[n]:0;t=isNaN(b.options.range[n].max)?t:b.options.range[n].max;h=isNaN(b.options.range[n].min)?h:b.options.range[n].min;if(t==0&&h==0){t=b.options.zeroValues[n].top;h=b.options.zeroValues[n].bottom}if(t==h){if(t>0&&h>0){t+=1}else{if(t<0&&h<0){h-=1}else{t+=1}}}m[n]=t;f[n]=h}b.state.labelXToBottom=b.options.labelXToBottom&&(f[1]==0||m[1]>0&&f[1]>0);if(b.state.labelXToBottom){b.options.size[1]-=b.options.fontStyle["font-size"]+b.options.labelOffset*2+3}for(var n=0;n<2;n++){var t=m[n];var h=f[n];if(t!=0&&h!=0&&((t>0&&h>0)||(t<0&&h<0))){var o=Math.abs(Math.abs(t)-Math.abs(h))}else{var o=Math.abs(t)+Math.abs(h)}if(o==0){var o=-2}b.state.pow=b.getPower(o*0.5);var g=Math.pow(10,b.state.pow);var d=(o/g);var l=(b.options.size[n]/b.state.maxSize[n]);if(d>l){g=g*Math.ceil(d/l);d=(o/g)}if(d<=b.options.minGridlineCount[n]&&b.options.valueType[n]=="number"){g=g/2;b.state.pow-=1;d=(o/g);if(d>l){g=g*Math.ceil(d/l)}}if(g<=0){g=0.25}t=Math.ceil(t/g)*g;h=Math.floor(h/g)*g;t=Math.round(t*Math.pow(10,Math.abs(b.state.pow)))/Math.pow(10,Math.abs(b.state.pow));h=Math.round(h*Math.pow(10,Math.abs(b.state.pow)))/Math.pow(10,Math.abs(b.state.pow));if(t<0&&h<0){b.state.baseVal[n]=t}if(t>0&&h>0){b.state.baseVal[n]=h}if(t!=0&&h!=0&&((t>0&&h>0)||(t<0&&h<0))){o=Math.abs(Math.abs(t)-Math.abs(h))}else{o=Math.abs(t)+Math.abs(h)}var p=b.options.size[n]/o;b.state.startValue[n]=t;b.state.endValue[n]=h;b.state.koeficient[n]=p;var s=Math.round(o/g);switch(n){case 0:b.state.offset[n].start=b.options.offset[n].start-(((b.state.baseVal[n]-(h)))*p);break;case 1:b.state.offset[n].start=b.options.offset[n].start-((-b.state.baseVal[n]+t)*p);break}b.state.offset[n].start=b.state.offset[n].start>0?b.state.offset[n].start:0;for(var k=0,r=NaN,q=NaN;true;k++){var j=[1,1];switch(n){case 0:r=h+(k*g);r=Math.round(r*Math.pow(10,Math.abs(b.state.pow)))/Math.pow(10,Math.abs(b.state.pow));q=(Math.abs(r-h))*p+b.state.offset[n].start+b.options.pos[n];break;case 1:r=t-(k*g);r=Math.round(r*Math.pow(10,Math.abs(b.state.pow)))/Math.pow(10,Math.abs(b.state.pow));q=Math.abs(r-t)*p+b.state.offset[n].start+b.options.pos[n];break}if((n==1&&r<=h)||(n==0&&r>=t)){if(r==b.state.baseVal[n]){if(n==1&&b.options.labelXToBottom){}else{b.baseOffset[+!n][n]=-1}}if(n==0&&r==t){j[0]=-1}if(n==1&&r==h){j[1]=-1}if(e){if(b.options.showGridOnEdge||!(r!=b.state.baseVal[n]&&(k==0||k==s))){b.drawLine(q,r,j,n)}}switch(n){case 0:b.state.offset[n].end=b.options.offset[n].end-(q-(((b.state.baseVal[n]-h))*p+b.state.offset[n].start+b.options.pos[n]));break;case 1:b.state.offset[n].end=b.options.offset[n].end-(q-((-b.state.baseVal[n]+t)*p+b.state.offset[n].start+b.options.pos[n]));break}b.state.offset[n].end=b.state.offset[n].end>0?b.state.offset[n].end:0;break}if(e){if(b.options.showGridOnEdge||!(r!=b.state.baseVal[n]&&(k==0||k==s))){b.drawLine(q,r,j,n)}}}}if(e){b.state.gridBaseLines.toFront();b.dratText();if(b.options.canResize){b.root.resize(b.root.options.canvasWidthDefault+b.state.offset[0].start+b.state.offset[0].end,b.root.options.canvasHeightDefault+b.state.offset[1].start+b.state.offset[1].end)}}};b.dratText=function(){var k=b.textBuffer[0].length>0&&b.textBuffer[1].length>0;var j=0;var d;var e=b.options.valueType[0]=="number"?1:0;for(var h=0;h<2;h++){b.state.axisSize[h]=0;for(var g=0;g<b.textBuffer[h].length;g++){if(!b.options.hideGrid[0]&&!b.options.hideGrid[1]){if(k&&(h==e)&&b.textBuffer[h][g].value==b.state.baseVal[h]){continue}}d=b.textBuffer[h][g].value==0?b.textBuffer[h][g].text:b.options.format[h].prefix+b.textBuffer[h][g].text+b.options.format[h].sufix;j=0;b.textBuffer[h][g].coords[+!h]+=b.baseLineBuffer[+!h][+!h];b.textBuffer[h][g].coords[+!h]-=b.options.pos[+!h]+b.state.offset[+!h].start;if(b.baseOffset[h][0]==-1||b.textBuffer[h][g].fix[0]==-1){var f=b.root.paper.text(b.textBuffer[h][g].coords[0],b.textBuffer[h][g].coords[1],d).attr(InfoCharts.Helper.Misc.parseFontStyle(b.options.fontStyle));j=f.getBBox().width||0;f.remove()}b.textBuffer[h][g].coords[0]+=b.baseOffset[h][0]*b.textBuffer[h][g].fix[0]*(b.options.labelOffset+j);b.textBuffer[h][g].coords[1]+=b.baseOffset[h][1]*b.textBuffer[h][g].fix[1]*(b.options.fontStyle["font-size"]/2+b.options.labelOffset);var l=b.root.paper.text(b.textBuffer[h][g].coords[0],b.textBuffer[h][g].coords[1],d).attr(InfoCharts.Helper.Misc.parseFontStyle(b.options.fontStyle));if(h==0&&b.state.labelXToBottom&&b.textBuffer[h][g].fix[0]>0&&g!=0){l.transform([["T",-((l.getBBox().width)/2)-b.options.labelOffset,0]])}b.state.axisSize[h]=Math.max(b.state.axisSize[h],l.getBBox().width||0);b.set.push(l);b.state.gridLabels.push(l)}}};b.baseOffset=[[1,1],[1,1]];b.drawLine=function(i,n,h,g){if(!b.options.hideGrid[g]||n==b.state.baseVal[g]){var m=(g==0?Math.floor(i)+b.options.baseLineStyle["stroke-width"]/2:b.options.pos[+!g]+b.state.offset[+!g].start);var k=(g==1?Math.floor(i)+b.options.baseLineStyle["stroke-width"]/2:b.options.pos[+!g]+b.state.offset[+!g].start);var e=(g==0?m:b.options.size[+!g]+b.options.pos[+!g]+b.state.offset[+!g].start);var l=(g==1?k:b.options.size[+!g]+b.options.pos[+!g]+b.state.offset[+!g].start);if(!b.options.hideGrid[g]){var d=b.root.paper.path([["M",m,k],["L",e,l]]).attr(b.options.marginLineStyle);b.set.push(d);b.state.gridLinesBorder.push(d)}if(n==b.state.baseVal[g]){b.baseLineBuffer[g]=[m,k];if(!b.options.hideGrid[g]){var j=b.root.paper.path([["M",m,k],["L",e,l]]).attr(b.options.baseLineStyle);b.state.gridBaseLines.push(j);b.set.push(j)}}else{if(!b.options.hideGrid[g]){var f=b.root.paper.path([["M",m,k],["L",e,l]]).attr(b.options.lineStyle);b.state.gridLines.push(f);b.set.push(f)}}if(!b.options.hideGrid[g]){b.textBuffer[g].push({text:(b.options.valueType[g]=="string")?(b.gridMap[g][n]?b.gridMap[g][n].valueString:""):(Math.round(n*Math.pow(10,Math.abs(b.state.pow)))/Math.pow(10,Math.abs(b.state.pow))),coords:[m,k],fix:h,value:n})}}};b.dispose=function(){b.set.stop();b.set.remove()}};InfoCharts.Visuals.TextWrapper=function(b){var a=this;a.root=b;a.label=null;a.set=null;a.isVertical=false;a.options={canRotate:true,wrapper:{marginX:2,marginY:0},text:{enableHover:false,paddingX:0,paddingY:1,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":20,"text-anchor":"start",fill:"#767676",cursor:"default"},backgroundStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"}},minFontSize:10,minResizeStep:2};a.init=function(j,g,c,k){a.options=$.extend(true,a.options,j);var e=g.split(" ");var h=[];for(var l=0;l<e.length;l++){h.push({name:e[l]||"",color:null})}var m=a.options.text.labelFontStyle["font-size"];var d=null;do{if(m&&m>=a.options.minFontSize){a.options.text.labelFontStyle["font-size"]=m;d=new InfoCharts.Visuals.Wrapper(a.root).init(InfoCharts.Visuals.Text,$.extend(a.options.wrapper,{maxWidth:c*0.95}),a.options.text,h);var f=d.set.getBBox();if(f.height<=k*0.95&&f.width<=c*0.95){a.label=d;break}else{d.dispose();m-=a.options.minResizeStep;if(!a.isVertical&&a.options.canRotate&&k>c*1.5){var i=c;c=k;k=i;a.isVertical=true}}}else{if(d){d.dispose()}a.label=null;break}}while(true);if(a.label){a.set=a.label.set}return a};a.setPosition=function(c){if(a.label){if(a.isVertical){a.label.setPositionVertical({x:c.x,y:c.y})}else{a.label.setPosition({x:c.x,y:c.y})}}}};InfoCharts.Visuals.Wrapper=function(b){var a=this;a.root=b;a.state={x:0,y:0,dx:0,dy:0};a.options={maxWidth:300,marginX:2,marginY:7,onClickCallback:null,onOverCallback:null,onOutCallback:null,align:"center"};a.lines=[];a.items=[];a.set=null;a.init=function(m,o,n,d){a.options=$.extend(a.root.options.deepExtend,a.options,o);a.set=a.root.paper.set();var c=0;var q=0;if(d.length>0){a.lines[q]=[]}else{a.set.push(a.root.paper.rect(0,0,0,0))}for(var h=0;h<d.length;h++){var l=new m(a.root,a).init(d[h],n);a.set.push(l.set);if(a.lines[q].length>0&&c+l.box.width+a.options.marginX*2>a.options.maxWidth){a.lines[++q]=[];c=0}a.lines[q].push(l);a.items.push(l);c+=l.box.width+a.options.marginX*2}for(var h=0;h<a.lines.length;h++){var p=_.reduce(a.lines[h],function(i,j){return i+j.box.width+a.options.marginX*2},0);switch(a.options.align){case"center":var k=(a.options.maxWidth-p)/2;break;case"left":var k=(a.options.maxWidth)/2;break;case"right":var k=(a.options.maxWidth-p);break}var g=h*a.lines[h][0].options.labelFontStyle["font-size"]+a.options.marginY*h;for(var e=0;e<a.lines[h].length;e++){var f=a.lines[h][e];k+=(f.box.width+a.options.marginX*2)/2;f.state.dx=k;f.state.dy=g+f.box.height/2;k+=(f.box.width+a.options.marginX*2)/2}}a.setPosition({x:0,y:0});return a};a.setPosition=function(g,d){var f=a.set.getBBox();for(var e=0;e<a.lines.length;e++){for(var c=0;c<a.lines[e].length;c++){a.lines[e][c].setPosition({x:g.x-a.options.maxWidth/2,y:g.y-f.height/2})}}};a.setPositionVertical=function(g,d){var f=a.set.getBBox();for(var e=0;e<a.lines.length;e++){for(var c=0;c<a.lines[e].length;c++){a.lines[e][c].setPositionVertical({x:g.x-f.height/2,y:g.y+a.options.maxWidth/2})}}};a.dispose=function(){_.each(a.items,function(c){c.dispose()});a.set.remove()}};InfoCharts.Visuals.Text=function(b){var a=this;a.root=b;a.text=null;a.background=null;a.item=null;a.box=null;a.set=null;a.overlay=null;a.options={paddingX:6,paddingY:2,labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,"text-anchor":"start",fill:"#FFFFFF",cursor:"default"},backgroundStyle:{"stroke-width":0,"stroke-opacity":0,stroke:"none"},enableHover:true,onClickCallback:null,onOverCallback:null,onOutCallback:null};a.state={dx:0,dy:0};a.init=function(f,c){a.options=$.extend(a.root.options.deepExtend,a.options,c);a.options.labelFontStyle["font-size"]=a.options.labelFontStyle["font-size"]||16;a.set=a.root.paper.set();a.item=f;a.text=a.root.paper.text(0,-0.5+a.root.state.fontOffsetY,a.item.name);a.text.attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({fill:a.item.color},a.options.labelFontStyle)));a.box=a.text.getBBox();a.background=a.root.paper.rect(-a.options.paddingX,-a.options.labelFontStyle["font-size"]/2-a.options.paddingY,a.box.width+a.options.paddingX*2,a.options.labelFontStyle["font-size"]+a.options.paddingY*2);if(a.options.enableHover){a.overlay=a.root.paper.rect(-a.options.paddingX,-a.options.labelFontStyle["font-size"]/2-a.options.paddingY,a.box.width+a.options.paddingX*2,a.options.labelFontStyle["font-size"]+a.options.paddingY*2)}a.box=a.background.getBBox();a.background.insertBefore(a.text);a.background.attr($.extend({fill:a.item.color,stroke:a.item.color},a.options.backgroundStyle));if(a.options.enableHover){a.overlay.attr({fill:"#FFFFFF",opacity:0})}if(a.background.attr("opacity")!=0){var e=InfoCharts.Helper.Misc.getContrastColor(a.text.attr("fill"),a.background.attr("fill"));a.text.attr({fill:e})}a.set.push(a.background);a.set.push(a.text);if(a.options.enableHover&&a.item.objectId){var d={path:a.background,data:a.item};var h=$.proxy(a.eventing.onMouseOver,d);var g=$.proxy(a.eventing.onMouseOut,d);eve.on("mouseoverdata."+a.root.options.canvasSelectorId+"."+a.item.objectId,h);eve.on("mouseoutdata."+a.root.options.canvasSelectorId+"."+a.item.objectId,g);a.overlay.mouseover(h);a.overlay.mouseout(g)}return a};a.dispose=function(){eve.off("mouseoverdata."+a.root.options.canvasSelectorId+"."+a.item.objectId);eve.off("mouseoutdata."+a.root.options.canvasSelectorId+"."+a.item.objectId);if(a.overlay){a.overlay.remove()}a.set.remove()};a.setPosition=function(d){var c=[["T",d.x-a.box.width/2+a.state.dx+a.options.paddingX,d.y+a.state.dy+a.options.paddingY]];a.set.attr({transform:c});if(a.overlay){a.overlay.attr({transform:c})}};a.setPositionVertical=function(c){a.set.transform([["T",c.x-a.box.width/2+a.state.dx+a.options.paddingX,c.y+a.state.dy+a.options.paddingY],["R",-90,c.x,c.y]])};a.eventing={helper:{preHoverColor:null},onMouseOver:function(d){if(a.options.enableHover){a.eventing.helper.preHoverColor=this.path.attr("fill");var c=InfoCharts.Helper.Misc.getHoverColor(a.eventing.helper.preHoverColor);this.path.attr({fill:c});if(a.root.options.canGlowLabel){this.glow=this.path.glow($.extend({color:c},a.root.options.glowStyle));a.set.push(this.glow)}if(d&&this.data.objectId){eve("mouseovertext."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}if(a.options.onOverCallback){a.options.onOverCallback()}}},onMouseOut:function(c){if(a.options.enableHover&&a.eventing.helper.preHoverColor!=null){this.path.attr({fill:a.eventing.helper.preHoverColor});a.eventing.helper.preHoverColor=null;if(a.root.options.canGlowLabel){this.glow.remove()}if(c&&this.data.objectId){eve("mouseouttext."+a.root.options.canvasSelectorId+"."+this.data.objectId,null,null)}if(a.options.onOutCallback){a.options.onOutCallback()}}}}};InfoCharts.Visuals.RadioButton=function(c,b){var a=this;a.root=c;a.parent=b;a.text=null;a.background=null;a.item=null;a.box=null;a.set=null;a.button=null;a.buttonCenter=null;a.overlay=null;a.options={paddingX:6,paddingY:1,fontSize:16,buttonOffsetX:8,buttonRadius:10,selectedGroup:"",labelFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":17,"text-anchor":"start",fill:"#7D7D7D"},buttonStyle:{stroke:"#7D7D7D"},buttonCenterStyle:{stroke:"#7D7D7D",fill:"#7D7D7D"},onClickCallback:null,onOverCallback:null,onOutCallback:null};a.state={dx:0,dy:0,checked:false};a.init=function(e,d){a.options=$.extend(a.root.options.deepExtend,a.options,d);a.options.labelFontStyle["font-size"]=a.options.labelFontStyle["font-size"]||16;a.item=e;a.set=a.root.paper.set();a.text=a.root.paper.text(0,0+a.root.state.fontOffsetY,a.item);a.text.attr(InfoCharts.Helper.Misc.parseFontStyle($.extend({},a.options.labelFontStyle)));a.box=a.text.getBBox();a.background=a.root.paper.rect(-a.options.paddingX-a.options.buttonOffsetX-a.options.buttonRadius,-a.options.labelFontStyle["font-size"]/2-a.options.paddingY,a.box.width+a.options.paddingX*2+a.options.buttonOffsetX+a.options.buttonRadius,a.options.labelFontStyle["font-size"]+a.options.paddingY*2);a.button=a.root.paper.circle(-a.options.buttonOffsetX+4-a.options.buttonRadius,0,a.options.buttonRadius);a.buttonCenter=a.root.paper.circle(-a.options.buttonOffsetX+4-a.options.buttonRadius,0,a.options.buttonRadius*0.7);a.overlay=a.root.paper.rect(-a.options.paddingX-a.options.buttonOffsetX-a.options.buttonRadius,-a.options.labelFontStyle["font-size"]/2-a.options.paddingY,a.box.width+a.options.paddingX*2+a.options.buttonOffsetX+a.options.buttonRadius,a.options.labelFontStyle["font-size"]+a.options.paddingY*2);if(a.options.selectedGroup!=a.item){a.buttonCenter.hide()}else{a.state.checked=true}a.box=a.background.getBBox();a.background.insertBefore(a.text);a.background.attr({fill:"#FFFFFF",opacity:0});a.overlay.attr({cursor:"Pointer",fill:"#FFFFFF",opacity:0});a.set.push(a.background);a.set.push(a.text);a.set.push(a.button);a.set.push(a.buttonCenter);a.button.attr(a.options.buttonStyle);a.buttonCenter.attr(a.options.buttonCenterStyle);a.bindEvents();return a};a.dispose=function(){a.set.remove();a.overlay.remove()};a.bindEvents=function(){a.overlay.mousedown(a.eventing.onClick);a.overlay.mouseout(a.eventing.onOut);a.overlay.mouseover(a.eventing.onOver)};a.eventing={onClick:function(d){if(!a.state.checked){if(a.parent){_.each(a.parent.items,function(e){e.state.checked=false;e.buttonCenter.hide()});a.state.checked=true;a.buttonCenter.show()}if(a.options.onClickCallback){a.options.onClickCallback(a.item)}}},onOver:function(d){if(a.options.onOverCallback){a.options.onOverCallback(a.item)}},onOut:function(d){if(a.options.onOutCallback){a.options.onOutCallback(a.item)}}};a.setPosition=function(e){var d=[["T",e.x-a.box.width/2+a.state.dx+a.options.paddingX+a.options.buttonOffsetX+a.options.buttonRadius,e.y+a.state.dy+a.options.paddingY]];a.set.attr({transform:d});a.overlay.attr({transform:d})}};InfoCharts.Visuals.ToolTip=function(b){var a=this;a.root=b;a.data=null;a.options={paddingX:10,paddingY:7,textSpacer:2,nameFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,"text-anchor":"start",cursor:"default",fill:"#FFFFFF","font-weight":"bold"},valueFontStyle:{"font-family":"PT Sans Narrow, Arial Narrow","font-size":16,"text-anchor":"start",cursor:"default",fill:"#FFFFFF"},containerStyle:{stroke:"#464646",fill:"#464646"}};a.obj={name:null,value:null,bg:null,pointerR:null,pointerL:null};a.state={cxR:0,cxL:0,cy:0,width:0};a.set=null;a.init=function(c){a.options=$.extend(a.root.options.deepExtend,a.options,c);return a};a.loadData=function(g){a.data=g;a.set=a.root.paper.set();if(a.data.valueString||a.data.name){if(a.obj.name){a.obj.name.remove()}if(a.obj.value){a.obj.value.remove()}if(a.obj.bg){a.obj.bg.remove()}a.options.textSpacer=(a.data.name.length>0&&a.data.valueString.length>0)?a.options.textSpacer:0;a.obj.name=a.root.paper.text(a.options.paddingX,a.options.nameFontStyle["font-size"]*0.5+a.options.paddingY+a.root.state.fontOffsetY,a.data.name);a.obj.name.attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.nameFontStyle));a.obj.name.bb=a.obj.name.getBBox();if(a.data.name.length>0){a.obj.value=a.root.paper.text(a.options.paddingX,a.options.nameFontStyle["font-size"]+a.options.valueFontStyle["font-size"]*0.5+a.options.textSpacer+a.options.paddingY+a.root.state.fontOffsetY,a.data.valueString)}else{a.obj.value=a.root.paper.text(a.options.paddingX,a.options.valueFontStyle["font-size"]*0.5+a.options.textSpacer+a.options.paddingY+a.root.state.fontOffsetY,a.data.valueString)}a.obj.value.attr(InfoCharts.Helper.Misc.parseFontStyle(a.options.valueFontStyle));a.obj.value.bb=a.obj.value.getBBox();var f=Math.max((a.obj.value.bb.width||0),(a.obj.name.bb.width||0));a.obj.value.attr({x:a.options.paddingX+(f-(a.obj.value.bb.width||0))/2});a.obj.name.attr({x:a.options.paddingX+(f-(a.obj.name.bb.width||0))/2});var e=(a.data.name.length>0?a.options.nameFontStyle["font-size"]:0)+(a.data.valueString.length>0?a.options.valueFontStyle["font-size"]:0)+a.options.textSpacer+a.options.paddingY*2;a.obj.bg=a.root.paper.rect(0,0,f+a.options.paddingX*2.5,e);a.obj.bg.bb=a.obj.bg.getBBox();var d=a.obj.bg.bb.width+9;var c=a.obj.bg.bb.height/2;var h=13;a.obj.pointerR=a.root.paper.path([["M",d,c],["L",d-h,c-h],["L",d-h,c+h],["Z"]]);a.state.cxR=d+6;a.state.cy=c;d=-9;c=a.obj.bg.bb.height/2;a.obj.pointerL=a.root.paper.path([["M",d,c],["L",d+h,c-h],["L",d+h,c+h],["Z"]]);a.obj.pointerL.hide();a.state.cxL=d-6;a.set.push(a.obj.pointerR);a.set.push(a.obj.pointerL);a.set.insertBefore(a.obj.bg);a.set.push(a.obj.bg);a.set.insertBefore(a.obj.name);a.set.attr(a.options.containerStyle);a.set.push(a.obj.name);a.set.push(a.obj.value);a.state.width=d+f+a.options.paddingX*2.5;a.setPosition(a.root.getMousePosition())}};a.dispose=function(){a.set.remove()};a.setPosition=function(d){if(d){if(a.data.valueString||a.data.name){var c=0;if(d.x-a.state.cxR>0){a.obj.pointerL.hide();a.obj.pointerR.show();c=a.state.cxR}else{a.obj.pointerL.show();a.obj.pointerR.hide();c=a.state.cxL}a.set.transform([["T",d.x-c,d.y-a.state.cy]])}}}};InfoCharts.Visuals.ShapeGenerator=(function(){this.Func={appendViewBox:function(b){if(!(b.width&&b.height)){if(b.path){var a=Raphael.pathBBox(b.path);b.width=a.width;b.height=a.height}}return b},addNewShape:function(a,b){InfoCharts.Visuals.ShapeGenerator.Path[a]={};InfoCharts.Visuals.ShapeGenerator.Path[a].path=b},addNewImage:function(c,b,d,a){InfoCharts.Visuals.ShapeGenerator.Path[c]={};InfoCharts.Visuals.ShapeGenerator.Path[c].image=b;InfoCharts.Visuals.ShapeGenerator.Path[c].width=d;InfoCharts.Visuals.ShapeGenerator.Path[c].height=a},rotatePath:function(b,a,d){if(!InfoCharts.Visuals.ShapeGenerator.Path[a]){var c=Raphael.transformPath(InfoCharts.Visuals.ShapeGenerator.Path[b].path,[["T",-InfoCharts.Visuals.ShapeGenerator.Path[b].width/2,-InfoCharts.Visuals.ShapeGenerator.Path[b].height/2],["r",d],["T",InfoCharts.Visuals.ShapeGenerator.Path[b].height/2,InfoCharts.Visuals.ShapeGenerator.Path[b].width/2]]);InfoCharts.Visuals.ShapeGenerator.Func.addNewShape(a,c);InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(InfoCharts.Visuals.ShapeGenerator.Path[a])}},scalePath:function(b,c){var a={};if(b.path){a.path=Raphael.transformPath(b.path,[["S",c,c,0,0]])}if(b.image){a.image=b.image;a.width=b.width*c;a.height=b.height*c}InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(a);return a}};this.Path={androidPath:{path:"M2.75,14.92139c-1.51953,0-2.75,1.25-2.75,2.79297v10.91455c0,1.54102,1.23047,2.79297,2.75,2.79297s2.75-1.25195,2.75-2.79297V17.71436C5.5,16.17139,4.26953,14.92139,2.75,14.92139L2.75,14.92139zM7.5,15.08252v19.75146c0,1.17383,0.95313,2.125,2.125,2.125h2.42578v6.01563c0,1.52734,1.2207,2.76563,2.72461,2.76563S17.5,44.50195,17.5,42.97461v-6.01563h4.24023v6.01563c0,1.52734,1.2168,2.76563,2.72461,2.76563c1.50391,0,2.72266-1.23828,2.72266-2.76563v-6.01563h2.42773c1.17188,0,2.12305-0.95117,2.12305-2.125V15.08252H7.5L7.5,15.08252L7.5,15.08252zM36.49023,14.91748c-1.51758,0-2.75195,1.25195-2.75195,2.79492v10.91846c0,1.54297,1.23438,2.79492,2.75195,2.79492c1.51953,0,2.74805-1.25195,2.74805-2.79492V17.7124C39.23828,16.16943,38.00977,14.91748,36.49023,14.91748L36.49023,14.91748zM25.97656,4.94678l2.30273-3.38379c0.31055-0.45605,0.19336-1.0791-0.26367-1.38965s-1.08008-0.19238-1.38867,0.26465l-2.51172,3.69043c-1.39258-0.48242-2.9043-0.75879-4.49609-0.75879c-1.58984,0-3.10156,0.27637-4.49414,0.75781l-2.51172-3.69043c-0.3125-0.45605-0.93359-0.57422-1.39063-0.26367s-0.57422,0.93359-0.26367,1.38965l2.30469,3.38379C10.03906,6.66748,7.79883,9.63916,7.5,13.09229h24.23828C31.43945,9.63818,29.20117,6.6665,25.97656,4.94678zM14.50781,9.74072c-0.74023,0-1.3418-0.60059-1.3418-1.34082s0.59961-1.34082,1.3418-1.34082c0.74023,0,1.33984,0.60059,1.33984,1.34082S15.24805,9.74072,14.50781,9.74072zM24.90039,9.74072c-0.74219,0-1.33984-0.60059-1.33984-1.34082s0.59766-1.34082,1.33984-1.34082c0.74023,0,1.3418,0.60059,1.3418,1.34082S25.64063,9.74072,24.90039,9.74072z"},boyPath:{path:"M4,3.5C4,1.567,5.567,0,7.5,0C9.432,0,11,1.567,11,3.5S9.432,7,7.5,7C5.567,7,4,5.433,4,3.5z M10.742,7.999H4.437C3.328,7.999,0,8,0,11.744v5.736C0,19,0,23,1.459,22.682C2.832,22.691,3,18.465,3,17.48v-5.481h1v6.206v2.845v6.81c0,0.353-0.012,5.687,1.5,5.687S7,28.233,7,27.859v-5.86h1v5.86c0,0.457,0.131,5.687,1.5,5.687c1.443,0,1.5-5.52,1.5-5.687v-6.81v-2.845v-6.206h1v5.481c0,1.097,0.109,5.217,1.666,5.223C15,22.708,15,18.088,15,17.48V12C15,9,12.859,7.999,10.742,7.999z"},girlPath:{path:"M17.571,20.906c-1.136,0.344-1.391-1.54-2-2.993l-2-4.987l-1,1.074l3,13h-3v0.859c0,0.167-0.057,5.687-1.5,5.687c-1.369,0-1.5-5.229-1.5-5.687V27h-1v0.859c0,0.457-0.131,5.687-1.5,5.687c-1.443,0-1.5-5.52-1.5-5.687V27h-3l3-13l-1-1.097l-2,5.003c-0.609,1.453-1.004,2.92-2,3.007c-1,0.087-0.479-1.618,0-2.913l1.875-5.969C2.571,10,6.571,8,8.571,8h1c2,0,5.047,1.312,6,4l2,6C18.05,19.295,18.659,20.577,17.571,20.906z M9.089,7c1.933,0,3.5-1.567,3.5-3.5S11.022,0,9.089,0s-3.5,1.567-3.5,3.5S7.157,7,9.089,7z"},rectPath:{path:"M15,15H0V0h15V15z"},circlePath:{path:"M15,7.5c0,4.142-3.358,7.5-7.5,7.5S0,11.642,0,7.5S3.358,0,7.5,0S15,3.358,15,7.5z"},starPath:{path:"M39.125,0L50.16,25.949l28.086,2.475L56.982,46.94l6.32,27.479L39.125,59.912L14.946,74.42l6.321-27.479L0,28.424l28.089-2.475L39.125,0z"},upPath:{path:"M0,74.42L37.511,0l37.512,74.42z"},downPath:{path:"M75.022,0L37.511,74.42L0,0z"},profilePath:{path:"M27.693,0C17.041,0,8.407,8.634,8.407,19.287c0,10.656,8.633,19.289,19.286,19.289c10.656,0,19.29-8.633,19.29-19.289C46.983,8.634,38.35,0,27.693,0z M28.634,34.563c-5.749,0-10.807-3.775-13.754-9.49h27.508C39.44,30.787,34.386,34.563,28.634,34.563z M55.395,57.746H0c2.69-10.033,8.564-14.699,16.058-16.668c3.47,1.861,7.432,2.92,11.636,2.92c4.208,0,8.172-1.061,11.641-2.92C46.832,43.045,52.703,47.711,55.395,57.746z"},brainImage:{image:"img/brain.png",width:300,height:300},brainSmallImage:{image:"img/brain.png",width:40,height:40}};this.Anim={"bar-bar":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=g-e/2;return{path:[["M",d,f],["L",d,f+c],["L",d+e,f+c],["L",d+e,f],["Z"]]}}}},"bar-bar-horizontal":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=f-c/2;return{path:[["M",g,d],["L",g,d+c],["L",g+e,d+c],["L",g+e,d],["Z"]]}}}},"bar-bow":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=g-e/2;return{path:[["M",d,f],["L",d+e,f+c],["L",d,f+c],["L",d+e,f],["Z"]]}}}},"bar-bow-horizontal":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=f-c/2;return{path:[["M",g,d],["L",g,d+c],["L",g+e,d],["L",g+e,d+c],["Z"]]}}}},"bar-triangle":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=g-e/2;return{path:[["M",d,f],["L",g,f+c],["L",d+e,f],["Z"]]}}}},"bar-triangleInverse":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=g-e/2;return{path:[["M",d,f+c],["L",d+e,f+c],["L",g,f],["Z"]]}}}},"bar-triangle-horizontal":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=f-c/2;return{path:[["M",g,d],["L",g+e,f],["L",g,d+c],["Z"]]}}}},"bar-curve":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=g-e/2;return{path:[["M",d,f],["C",d,f+c,g-2,f+c,g,f+c],["C",g+2,f+c,d+e,f+c,d+e,f],["Z"]]}}}},"bar-curve-horizontal":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(g,f,e,c){var d=f-c/2;return{path:[["M",g,d],["C",g+e,d,g+e,f-2,g+e,f],["C",g+e,f+2,g+e,d+c,g,d+c],["Z"]]}}}},"bar-path":function(c,a,b){InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(InfoCharts.Visuals.ShapeGenerator.Path[b]);if(!c.customAttributes[a]){c.customAttributes[a]=function(h,f,e,d){var g=Raphael.transformPath(InfoCharts.Visuals.ShapeGenerator.Path[b].path,[["T",h-InfoCharts.Visuals.ShapeGenerator.Path[b].width/2,f-InfoCharts.Visuals.ShapeGenerator.Path[b].height],["S",e/InfoCharts.Visuals.ShapeGenerator.Path[b].width,-d/InfoCharts.Visuals.ShapeGenerator.Path[b].height,h,f]]);return{path:g}}}},"bar-path-horizontal":function(c,a,b){InfoCharts.Visuals.ShapeGenerator.Func.appendViewBox(InfoCharts.Visuals.ShapeGenerator.Path[b]);InfoCharts.Visuals.ShapeGenerator.Func.rotatePath(b,b+"-horizontal",-90);b+="-horizontal";if(!c.customAttributes[a]){c.customAttributes[a]=function(h,f,e,d){var g=Raphael.transformPath(InfoCharts.Visuals.ShapeGenerator.Path[b].path,[["T",h-InfoCharts.Visuals.ShapeGenerator.Path[b].width,f-InfoCharts.Visuals.ShapeGenerator.Path[b].height/2],["S",-e/InfoCharts.Visuals.ShapeGenerator.Path[b].width,d/InfoCharts.Visuals.ShapeGenerator.Path[b].height,h,f]]);return{path:g}}}},"picto-visibility":function(b,a){if(!b.customAttributes[a]){b.customAttributes[a]=function(d,c){if(d<c){return{opacity:0}}else{return{opacity:1}}}}},"pie-pie":function(c,b){if(!c.customAttributes[b]){var a=Math.PI/180;c.customAttributes[b]=function(f,d,e,g,h){return{path:[["M",f,d],["L",f+h*Math.cos(-g*a),d+h*Math.sin(-g*a)],["A",h,h,0,+(Math.abs(g-e)>180),0,f+h*Math.cos(-e*a),d+h*Math.sin(-e*a)],["z"]]}}}},"pie-doughnut":function(c,b){if(!c.customAttributes[b]){var a=Math.PI/180;c.customAttributes[b]=function(g,d,f,i,e,h){return{path:[["M",g+f*Math.cos(-h*a),d+f*Math.sin(-h*a)],["L",g+i*Math.cos(-h*a),d+i*Math.sin(-h*a)],["A",i,i,0,+(Math.abs(h-e)>180),0,g+i*Math.cos(-e*a),d+i*Math.sin(-e*a)],["L",g+f*Math.cos(-e*a),d+f*Math.sin(-e*a)],["A",f,f,0,+(Math.abs(e-h)>180),1,g+f*Math.cos(-h*a),d+f*Math.sin(-h*a)],["z"]]}}}},"pie-polar":function(c,b){if(!c.customAttributes[b]){var a=Math.PI/180;c.customAttributes[b]=function(g,d,i,f,e,h){return{path:[["M",g+f*Math.cos(-h*a),d+f*Math.sin(-h*a)],["L",g+i*Math.cos(-h*a),d+i*Math.sin(-h*a)],["A",i,i,0,+(Math.abs(h-e)>180),0,g+i*Math.cos(-e*a),d+i*Math.sin(-e*a)],["L",g+f*Math.cos(-e*a),d+f*Math.sin(-e*a)],["A",f,f,0,+(Math.abs(e-h)>180),1,g+f*Math.cos(-h*a),d+f*Math.sin(-h*a)],["z"]]}}}},"gauge-gauge":function(c,b){if(!c.customAttributes[b]){var a=Math.PI/180;c.customAttributes[b]=function(g,d,f,i,e,h){return{path:[["M",g+f*Math.cos(-h*a),d+f*Math.sin(-h*a)],["L",g+i*Math.cos(-h*a),d+i*Math.sin(-h*a)],["A",i,i,0,+(Math.abs(h-e)>180),0,g+i*Math.cos(-e*a),d+i*Math.sin(-e*a)],["L",g+f*Math.cos(-e*a),d+f*Math.sin(-e*a)],["A",f,f,0,+(Math.abs(e-h)>180),1,g+f*Math.cos(-h*a),d+f*Math.sin(-h*a)],["z"]]}}}},"gauge-needle":function(c,b){if(!c.customAttributes[b]){var a=Math.PI/180;c.customAttributes[b]=function(g,f,h,e,d){return{path:[["M",g+h*Math.cos(-e*a),f+h*Math.sin(-e*a)],["L",g+d*Math.cos(-(e+90)*a),f+d*Math.sin(-(e+90)*a)],["A",d,d,0,+(Math.abs((e+90)-(e+90*3))>180),0,g+d*Math.cos(-(e+90*3)*a),f+d*Math.sin(-(e+90*3)*a)],["Z"]]}}}}};return this})();